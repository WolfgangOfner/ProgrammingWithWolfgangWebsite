---
title: Publish to an Internal NuGet Feed in Azure DevOps
date: 2021-01-04
author: Wolfgang Ofner
categories: [DevOps]
tags: [Azure DevOps, NuGet, CI]
description: In this post, I will show how to create a private NuGet feed in Azure DevOps and how to automatically publish your NuGet packages there using an Azure DevOps pipeline.
---

[In my last posts](/create-nuget-azure-devops), I showed how to create NuGet packages in Azure DevOps pipelines. To easily distribute them, you have to publish these NuGet packages to a NuGet feed. This can be done by using nuget.org  which is publicly accessible or you can use a private one in Azure DevOps.

In this post, I will show how to create a private NuGet feed in Azure DevOps and how to automatically publish your NuGet packages there using an Azure DevOps pipeline.

## Create a private NuGet Feed

To create a private NuGet Feed, open the Artifacts tab in your project in Azure DevOps and then click on + Create Feed.

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/Create-a-new-NuGet-feed.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Create-a-new-NuGet-feed.jpg" alt="Create a new NuGet feed" /></a>
  
  <p>
   Create a new NuGet feed
  </p>
</div>

This opens a flyout where you can configure the new feed. Provide a name, its visibility, and the scope. Click Create and your private feed gets created.

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/Create-the-NuGet-feed.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Create-the-NuGet-feed.jpg" alt="Create the NuGet feed" /></a>
  
  <p>
   Create the NuGet feed
  </p>
</div>

That's it. Now let's edit the pipeline to upload the previously created NuGet package to the new feed.

## Upload NuGet Packages to a private Feed in an Azure DevOps Pipeline

You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.

I already created a pipeline that creates a NuGet package, [in my last posts](/create-nuget-azure-devops). I will extend this pipeline to upload the created NuGet package to the previously created NuGet feed. Publishing the NuGet package is pretty simple. I will create a new stage that will only run when the build stage was successful and also will only run if the build is not triggered by a pull request. This ensures that only builds from the master branch (or any feature branch) will be uploaded to the feed. 

<script src="https://gist.github.com/WolfgangOfner/ec3de7d759cda88478aff5848ff2b797.js"></script>

Next, I create a deployment where I download the previously published artifacts. These artifacts got published by the build and contain the NuGet packages. I have to download it because the stages are independent of each other. If the upload was in the build stage, I could directly reference the NuGet package without the need to download it.

<script src="https://gist.github.com/WolfgangOfner/f61f423cec39dc2c553c5426eef5543f.js"></script>

Lastly, I use a DotNet Core task to push the NuGet package. Use push as the command, the path where you downloaded the NuGet package, and as feed type internal. Don't care too much about the publish Vsts Feed id. This id is generated by Azure DevOps after you select your previously created feed.

<script src="https://gist.github.com/WolfgangOfner/cdde008f495cebd7fd53b89e5c8d1b03.js"></script>

That's already everything you need to publish the NuGet package to the private feed. The whole stage looks as follows:

<script src="https://gist.github.com/WolfgangOfner/6e55096210e6da22c2be2ecce22ecf1d.js"></script>
You can find the finished pipeline on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/blob/master/Nuget/pipelines/Nuget-CI-CD.yml" target="_blank" rel="noopener noreferrer">GitHub</a>.

## Publish the NuGet Package

Run the pipeline and after the build is finished, open your NuGet feed in the Artifacts tab. You will see your NuGet published there.

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/The-NuGet-package-got-published.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/The-NuGet-package-got-published.jpg" alt="The NuGet package got published" /></a>
  
  <p>
   The NuGet package got published
  </p>
</div>

If your pipeline doesn't have enough permissions to publish the NuGet package, open the settings of your feed, and navigate to the Permissions tab. There, add the Build Service as Contributor. 

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/Authorize-the-build-service.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Authorize-the-build-service.jpg" alt="Authorize the build service" /></a>
  
  <p>
   Authorize the build service
  </p>
</div>

Save the changes and run the pipeline again. Your NuGet package should get published now.

## Install NuGet Packages from your Private NuGet Feed

To install a NuGet package from your private feed, right-click your project or solution in Visual Studio, and select Manage NuGet Packages... On the right top of the window, you should see Package source and the settings button on the right of it. Click the settings button and a new window opens. Click on the + symbol and then add a name and the URL to your feed. 

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/Add-the-NuGet-feed-as-package-source.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Add-the-NuGet-feed-as-package-source.jpg" alt="Add the NuGet feed as package source" /></a>
  
  <p>
   Add the NuGet feed as package source
  </p>
</div>

Click OK and you can select your feed as your package source. Search for the previously uploaded NuGet package and install it.

<div class="col-12 col-sm-10 aligncenter">
  <a href="/assets/img/posts/2021/01/Install-the-NuGet-package.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Install-the-NuGet-package.jpg" alt="Install the NuGet package" /></a>
  
  <p>
   Install the NuGet package
  </p>
</div>

Note: If you try to add my feed URL, you will get a 401 error because your user is not allowed to access my feed. Nevertheless, the demo will work because I also uploaded the NuGet package on nuget.org which is a public feed. I can access the feed because I am logged into Visual Studio and therefore my credentials are passed. If I tried to use Docker to restore the NuGet package from my private feed, I would also get the 401 error.

In my next post, I will show how to pass an access token to the Dockerfile to access the private NuGet feed.

## Conclusion

Creating and using a private NuGet feed in Azure DevOps is easy. In this post, I showed how to create one and how to extend an Azure DevOps pipeline to automatically publish NuGet packages to the private feed. Then, I added the new feed to my project and used Visual Studio to install the NuGet package. In my next post, I will show how to pass an access token to the Dockerfile to access the private NuGet feed.

You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.

This post is part of ["Microservice Series - From Zero to Hero"](/microservice-series-from-zero-to-hero).