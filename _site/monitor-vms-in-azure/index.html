<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Monitor VMs in Azure" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics." /><meta property="og:description" content="To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics." /><link rel="canonical" href="/monitor-vms-in-azure/" /><meta property="og:url" content="/monitor-vms-in-azure/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-03-14T15:45:17+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Monitor VMs in Azure" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2018-03-14T15:45:17+01:00","datePublished":"2018-03-14T15:45:17+01:00","description":"To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics.","headline":"Monitor VMs in Azure","mainEntityOfPage":{"@type":"WebPage","@id":"/monitor-vms-in-azure/"},"url":"/monitor-vms-in-azure/"}</script><title>Monitor VMs in Azure | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/videos/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>VIDEOS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Monitor VMs in Azure</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Monitor VMs in Azure</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1521038717" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 14, 2018 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2284 words"> <em>26 min</em></span> read</div></div><div class="post-content"><p>To monitor VMs in Azure means collecting and analyzing different metrics as well as collection log data from system log files and from applications running within the VMs. It is possible to configure an email alert to an administrator which is triggered when certain criteria regarding these metrics are met. Monitoring helps you to gain insight into the status of the VMs.</p><p>Windows and Linux VMs collect the following metrics out of the box:</p><ul><li>CPU percentage<li>Disk read and write in KB/s or MB/s<li>Network in and out in KB/s or MB/s</ul><p>On Windows, the Azure Virtual Machine Agent installs the IaaSDiagnostics extension which monitors and collects diagnostic data. On Linux the Microsoft.Insights.VMDaignsticsSettings extension provides the same function.</p><p>The metrics collected on a Linux VM are:</p><ul><li>CPU<li>Disk<li>Memory<li>Network<li>Packets<li>Page<li>Swap</ul><p>The metrics collected on a Windows VM are:</p><ul><li>CPU<li>Disk<li>Network<li>Memory<li>ASP.NET<li>SQL Server</ul><p>These metrics are stored in Azure Storage Tables. By default, all metrics are collected every minute as a new row in the table.</p><p><span class="fontstyle0">For Windows VMs, metric data is written to the WADPerformanceCountersTable, with aggregates of these performance counter metrics aggregated to the minute or to the hour written to tables that start with the name WADMetricsPT1M for by minute and WADMetricsPT1H for by hour.  In addition to metrics, system logs are also collected. For Linux VM’s, the Syslog is collected into the LinuxsyslogVer2v0 table. For Windows VMs, all event log entries for the three event logs (application, security and system logs) are written to the WADWindowsEventLogsTable.</span></p><p><span class="fontstyle0">Windows VMs can collect other types of logs. Diagnostic infrastructure logs (events generated by the Azure Diagnostic Agent, such as issues collecting metrics) are written to the WADDiagnosticInfrastructureLogsTable, and application logs (the trace output from your .NET  application running in the VM) are stored in the WADLogsTable. Windows VMs can also collect Event Tracing for Windows Events. These events are collected into the WADETWEventTable. (<a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener noreferrer">Source</a>) </span></p><h2 id="configure-monitoring-and-diagnostics-for-a-new-vm"><span class="mr-2">Configure monitoring and diagnostics for a new VM</span><a href="#configure-monitoring-and-diagnostics-for-a-new-vm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To enable monitoring and diagnostics when deploying a new VM follow these steps:</p><ol><li>Go to the Marketplace, select Compute, then Windows Server, select the desired Version, for example, 2016. After selecting your OS click Create.<li>Provide the following information for your VM:<ul><li>Name<li>Disk type (SSD or HDD)<li>User name<li>Password<li>Subscription<li>An existing or new Resource group<li>Location<li>License (if available)</ul></ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Entering-basic-data-for-the-new-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/02/Entering-basic-data-for-the-new-VM.jpg" alt="Entering basic data for the new VM" data-proofer-ignore></a><p> Entering basic data for the new VM</p></div><ol start="3"><li> On the next blade choose a size for your VM. There are many different configurations with different costs to choose from. After you selected one, click Select.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Select-a-VM-size-according-to-your-needs.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/02/Select-a-VM-size-according-to-your-needs.jpg" alt="Select a VM size according to your needs" data-proofer-ignore></a><p> Select a VM size according to your needs</p></div><ol start="4"><li> On the Settings blade, under the Monitoring settings select enabled for Boot diagnostics and Guest OS diagnostics. Select or create a Storage Account where the logs will be stored.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-diagnostics-when-provisioning-a-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Enable-diagnostics-when-provisioning-a-VM.jpg" alt="Enable diagnostics when provisioning a VM" data-proofer-ignore></a><p> Enable diagnostics when provisioning a VM</p></div><ol start="5"><li> After entering all your settings, you get an overview of them in the Summary blade. Click Create to start the deployment process for your VM.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/02/Summary-of-the-new-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/02/Summary-of-the-new-VM.jpg" alt="Summary of the new VM" data-proofer-ignore></a><p> Summary of the new VM</p></div><h2 id="configure-monitoring-and-diagnostics-for-an-existing-vm"><span class="mr-2">Configure monitoring and diagnostics for an existing VM</span><a href="#configure-monitoring-and-diagnostics-for-an-existing-vm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To enable monitoring and diagnostics for an existing VM follow these steps:</p><ol><li>Go to your VM in the Azure Portal.<li>Under the Monitoring section, select Diagnostics settings.<li>For Linux VMs, toggle the Status to On to enable diagnostics.<li>For Windows, you have more options<ol><li>On the Overview tab, select Enable guest-level monitoring.<li>Check the categories you want to log on the Performance counters tab. Additionally, you can set the sample rate in seconds.<li> On the Logs tab, you can configure what events the different logs (Application, Security, System, and IIS) log.<li>On the Crash dumps tap, you can enable collecting memory dumps during a crash.<li>To enable the collection diagnostic infrastructure logs, tootle Diagnostic infrastructure logs to Enabled on the Agent tab. Then select the desired log level.</ol><li>After all settings are made, select Save.</ol><h2 id="configure-alerts"><span class="mr-2">Configure Alerts</span><a href="#configure-alerts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Azure enables you to configure alert rules based on the collected metrics of your VM. These alerts can be sending an email, invoking a Webhook or run a Logic App. Additionally, it is possible to send an email, an SMS or a Webhook when a specific log event is encountered.</p><h3 id="enable-alerts"><span class="mr-2">Enable alerts</span><a href="#enable-alerts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To enable and configure alerts follow these steps:</p><ol><li>Navigate to your VM in the Azure Portal.<li>Under the Monitoring menu, select Alert rules.<li>Click + Add metric alert or + Add activity log alert to add a new rule.<li>On the Add rule provide a name, select the metric source, specify the condition and then select the action to take when this condition is met.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-alert-for-your-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Create-a-new-alert-for-your-VM.jpg" alt="Create a new alert for your VM" data-proofer-ignore></a><p> Create a new alert for your VM</p></div><ol start="5"><li> I checked Email owners, contributors and readers to send an email to them. Additionally, you can also enter emails to notify more people.</ol><h2 id="monitor-metrics"><span class="mr-2">Monitor metrics</span><a href="#monitor-metrics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can assess the status and health of your VM by viewing its metrics in the portal, by querying the table storage for diagnostic logs or by downloading the IIS logs from Azure Storage.</p><p>To look at the metrics follow these steps:</p><ol><li>Navigate to your VM in the Azure Portal.<li>Select Metrics under the Monitoring menu.<li>On the Metrics blade, select the metrics you want to view. The selected metrics will be displayed as a graph on the right side.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/View-the-desired-metrics.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/View-the-desired-metrics.jpg" alt="View the desired metrics" data-proofer-ignore></a><p> View the desired metrics</p></div><ol start="4"><li> You can add a title and subtitle on the top of the graph and change the time range on the right side.</ol><h3 id="view-event-logs-diagnostic-infrastructure-logs-and-application-logs"><span class="mr-2">View event logs, diagnostic infrastructure logs and application logs</span><a href="#view-event-logs-diagnostic-infrastructure-logs-and-application-logs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can view event logs, diagnostic infrastructure logs and application logs by querying the respective tables  <span class="fontstyle0">WADWindowsEventLogsTable, WADDiagnosticInfrastructureLogsTable, WADLogsTable). This can be easily done using Visual Studio:</span></p><ol><li>Open Visual Studio<li>On the View menu, click Cloud (or Server) Explorer.<li>Expand the Azure node, then the Storage node.<li>Expand the storage account which contains the logs you want to view. Then expand Tables.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Select-a-log-using-Visual-Studio.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Select-a-log-using-Visual-Studio.jpg" alt="Select a log using Visual Studio" data-proofer-ignore></a><p> Select a log using Visual Studio</p></div><ol start="5"><li> Right-click on the table you want to query and selectOpen to display its contents.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/The-queried-logs-in-Visual-Studio.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/The-queried-logs-in-Visual-Studio.jpg" alt="The queried logs in Visual Studio" data-proofer-ignore></a><p> The queried logs in Visual Studio</p></div><h3 id="view-iis-logs"><span class="mr-2">View IIS logs</span><a href="#view-iis-logs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To view IIS logs using Visual Studio follow these steps:</p><ol><li>Open Visual Studio<li>On the View menu, click Server Explorer.<li>Expand the Azure node, then the Storage node. If you can’t see your storage account there right-click and select Attach external storage. In the new window, enter the name and key for your storage account.<li>Expand the storage account which contains the logs you want to view. Then expand Blobs.<li>If you don’t see the logs, go to your VM, select Diagnostic settings and on the Logs blade enable IIS logs.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Open-the-IIS-log-using-Visual-Studio.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Open-the-IIS-log-using-Visual-Studio.jpg" alt="Open the IIS log using Visual Studio" data-proofer-ignore></a><p> Open the IIS log using Visual Studio</p></div><ol start="6"><li> Right-click on wad-iis-logfiles and select view Blob container. There you can view or download the IIS logs.</ol><h3 id="view-boot-diagnostics"><span class="mr-2">View Boot diagnostics</span><a href="#view-boot-diagnostics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To view the boot diagnostics follow these steps:</p><ol><li>Open your VM in the Azure Portal.<li>Select Boot diagnostics from the Support + Troubleshooting menu.<li>If you have a Windows VM, you see the login screen. Select Serial log to see and download the log file. If you have a Linux VM, you will see the log by default.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/View-Boot-diagnostics.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/View-Boot-diagnostics.jpg" alt="View Boot diagnostics" data-proofer-ignore></a><p> View Boot diagnostics</p></div><h2 id="enable-application-insights-at-runtime"><span class="mr-2">Enable Application Insights at runtime</span><a href="#enable-application-insights-at-runtime" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To enable Application Insights at runtime, you first have to create a new Application Insights instance. You can do that following these steps:</p><ol><li>Go to the marketplace in the Azure Portal.<li>Search for Application Insights and click Create.<li>Provide a new, Subscription, Resource Group and Location. Leave the Application Type as ASP.NET web application.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Application-Insights-instance.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Create-a-new-Application-Insights-instance.jpg" alt="Create a new Application Insights instance to Monitor VMs" data-proofer-ignore></a><p> Create a new Application Insights instance</p></div><ol start="4"><li> Go to your WebApp, which you want to monitor.<li> Select Application Insights under the Monitoring menu.<li> On the Application Insights blade, click Select existing resource and then click on your previously created Application Insights instance.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Application-Insights-for-your-WebApp.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Enable-Application-Insights-for-your-WebApp.jpg" alt="Enable Application Insights for your WebApp" data-proofer-ignore></a><p> Enable Application Insights for your WebApp</p></div><ol start="7"><li> Click on OK.<li> Visit your WebApp and after a couple moments, you will see live information about your WebApp.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Get-Live-Stream-information-from-Application-Insights.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Get-Live-Stream-information-from-Application-Insights.jpg" alt="Get Live Stream information from Application Insights" data-proofer-ignore></a><p> Get Live Stream information from Application Insights</p></div><h2 id="monitor-vm-workloads-by-using-azure-application-insights"><span class="mr-2">Monitor VM workloads by using Azure Application Insights</span><a href="#monitor-vm-workloads-by-using-azure-application-insights" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To monitor a VM workload with Azure Application Insights follow these steps:</p><ol><li>Open the IIS web server on your VM.<li>Download and install the <a href="http://go.microsoft.com/fwlink/?LinkId=506648" target="_blank" rel="noopener noreferrer">Status Monitor</a>.<li>After the Status Monitor is installed, open IIS and select the web application that you want to monitor.<li>Sign in with your Azure credentials and click on Configure settings to configure to which Application Insights you stream your data.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Application-Insights-Status-Monitor-on-your-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Enable-Application-Insights-Status-Monitor-on-your-VM.jpg" alt="Enable Application Insights Status Monitor on your VM" data-proofer-ignore></a><p> Enable Application Insights Status Monitor on your VM</p></div><ol start="5"><li> After you configured the settings, the web application will start streaming its information to the selected Application Insights application.<li> To view these information, go to the Azure Portal and open your Application Insights instance.<li> Select Live Metrics under the Investigate menu.<li> You will see a live stream of incoming and outgoing requests, failures and the duration of the requests.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Live-Metrics-in-Application-Insights-from-the-Web-Application-running-on-IIS-on-the-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Live-Metrics-in-Application-Insights-from-the-Web-Application-running-on-IIS-on-the-VM.jpg" alt="Live Metrics in Application Insights from the Web Application running on IIS on the VM" data-proofer-ignore></a><p> Live Metrics in Application Insights from the Web Application running on IIS on the VM</p></div><h2 id="monitor-vms-using-azure-log-analytics-and-oms"><span class="mr-2">Monitor VMs using Azure Log Analytics and OMS</span><a href="#monitor-vms-using-azure-log-analytics-and-oms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With Azure Log Analytics, you can collect data directly from your Azure VM and other resources in your environments into a single repository for detailed analysis. To set up Azure Log Analytics follow these steps:</p><ol><li>In the Azure Portal, go to the Marketplace and search for Log Analytics.<li>Select Log Analytics and click Create.<li>Provide a name, Subscription, Resource Group, Location, and Pricing tier, then click OK.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Log-Analytics-instance.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Create-a-new-Log-Analytics-instance.jpg" alt="Create a new Log Analytics instance" data-proofer-ignore></a><p> Create a new Log Analytics instance</p></div><h3 id="enable-the-log-analytics-vm-extension"><span class="mr-2">Enable the Log Analytics VM Extension</span><a href="#enable-the-log-analytics-vm-extension" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After Log Analytics is created, you have to enable the Log Analytics VM Extension. The extension gets installed automatically and configures the agent to send data to the Log Analytics automatically. To set enable the Log Analytics VM Extension follow these steps:</p><ol><li>Go to your Log Analytics in the Azure Portal.<li>Select Virtual machines under the Workspace Data Sources menu and select the VM you want to install the agent on.<li>On the Virtual machine blade, click on Connect. This installs the agent and configures it for your Log Analytics workspace.<li>After the installation is completed, the OMS connection status will change to This workspace.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Installing-the-agent-on-your-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Installing-the-agent-on-your-VM.jpg" alt="Installing the agent on your VM" data-proofer-ignore></a><p> Installing the agent on your VM</p></div><h3 id="collect-event-and-performance-data"><span class="mr-2">Collect event and performance data</span><a href="#collect-event-and-performance-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Log Analytics can collect events from the Windows event logs or Linux Syslog and performance and also take action when a particular condition is detected. To set it up, follow these steps:</p><ol><li>Go to Log Analytics in the Azure Portal.<li>Select Advanced settings under the Settings menu.<li>Select Data and then select Windows Event Logs.<li>Add a new event log by entering a name and then clicking +.<li>After the log is created, select the desired log level.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Create-a-new-Log-for-information-from-your-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Create-a-new-Log-for-information-from-your-VM.jpg" alt="Create a new Log for information from your VM" data-proofer-ignore></a><p> Create a new Log for information from your VM</p></div><ol start="6"><li> Select Windows Performance Counters and enable your desired performance counters.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Select-your-desired-performance-counters.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Select-your-desired-performance-counters.jpg" alt="Select your desired performance counters" data-proofer-ignore></a><p> Select your desired performance counters</p></div><ol start="7"><li> Click Save.</ol><h3 id="view-the-collected-data"><span class="mr-2">View the collected data</span><a href="#view-the-collected-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After data collection is set up, you can run searches in your log. To do that, follow these steps:</p><ol><li>Open your Log Analytics in the Azure Portal.<li>Click Log Search under the General menu.<li>The Log Search blade already suggests a couple of queries and the search box also makes suggestions based on your input. For example, you could enter Usage and click the Search icon which will give you various information about the usage of your VM.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Search-the-logs-for-the-usage-of-your-VM.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Search-the-logs-for-the-usage-of-your-VM.jpg" alt="Search the logs for the usage of your VM" data-proofer-ignore></a><p> Search the logs for the usage of your VM</p></div><h3 id="monitor-your-network-topology"><span class="mr-2">Monitor your network topology</span><a href="#monitor-your-network-topology" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After you deployed your Network Watcher, you can look at the topology of your network by following these steps:</p><ol><li>Click on Topology under the Monitoring menu.<li>On the Topology blade select your Subscription, Resource group, and Virtual Network.<li>Your network will be displayed you can download it by clicking on Download topology</ol><h2 id="monitor-your-network"><span class="mr-2">Monitor your network</span><a href="#monitor-your-network" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To monitor and diagnose your network, Azure has a service called Network Watcher. The Network Watcher can visualize your network and therefore can help you to understand, diagnose and gain insights into your network in Azure. Following, I will talk about some features of the Network Watcher.</p><h3 id="create-a-network-watcher"><span class="mr-2">Create a Network Watcher</span><a href="#create-a-network-watcher" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To enable a Network Watcher follow these steps:</p><ol><li>In the Azure Portal, click on All services and search for Network Watcher and select the result.<li>On the Overview blade of your Network Watcher, enable the regions you want to monitor in the drop-down list.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Enable-Network-Watchers-in-your-desired-location.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Enable-Network-Watchers-in-your-desired-location.jpg" alt="Enable Network Watchers in your desired location" data-proofer-ignore></a><p> Enable Network Watchers in your desired location</p></div><h3 id="monitor-the-topology-of-your-network"><span class="mr-2">Monitor the topology of your network</span><a href="#monitor-the-topology-of-your-network" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After your Network Watcher is deployed, you can take a look at the topology of your network. To do that follow these steps:</p><ol><li>In your Network Watcher, click on Topology under the Monitoring menu.<li>On the Topology blade, select a Subscription, Resource Group, and a Virtual Network.<li>After a couple of seconds, your network will be displayed. You can also download the topology by clicking on Download topology.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Topology-with-virtual-machines-and-network-cards.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Topology-with-virtual-machines-and-network-cards.jpg" alt="Topology with virtual machines and network cards" data-proofer-ignore></a><p> Topology with virtual machines and network cards</p></div><h3 id="monitor-your-network-limits"><span class="mr-2">Monitor your network limits</span><a href="#monitor-your-network-limits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can only have a certain amount of network resources per subscription. The Network Watcher lists all used resources and makes it easy to monitor them. To do that follow these steps:</p><ol><li>In your Network Watcher, click on Network subscription limit.<li>Select a Subscription and Location.<li>The Portal will list all resources, the current limit, and your usage.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/03/Overview-of-the-Network-subscription-limit.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/03/Overview-of-the-Network-subscription-limit.jpg" alt="Overview of the Network subscription limit" data-proofer-ignore></a><p> Overview of the Network subscription limit</p></div><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this post, I showed how to enable monitoring and diagnostics when deploying a new VM as well as for an existing VM. The next section talked about Application Insights and how to monitor WebApps and also application running on IIS on a VM. Next, I showed how to monitor your VMs with Log Analytics and how to filter these logs. The last part was a short overview of the Network Watcher and how to monitor your network with it.</p><p>For more information about the 70-532 exam get the <a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener noreferrer">Exam Ref book from Microsoft</a> and continue reading my blog posts. I am covering all topics needed to pass the exam. You can find an overview of all posts related to the 70-532 exam <a href="/prepared-for-the-70-532-exam/" target="_blank" rel="noopener noreferrer">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>Cloud</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/70-532/" class="post-tag no-text-decoration" >70-532</a> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/certification/" class="post-tag no-text-decoration" >Certification</a> <a href="/tags/exam/" class="post-tag no-text-decoration" >Exam</a> <a href="/tags/learning/" class="post-tag no-text-decoration" >Learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Monitor+VMs+in+Azure+-+Programming+With+Wolfgang&url=%2Fmonitor-vms-in-azure%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Monitor+VMs+in+Azure+-+Programming+With+Wolfgang&u=%2Fmonitor-vms-in-azure%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Monitor+VMs+in+Azure+-+Programming+With+Wolfgang&url=%2Fmonitor-vms-in-azure%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fmonitor-vms-in-azure%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/prepared-for-the-70-532-exam/"><div class="card-body"> <em class="small" data-ts="1519392828" data-df="ll" > Feb 23, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I prepared for the 70-532 Exam</h3><div class="text-muted small"><p> Recently I started to prepare for the Microsoft certification exam 70-532 “Developing Microsoft Azure Solutions” using the official Exam Ref book. This post contains a comprehensive list of blog po...</p></div></div></a></div><div class="card"> <a href="/deploy-workload-on-azure-arm-virtual-machines/"><div class="card-body"> <em class="small" data-ts="1520255937" data-df="ll" > Mar 5, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploy workload on Azure ARM virtual machines</h3><div class="text-muted small"><p> Azure ARM virtual machines can run a lot of different operating systems. In this posts, I will give an overview of these different types and I will also show how to create them in the Azure Portal....</p></div></div></a></div><div class="card"> <a href="/perform-configuration-management/"><div class="card-body"> <em class="small" data-ts="1520335271" data-df="ll" > Mar 6, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Perform Configuration Management</h3><div class="text-muted small"><p> In this post, I want to show how to use Windows PowerShell Desired State Configuration (DSC) and the VM Agent to perform various configuration management tasks like remote debugging and at the end,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/design-implement-arm-vm-azure-storage/" class="btn btn-outline-primary" prompt="Older"><p>Design and implement ARM VM Azure Storage</p></a> <a href="/manage-arm-vm-availability/" class="btn btn-outline-primary" prompt="Newer"><p>Manage ARM VM Availability</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/monitor-vms-in-azure/'; this.page.identifier = '/monitor-vms-in-azure/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
