<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Automatically Version Docker Containers in Azure DevOps CI" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="This post will show you how to add semantic versioning to your CI/CD pipeline in Azure DevOps to automatically create a meaningful version for your Docker images." /><meta property="og:description" content="This post will show you how to add semantic versioning to your CI/CD pipeline in Azure DevOps to automatically create a meaningful version for your Docker images." /><link rel="canonical" href="/automatically-version-docker-container/" /><meta property="og:url" content="/automatically-version-docker-container/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-21T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Automatically Version Docker Containers in Azure DevOps CI" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2020-12-21T00:00:00+01:00","datePublished":"2020-12-21T00:00:00+01:00","description":"This post will show you how to add semantic versioning to your CI/CD pipeline in Azure DevOps to automatically create a meaningful version for your Docker images.","headline":"Automatically Version Docker Containers in Azure DevOps CI","mainEntityOfPage":{"@type":"WebPage","@id":"/automatically-version-docker-container/"},"url":"/automatically-version-docker-container/"}</script><title>Automatically Version Docker Containers in Azure DevOps CI | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/youtube/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>YOUTUBE</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Automatically Version Docker Containers in Azure DevOps CI</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Automatically Version Docker Containers in Azure DevOps CI</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1608505200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 21, 2020 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1648 words"> <em>19 min</em></span> read</div></div><div class="post-content"><p>Most examples of building Docker containers just use the latest tag to deploy or Docker images. This is simple but shouldn’t be done in a production environment.</p><p>Today, I will show how to add semantic versioning to your CI/CD pipeline in Azure DevOps to automatically create a meaningful version for your Docker images.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p><h2 id="why-you-shouldnt-use-the-latest-tag"><span class="mr-2">Why you shouldn’t use the latest Tag</span><a href="#why-you-shouldnt-use-the-latest-tag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The latest tag is simple and there is nothing wrong with using it if you want to try out something. In a production environment, you shouldn’t use it because you want to have full control and knowledge of what version you are running at any given time.</p><p>Let’s say you have a test and production Kubernetes cluster and both run images using the latest tag. If a developer finishes a new feature the CI/CD pipeline creates a new image with the latest tag and deploys it to the test environment. That’s fine but what if a pod in your production cluster gets restarted? Kubernetes starts the image with the latest tag and suddenly you have the new feature running on one pod in your production cluster. If this new feature also needs changes to the database schema, the pod won’t start because the changes aren’t deployed yet. This will lead to more and more failing pods until your application is offline.</p><p>Another problem you might run into when using the latest tag is the caching mechanism of Docker. Docker is caching quite aggressively. By default, Docker checks if the image exists locally, and if it does, Docker starts it. This means that once you have the image with the latest tag, Docker will not update it and always start the outdated version.</p><p>There are ways around these problems but the version number is also there to inform your users or customers of a new version of your software/product. For example, my software ABC got updated from version 1.2 to 2.0 is way more meaningful than my software got a new latest version.</p><h2 id="automatically-create-semantic-versioning"><span class="mr-2">Automatically create Semantic Versioning</span><a href="#automatically-create-semantic-versioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Semantic versioning is the most used versioning method and consists of three numbers divided by a period, for example, 1.4.35. The first number (1) indicates the major version, the second number (4) the minor version, and the last number (35) the patch version. Major version changes contain breaking changes whereas minor or patch changes are backward compatible.</p><p><strong>As of March 2021, the originally used BuildVersioning extension stopped working. I don’t know why and since the last update was years ago, I decided to use GitTools instead. This extension is constantly updated, has simpler usage and more downloads. I will leave the original post for reference at the bottom of this post.</strong></p><h3 id="install-gittools-in-azure-devops"><span class="mr-2">Install GitTools in Azure DevOps</span><a href="#install-gittools-in-azure-devops" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can download the GitTools extension for free from the <a href="https://marketplace.visualstudio.com/items?itemName=gittools.gittools">Marketplace</a>. To download the extension, open the page of the extension in the marketplace and click on Get it free.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Get-the-GitTools-extension.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Get-the-GitTools-extension.jpg" alt="Get the GitTools extension" data-proofer-ignore></a><p> Get the GitTools extension</p></div><p>This opens a new page where you can either select your Azure DevOps Services organization to install it or download the extension if you want to install it on an Azure DevOps server.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Download-the-GitTools-extension.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Download-the-GitTools-extension.jpg" alt="Download the GitTools extension" data-proofer-ignore></a><p> Download the GitTools extension</p></div><p>This extension calculates the version and sets it in many different variations in different variables. On the following screenshot, you can see all available variables and what their values look like:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Available-variables-with-GitTools.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Available-variables-with-GitTools.jpg" alt="Available variables with GitTools" data-proofer-ignore></a><p> Available variables with GitTools</p></div><h3 id="add-the-build-versioning-task-to-the-pipeline"><span class="mr-2">Add the Build Versioning Task to the Pipeline</span><a href="#add-the-build-versioning-task-to-the-pipeline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/blob/master/CustomerApi/pipelines" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>Add the following two tasks as the first tasks of your job in your CI pipeline.</p><script src="https://gist.github.com/WolfgangOfner/ed5a31c129a830ffe3c1f9f894f51b24.js"></script><p>These tasks install the GitVersion tool and calculate the build number variables.</p><p>Additionally, you have to add a new file called GitVersion.yml to the root folder of your repository with the following content:</p><script src="https://gist.github.com/WolfgangOfner/4fb82a38079eb973556c9e24aefa7f97.js"></script><p>The last step you have to take before using semantic versioning is to ensure that the pipeline does not perform a shallow fetch when checking out the code. You can check this by clicking on the three dots in the top right corner and then select “Triggers”. This opens a new page where you select the “YAML” tab and then “Get sources”. Uncheck shallow fetch on the bottom of the window.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Disable-shallow-fetch.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Disable-shallow-fetch.jpg" alt="Disable shallow fetch" data-proofer-ignore></a><p> Disable shallow fetch</p></div><h3 id="use-the-semantic-version"><span class="mr-2">Use the Semantic Version</span><a href="#use-the-semantic-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All you have to do to use the semantic version is to add the desired variable as the tag to your image name. I already have a variable for the image name and add $(GitVersion.FullSemVer) as the tag:</p><script src="https://gist.github.com/WolfgangOfner/c1c8b743d01225cb7c4cc676931cfe87.js"></script><h3 id="testing-the-semantic-version"><span class="mr-2">Testing the Semantic Version</span><a href="#testing-the-semantic-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Setting up the semantic version is pretty simple. Run the CI pipeline with the master branch and you will see the Build Versioning task creating a new build number. On the following screenshot, you can see that version 0.1.130 was created.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Determine-the-build-version.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Determine-the-build-version.jpg" alt="Determine the build version" data-proofer-ignore></a><p> Determine the build version</p></div><p>If you commit changes to the master branch and run the pipeline again, it will create version 0.1.129. If you don’t have any changes, it will create 0.1.128 again. After the CI/CD pipeline is finished, the new image gets pushed to Docker Hub. There you can see the new version and the old one.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/new-vs-old-version.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/new-vs-old-version.jpg" alt="new vs old version" data-proofer-ignore></a><p> New vs old version</p></div><p>Having a semantic version like 0.1.128 is way more meaningful than 358 and helps users of the image identify changes easily.</p><h3 id="create-a-version-number-for-feature-branches"><span class="mr-2">Create a Version Number for Feature Branches</span><a href="#create-a-version-number-for-feature-branches" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Usually, only the master branch is used to create new versions of an application. Sometimes a developer wants to create an image to test new changes before merging the feature into the master branch. When you run the pipeline with a feature branch (every branch != master), the Build Versioning task will create a preview version. This means that you still get a semantic version but the task adds the branch name and a counter to the end of the version, for example, 0.1.131-myFeature0000.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Feature-branch-versioning.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Feature-branch-versioning.jpg" alt="Feature branch versioning" data-proofer-ignore></a><p> Feature branch versioning</p></div><p>This version number means that it was run for the branch named versionnumber and it was run the first time. If you commit changes and run the branch again, it will create the version 0.1.131-myFeature0001.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>DevOps is all about automating tasks and processes. A part of this automation is the versioning of your application. Today, I showed how easy it is to use the Build Versioning extension in Azure DevOps to automatically create semantic version numbers and how to add them to a Docker image.</p><p>You can find the code of the whole demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a></p><p><strong>The following text is the original article about BuildVersioning</strong></p><h3 id="install-build-versioning-in-azure-devops"><span class="mr-2">Install Build Versioning in Azure DevOps</span><a href="#install-build-versioning-in-azure-devops" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>My company created a free Azure DevOps extension which you can download from the <a href="https://marketplace.visualstudio.com/items?itemName=gittools.gittools">Marketplace</a>. To download the extension, open the page of the extension in the marketplace and click on Get it free.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Get-the-build-versioning-extension.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Get-the-build-versioning-extension.jpg" alt="Get the build versioning extension" data-proofer-ignore></a><p> Get the build versioning extension</p></div><p>This opens a new page where you can either select your Azure DevOps Services organization to install it or download the extension if you want to install it on an Azure DevOps server.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Download-the-build-versioning-extension.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Download-the-build-versioning-extension.jpg" alt="Download the build versioning extension" data-proofer-ignore></a><p> Download the build versioning extension</p></div><p>This extension automatically installs Git and then calculates the semantic version. The calculated version gets set in the Build.BuildNumber variable.</p><h3 id="add-the-build-versioning-task-to-the-pipeline-1"><span class="mr-2">Add the Build Versioning Task to the Pipeline</span><a href="#add-the-build-versioning-task-to-the-pipeline-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/blob/master/CustomerApi/pipelines/CustomerApi-CI.yml" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>Add the following BuildVersioning task as the first task of your job in your CI pipeline.</p><script src="https://gist.github.com/WolfgangOfner/12fcececd48eb4b8ed58c2de5ab8c52f.js"></script><p>This configures the versioning task to use chocolatey to install Git if it’s not available, and then replace the Build.BuildNumber variable with the calculated semantic version number.</p><p>Additionally, you have to add a new file called GitVersion.yml to the root folder of your repository with the following content:</p><script src="https://gist.github.com/WolfgangOfner/4fb82a38079eb973556c9e24aefa7f97.js"></script><h3 id="use-the-semantic-version-1"><span class="mr-2">Use the Semantic Version</span><a href="#use-the-semantic-version-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All you have to do to use the semantic version is to add the Build.BuildNumber variable as the tag to your image name. I already have a variable for the image name and add the BuildNumber there:</p><script src="https://gist.github.com/WolfgangOfner/c1c8b743d01225cb7c4cc676931cfe87.js"></script><h3 id="testing-the-semantic-version-1"><span class="mr-2">Testing the Semantic Version</span><a href="#testing-the-semantic-version-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Setting up the semantic version is pretty simple. Run the CI pipeline with the master branch and you will see the Build Versioning task creating a new build number. On the following screenshot, you can see that version 0.1.43 was created.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Create-build-version.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Create-build-version.jpg" alt="Create build version" data-proofer-ignore></a><p> Create build version</p></div><p>If you commit changes to the master branch and run the pipeline again, it will create version 0.1.44. If you don’t have any changes, it will create 0.1.43 again. After the CI/CD pipeline is finished, the new image gets pushed to Docker Hub. There you can see the new version and the old one.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/new-vs-old-versioning.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/new-vs-old-versioning.jpg" alt="new vs old versioning" data-proofer-ignore></a><p> New vs old versioning</p></div><p>The new version 0.1.43 is way more meaningful than 358 and helps users of the image identify changes easily.</p><h3 id="create-a-version-number-for-feature-branches-1"><span class="mr-2">Create a Version Number for Feature Branches</span><a href="#create-a-version-number-for-feature-branches-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Usually, only the master branch is used to create new versions of an application. Sometimes a developer wants to create an image to test new changes before merging the feature into the master branch. When you run the pipeline with a feature branch (every branch != master), the Build Versioning task will create a preview version. This means that you still get a semantic version but the task adds the branch name and a counter to the end of the version, for example, 0.1.44-versionnumber0000.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2020/12/Version-of-feature-branch.jpg"><img loading="lazy" data-src="/assets/img/posts/2020/12/Version-of-feature-branch.jpg" alt="Version of feature branch" data-proofer-ignore></a><p> Version of feature branch</p></div><p>This version number means that it was run for the branch named versionnumber and it was run the first time. If you commit changes and run the branch again, it will create the version 0.1.44-versionnumber0001.</p><h2 id="conclusion-1"><span class="mr-2">Conclusion</span><a href="#conclusion-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>DevOps is all about automating tasks and processes. A part of this automation is the versioning of your application. Today, I showed how easy it is to use the Build Versioning extension in Azure DevOps to automatically create semantic version numbers and how to add them to a Docker image.</p><p>You can find the code of the whole demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>DevOps</a>, <a href='/categories/docker/'>Docker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure-devops/" class="post-tag no-text-decoration" >Azure DevOps</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >Docker</a> <a href="/tags/ci/" class="post-tag no-text-decoration" >CI</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Automatically+Version+Docker+Containers+in+Azure+DevOps+CI+-+Programming+With+Wolfgang&url=%2Fautomatically-version-docker-container%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Automatically+Version+Docker+Containers+in+Azure+DevOps+CI+-+Programming+With+Wolfgang&u=%2Fautomatically-version-docker-container%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Automatically+Version+Docker+Containers+in+Azure+DevOps+CI+-+Programming+With+Wolfgang&url=%2Fautomatically-version-docker-container%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fautomatically-version-docker-container%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/create-a-docker-image-in-an-azure-devops-ci-pipeline/"><div class="card-body"> <em class="small" data-ts="1600034400" data-df="ll" > Sep 14, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create a Docker Image in an Azure DevOps CI Pipeline</h3><div class="text-muted small"><p> In my last post, I showed how to build a .NET Core Microservice inside a Docker container. Today, I want to build this microservice in an Azure DevOps CI pipeline and push the image to Docker Hub. ...</p></div></div></a></div><div class="card"> <a href="/run-tests-inside-docker-during-ci/"><div class="card-body"> <em class="small" data-ts="1600844962" data-df="ll" > Sep 23, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Run Tests inside Docker during CI</h3><div class="text-muted small"><p> Running your build inside a Docker container has many advantages like platform independence and better testability for developers. These containers also bring more complexity though. In my last pos...</p></div></div></a></div><div class="card"> <a href="/build-docker-azure-devops-ci-pipeline/"><div class="card-body"> <em class="small" data-ts="1604271600" data-df="ll" > Nov 2, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build Docker in an Azure DevOps CI Pipeline</h3><div class="text-muted small"><p> In my last post, I showed how to build a .NET Core Microservice with an Azure DevOps CI pipeline. Today, I want to build these microservices in another Azure DevOps CI pipeline and push the images ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/article-captain-in-the-service-orchestra/" class="btn btn-outline-primary" prompt="Older"><p>Article - Captain in the Service Orchestra</p></a> <a href="/create-nuget-azure-devops/" class="btn btn-outline-primary" prompt="Newer"><p>Create NuGet Packages in Azure DevOps Pipelines</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/automatically-version-docker-container/'; this.page.identifier = '/automatically-version-docker-container/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
