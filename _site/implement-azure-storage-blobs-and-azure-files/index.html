<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Implement Azure Storage blobs and Azure files" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en_US" /><meta name="description" content="Azure provides several methods of storing files, including Azure Storage blobs and Azure Files. In this post, I want to talk about the differences between them and how to use them." /><meta property="og:description" content="Azure provides several methods of storing files, including Azure Storage blobs and Azure Files. In this post, I want to talk about the differences between them and how to use them." /><link rel="canonical" href="https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" /><meta property="og:url" content="https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-04-08T11:17:44+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Implement Azure Storage blobs and Azure files" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/"},"author":{"@type":"Person","name":"Wolfgang Ofner"},"url":"https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/","description":"Azure provides several methods of storing files, including Azure Storage blobs and Azure Files. In this post, I want to talk about the differences between them and how to use them.","@type":"BlogPosting","headline":"Implement Azure Storage blobs and Azure files","dateModified":"2021-05-19T22:25:07+02:00","datePublished":"2018-04-08T11:17:44+02:00","@context":"https://schema.org"}</script><title>Implement Azure Storage blobs and Azure files | Programming With Wolfgang</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="author wolfgang ofner" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/wolfgangofner" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wolfgang','programmingwithwolfgang.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Implement Azure Storage blobs and Azure files</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Implement Azure Storage blobs and Azure files</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Implement Azure Storage blobs and Azure files</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 8, 2018, 11:17 AM +0200" > Apr 8, 2018 <i class="unloaded">2018-04-08T11:17:44+02:00</i> </span> by <span class="author"> Wolfgang Ofner </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, May 19, 2021, 10:25 PM +0200" > May 19 <i class="unloaded">2021-05-19T22:25:07+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2475 words">29 min</span></div></div><div class="post-content"><p>Azure provides several methods of storing files, including Azure Storage blobs and Azure Files. In this post, I want to talk about the differences between them and how to use them.</p><h2 id="azure-storage-blobs">Azure Storage blobs</h2><p>Azure Storage blobs should be used when you have files that you are storing using a custom application. Microsoft provides client libraries and REST interfaces for the Azure Storage blobs with which you can store and access data at a massive scale in block blobs</p><h3 id="create-a-blob-storage-account">Create a blob storage account</h3><p>To create a blob storage account, follow these steps:</p><ol><li>In the Azure Portal, click on +Create a resource then on Storage and then select Storage account – blob, file, table, queue.<li>On the Create storage account blade provide a name, location, subscription, and resource group. Optionally you can choose between standard (HDD) and premium (SSD) performance and enforce HTTPS by moving the slider to Enabled under the Secure transfer required attribute.<li>Click Create.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-a-new-Azure-Storage-account.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-a-new-Azure-Storage-account.jpg" alt="Create a new Azure Storage blobs account" /></a><p> Create a new Azure Storage account</p></div><p>Your data is always replicated three times within the same data center to ensure data security.</p><h3 id="read-and-change-data">Read and change data</h3><p>The code of the following demo can be downloaded from <a href="https://github.com/WolfgangOfner/Azure-StorageAccount" target="_blank" rel="noopener">GitHub</a> You can read and change data by using the Azure SDK for .Net, following these steps:</p><li style="list-style-type: none;"><ol><li> Make sure you have the Azure SDK installed.<li> Create a new C# console application and install the WindowsAzure.Storage NuGet Package.<li> Connect to your storage account in your application using the following code:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Connect-to-your-storage-account.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Connect-to-your-storage-account.jpg" alt="Connect to your storage account" /></a><p> Connect to your storage account</p></div><p>Replace the placeholder for storage account name and storage key with your own. You can find them in the Azure Portal under Access keys in your storage account.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Finding-the-Storage-account-name-storage-key-and-connection-string.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Finding-the-Storage-account-name-storage-key-and-connection-string.jpg" alt="Finding the Storage account name, storage key and connection string" /></a><p> Finding the Storage account name, storage key, and connection string</p></div><ol start="4"><li> Create a container with the following code</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-the-container-myblockcontainer-if-it-does-not-exist.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-the-container-myblockcontainer-if-it-does-not-exist.jpg" alt="Create the container myblockcontainer if it does not exist" /></a><p> Create the container myblockcontainer if it does not exist</p></div><p>Azure Storage blobs are organized in containers. Each storage account can have an unlimited amount of containers. Note that a container can’t have uppercase letters.</p><ol start="5"><li> Next, set the path to the file you want to upload and upload the file</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Upload-a-file-to-the-container.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Upload-a-file-to-the-container.jpg" alt="Upload a file to the container" /></a><p> Upload a file to the container</p></div><ol start="6"><li> After the file is uploaded you can find it in the Azure Portal:<ul><li> Go to your storage account and click on Blobs on the Overview blade<li> On the Blob service blade, click on your container. There you can see all blobs inside this container.</ul></ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/The-previously-uploaded-blob.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/The-previously-uploaded-blob.jpg" alt="The previously uploaded blob" /></a><p> The previously uploaded blob</p></div><h2 id="set-metadata-on-a-container">Set metadata on a container</h2><p>Metadata can be used to determine when files have been updated or to set the content types for web artifacts. There are two forms of metadata:</p><ol><li><strong>System properties metadata</strong> give you information about access, file types and more.<li><strong>User-defined metadata</strong> is a key-value pair that is specified for your application. It can be the time when a file was processed or a note of the source.</ol><p>A container has only read-only system properties, while blobs have both read-only and read-write properties.</p><h3 id="setting-user-defined-metadata">Setting user-defined metadata</h3><p>To set user-defined metadata, expand the code from before with these two lines:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Set-user-defined-metadata.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Set-user-defined-metadata.jpg" alt="Set user-defined metadata" /></a><p> Set user-defined metadata</p></div><h3 id="read-user-defined-metadata">Read user-defined metadata</h3><p>To read the previously added user-defined metadata, add this code:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Read-user-defined-metadata.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Read-user-defined-metadata.jpg" alt="Read user-defined metadata" /></a><p> Read user-defined metadata</p></div><p>If the metadata key does not exist, an exception is thrown.</p><h3 id="read-system-properties">Read system properties</h3><p>To read system properties, add this code:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Read-system-metadata.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Read-system-metadata.jpg" alt="Read system metadata" /></a><p> Read system metadata</p></div><p>There are various system metadata. Use the IntelliSense to see all available ones.</p><h2 id="store-data-using-block-and-page-blobs">Store data using block and page blobs</h2><p>Azure Storage Blobs have three different types of blobs:</p><ol><li><strong>Block blobs</strong> are used to upload large files. A blob is divided up into blocks which allow for easy updating large files since you can insert, replace or delete an existing block. After a block is updated, the list of blocks needs to be committed for the file to actually record the update.<li><strong>Page blobs</strong> are comprised of 512- byte pages that are optimized for random read and write operations. Page blobs are useful for VHDs and other files which have frequent, random access.<li><strong>Append blobs</strong> are optimized for append operations like logging and streaming data.</ol><h3 id="write-data-to-a-page-blob">Write data to a page blob</h3><p>First, you have to create a page blob:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-a-page-blob.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-a-page-blob.jpg" alt="Create a page blob" /></a><p> Create a page blob</p></div><p>After the page blob is created, you can write data to it:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Wirte-to-a-page-blob.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Wirte-to-a-page-blob.jpg" alt="Write to a page blob" /></a><p> Write to a page blob</p></div><p>After some data are added to the blob, you can read it:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Read-a-page-blob.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Read-a-page-blob.jpg" alt="Read a page blob" /></a><p> Read a page blob</p></div><h2 id="stream-data-using-azure-storage-blobs">Stream data using Azure Storage blobs</h2><p>Instead of downloading a whole blob, you can download it to a stream using the DownloadToStream() API. The advantage of this approach is that it avoids loading the whole blob into the memory.</p><h2 id="access-azure-storage-blobs-securely">Access Azure Storage blobs securely</h2><p>Azure Storage supports both HTTP and HTTPS. You should always use HTTPS though. You can authenticate in three different ways to your storage account:</p><ol><li>Shared Key: The shared key is constructed from a set of fields from the request. It is computed with the SHA-256 algorithm and encoded in Base64<li>Shared Key Lite: The shared key lite is similar to the shared key but it is compatible with previous versions of Azure Storage.<li>Shared Access Signature: The shared access signature grants restricted access rights to containers and blobs. Users with a shared access signature have only specific permissions to a resource for a specified amount of time.</ol><p>Each call to interact with blob storage will be secured, as shown in the following code:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Secure-access-to-your-Storage-Account.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Secure-access-to-your-Storage-Account.jpg" alt="Secure access to your Storage Account" /></a><p> Secure access to your Storage Account</p></div><h2 id="implement-async-blob-copy">Implement Async blob copy</h2><p>Sometimes it is necessary to copy blobs between storage account, for example, before an update or when migrating files from one account to another.</p><p>The type of the blob can’t be changed during the async copy operation. Any files with the same name on the destination account will be overwritten.</p><p>When you call the API and get a success message, this means the copy operation has been successfully scheduled. The success message will be returned after checking the permissions on the source and destination account.</p><p>The copy process can be performed with the Shared Access Signature method,</p><h2 id="configure-a-content-delivery-network-with-azure-storageblobs">Configure a Content Delivery Network with Azure Storage Blobs</h2><p>A Content Delivery Network (CDN) is used to cache static files to different parts of the world. A CDN would be a perfect solution for serving files close to the users. There are way more CDN nodes than data centers, therefore the files in the CDN can be better distributed in an area and reduce the latency for your customers. As a result, files are loaded faster and the user experience is increased.</p><p>The CDN cache is perfect for CSS and JavaScript files, documents, images and HTML pages.</p><p>Once CDN is enabled and files are hosted in an Azure Storage Account, a configured CDN will store and replicate those files without any management.</p><p>To enable CDN for the storage account, follow these steps:</p><ol><li>Open your storage account and select Azure CDN under the Blob Service menu.<li>On the Azure CDN blade, create a new CDN by filling out the form. The difference between the Premium and Standard Pricing tier is that the Premium offers advanced real-time analytics.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-a-new-CDN.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-a-new-CDN.jpg" alt="Create a new CDN" /></a><p> Create a new CDN</p></div><p><span class="fontstyle0">If a file needs to be replaced or removed, you can delete it from the Azure Storage blob container. Remember that the file is being cached in the CDN. It will be removed or updated when the Time-to-Live (TTL) expires. If no cache expiry period is specified, it will be cached in the CDN for seven days. You set the TTL is the web application by using the clientCache element in the web.confg file. Remember when you place that in the web.confg file it affects all folders and subfolders for that application.</span></p><h2 id="design-blob-hierarchies">Design blob hierarchies</h2><p>Containers are flat which means that a container can’t have a child container inside it. A hierarchy can be created by naming the files similar to a folder structure. A solution would be to prefix all Azure Storage blobs with pictures with pictures/, for example, the file would be named pictures/house.jpg or pictures/tree.jpg. The path to these images would be:</p><ul><li>https://wolfgangstorageaccount.blob.core.windows.net/myblob/pictures/house.jpg<li>https://wolfgangstorageaccount.blob.core.windows.net/myblob/pictures/tree.jpg</ul><p>Using the prefix simulates having folders.</p><h2 id="configure-custom-domains">Configure custom domains</h2><p>The default endpoint for Azure Storage blobs is: StorageAccountName.blob.core.windows.net. Using the default domain can negatively affect SEO. Additionally, it tells that you are hosting your files on Azure. To hide this, you can configure your storage account to use a custom domain. To do that, follow these steps:</p><ol><li>Go to your storage account and click on Custom Domain under the Blob Service menu.<li>Check the Use indirect CNAME validation checkbox. By checking the checkbox, no downtime will incur for your application.<li>Log on to your DNS provider and add a CName record with the subdomain alias that includes the Asverify domain.<li>On the Custom domain blade, enter the name of your custom domain, but without the Asverify.<li>Click Save.<li>Create another CNAME record that maps your subdomain to your blob service endpoint on your DNS provider’s website<li>Now you can delete the Asverify CNAME since it has been verified by Azure already.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Add-a-custom-domain-to-your-storage-account.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Add-a-custom-domain-to-your-storage-account.jpg" alt="Add a custom domain to your storage account" /></a><p> Add a custom domain to your storage account</p></div><h2 id="scale-blob-storage">Scale blob storage</h2><p>Blob storage can be scaled both in terms of storage capacity and performance. Each Azure subscription can have up to 200 storage account, with 500 TB if capacity each. This means that each Azure subscription can have up to 100 PB of data.</p><p>A block blob can have 50,000 100 MB blocks with a total size of 4.75 TB. An append blob has a maximum size of 195 GB and a page blob has a maximum size of 8 TB.</p><p>In order to scale the performance, there are several features available. For example, you could enable geo-caching for the Azure CDN or implement read access geo-redundant storage and copy your data to multiple data center in different locations.</p><p>Azure Storage only charges for disk space used and network bandwidth.</p><p><span class="fontstyle0">Many small files will perform better in Azure Storage than one large file. Blobs use containers for logical grouping, but each blob can be retrieved by diﬀerent compute resources, even if they are in the same container.</span></p><h2 id="azure-files">Azure files</h2><p>Azure files are useful for VMs and cloud services as mounted share. Check out my post <a href="/design-implement-arm-vm-azure-storage/#CreateAzureStorage" target="_blank" rel="noopener">“Design and Implement ARM VM Azure Storage”</a> for an instruction on how to create an Azure file share.</p><h2 id="implement-blob-leasing">Implement blob leasing</h2><p>You can create a lock on a blob for write and delete operations. This lick can be between 15 and 60 seconds or it can be infinite. To write to a blob with an active lease, the client must include the active lease ID with the request.</p><p><span class="fontstyle0">When a client requests a lease, a lease ID is returned. The client can then use this lease ID to renew, change, or release the lease. When the lease is active, the lease ID must be included to write to the blob, set any metadata, add to the blob (through append), copy the blob, or delete the blob. </span></p><p>Use the following code to get the lease ID:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Get-the-lease-ID-of-your-block-blob.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Get-the-lease-ID-of-your-block-blob.jpg" alt="Get the lease ID of your block blob" /></a><p> Get the lease ID of your block blob</p></div><h2 id="create-connections-to-files-from-on-premises-or-cloud-based-windows-or-linux-machines"><span class="fontstyle0">Create connections to files from on-premises or cloud-based Windows or, Linux machines</span></h2><p><span class="fontstyle0">Azure Files can be used to replace on-premise file servers or NAS devices.</span> You can find an instruction on how to connect to Azure Files in my post <a href="/design-implement-arm-vm-azure-storage/#CreateAzureStorage" target="_blank" rel="noopener">“Design and Implement ARM VM Azure Storage”</a>. The instructions are for an Azure VM but you can do also do it with your on-premise machine.</p><h2 id="shard-large-datasets">Shard large datasets</h2><p>You can use containers to group related blobs that have the same security requirements. The partition key of a blob is the account name + container name + blob name. A single blob can only be served by a single server. If sharding is needed, you need to create multiple blobs.</p><h2 id="implement-azure-file-sync">Implement Azure File Sync</h2><p>Azure File Sync (AFS) helps you to automatically upload files from a Windows Server 2012 or 2016 server to the cloud.</p><p>Azure File Sync helps organizations to:</p><ul><li>Cache data in multiple locations for fast, local performance<li>Centralize file services in Azure storage<li>Eliminate local backup</ul><p>To enable AFS, follow these steps:</p><ol><li>Create a Windows server 2012 or 2016 file server and a storage account.<li>In the Azure portal, click on +Create a resource and search for Azure File Sync. Click on it and click on Create.<li>Provide a name, subscription, resource group and location and click Create.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Deploy-Storage-Sync.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Deploy-Storage-Sync.jpg" alt="Deploy Storage Sync" /></a><p> Deploy Storage Sync</p></div><ol start="4"><li> In your storage account, create a new file share.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-a-file-share-in-the-storage-account.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-a-file-share-in-the-storage-account.jpg" alt="Create a file share in the storage account" /></a><p> Create a file share in the storage account</p></div><ol start="5"><li> By now the Storage Sync Service should be deployed. Open it and click on +Sync group on the Overview blade.<li> On the Sync group blade, enter a name and select a subscription, a storage account, and a file share and click Create.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-a-Sync-group.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Create-a-Sync-group.jpg" alt="Create a Sync group" /></a><p> Create a Sync group</p></div><h3 id="set-up-the-file-server">Set up the file server</h3><ol start="7"><li> Next, you have to register your server. To do that, connect to your previously created Windows server and download the Azure Storage Sync agent from <a href="https://www.microsoft.com/en-us/download/details.aspx?id=55988&amp;irgwc=1&amp;OCID=AID681541_aff_7593_1211691&amp;tduid=(ir_QTvRPy13FRXOxFBQaey5FwDGUkj3vsTi2XGDXg0)(7593)(1211691)(TnL5HPStwNw-2IiLjGKY4WXhGNZVz0Xy7A)()&amp;irclickid=QTvRPy13FRXOxFBQaey5FwDGUkj3vsTi2XGDXg0" target="_blank" rel="noopener">here</a>.<li> You might have to disable enhanced security.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Disable-enhanced-security.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Disable-enhanced-security.jpg" alt="Disable enhanced security" /></a><p> Disable enhanced security</p></div><ol start="9"><li> After the installation is finished, start the Server Registration if it doesn&#8217;t start automatically. The default path is C:\Program Files\Azure\StorageSyncAgent.<li> If you see a warning that the pre-requisites are missing, you have to install the Azure PowerShell module.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Azure-File-Sync-Azure-PowerShell-Module-missing.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Azure-File-Sync-Azure-PowerShell-Module-missing.jpg" alt="Azure File Sync Azure PowerShell Module missing" /></a><p> Azure File Sync Azure PowerShell Module missing</p></div><ol start="11"><li> To install the Azure PowerShell module, open PowerShell and enter <span class="hljs-pscommand">Install-Module</span><span class="hljs-parameter"> -Name</span> AzureRM<span class="hljs-parameter"> -AllowClobber. &lt;/li&gt; &lt;/ol&gt;<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Install-the-Azure-PowerShell-Module.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Install-the-Azure-PowerShell-Module.jpg" alt="Install the Azure PowerShell Module" /></a><p> Install the Azure PowerShell module</p></div><ol start="12"><li> After the Azure PowerShell module is installed, you can sign in and register your server.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Sign-in-and-register-this-server.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Sign-in-and-register-this-server.jpg" alt="Sign in and register this server" /></a><p> Sign in and register this server</p></div>### Configure the Sync group<ol start="13"><li> After the server is set up, go back to your Storage Sync Service and open the previously created Sync group on the Overview blade.<li> On the Sync group blade, click on Add server endpoint and then select the previously registered server. Next, select a path which should be synchronized and then click Create.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Register-a-server-endpoint.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Register-a-server-endpoint.jpg" alt="Register a server endpoint" /></a><p> Register a server endpoint</p></div>### Test the Azure File Sync<ol start="15"><li> To test the file sync, copy some files into the sync folder.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Copy-files-into-the-sync-folder.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/Copy-files-into-the-sync-folder.jpg" alt="Copy files into the sync folder" /></a><p> Copy files into the sync folder</p></div><ol start="16"><li> To check if the files were synchronized, go to your file share in the storage account. There should be the files from your sync folder.</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/The-synchronize-process-was-successful.jpg"><img loading="lazy" src="/assets/img/posts/2018/04/The-synchronize-process-was-successful.jpg" alt="The synchronize process was successful" /></a><p> The synchronize process was successful</p></div>## Conclusion In this post, I talked about the different types of Azure Storage blobs and when they should be used. Furthermore, I showed how to implement Azure files as a file share for your cloud-based and on-premise machines. The last section was about implementing Azure File Sync to synchronize files from a server into the cloud. You can find the example code on <a href="https://github.com/WolfgangOfner/Azure-StorageAccount" target="_blank" rel="noopener">GitHub</a>. Don&#8217;t forget to replace the account name and access key placeholder with the name of your storage account and it&#8217;s access key. For more information about the 70-532 exam get the <a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener">Exam Ref book from Microsoft</a> and continue reading my blog posts. I am covering all topics needed to pass the exam. You can find an overview of all posts related to the 70-532 exam <a href="/prepared-for-the-70-532-exam/" target="_blank" rel="noopener">here</a>. </span></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>Cloud</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/70-532/" class="post-tag no-text-decoration" >70-532</a> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/certification/" class="post-tag no-text-decoration" >Certification</a> <a href="/tags/exam/" class="post-tag no-text-decoration" >Exam</a> <a href="/tags/learning/" class="post-tag no-text-decoration" >Learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implement Azure Storage blobs and Azure files - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implement Azure Storage blobs and Azure files - Programming With Wolfgang&u=https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Implement Azure Storage blobs and Azure files - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/microservice-series-from-zero-to-hero/">Microservice Series - From Zero to Hero</a><li><a href="/automatically-version-docker-container/">Automatically Version Docker Containers in Azure DevOps CI</a><li><a href="/deploy-microservices-to-multiple-environments-azure-devops/">Deploy Microservices to multiple Environments using Azure DevOps</a><li><a href="/implement-azure-service-fabric-apps/">Design and Implement Azure Service Fabric apps</a><li><a href="/implement-third-party-paas/">Design and implement third-party PaaS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/70-532/">70-532</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/implement-azure-service-fabric-apps/"><div class="card-body"> <span class="timeago small" > Jul 15, 2018 <i class="unloaded">2018-07-15T21:03:41+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design and Implement Azure Service Fabric apps</h3><div class="text-muted small"><p> Azure Service Fabric is a platform that makes it easy to package, deploy, and manage distributed solutions at scale. It provides an easy programming model for building microservice solutions with a...</p></div></div></a></div><div class="card"> <a href="/implement-third-party-paas/"><div class="card-body"> <span class="timeago small" > Jul 24, 2018 <i class="unloaded">2018-07-24T11:47:46+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design and implement third-party PaaS</h3><div class="text-muted small"><p> Azure support many third-party offerings and services through the Azure Marketplace. These can be deployed through the Azure portal, using ARM, or other CLI tools. Implement Cloud Foundry as a thi...</p></div></div></a></div><div class="card"> <a href="/design-and-implement-devops/"><div class="card-body"> <span class="timeago small" > Aug 9, 2018 <i class="unloaded">2018-08-09T22:22:12+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design and Implement DevOps</h3><div class="text-muted small"><p> DevOps is a combination of development (Dev) and Operations (Ops). The ultimate goal of DevOps is automation and repeatability which allows for increased deployment frequency without the burden tha...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/design-and-implement-devtest-labs/" class="btn btn-outline-primary"><p>Design and implement DevTest Labs</p></a> <a href="/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/" class="btn btn-outline-primary"><p>Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//programmingwithwolfgang.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://www.programmingwithwolfgang.com/implement-azure-storage-blobs-and-azure-files/'; this.page.identifier = '/implement-azure-storage-blobs-and-azure-files/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/wolfgang_ofner">Wolfgang Ofner</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/70-532/">70 532</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.programmingwithwolfgang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
