<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Built-in Filter in ASP.NET MVC" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="Filters provide a simple and elegant way to implement cross-cutting concerns in your ASP.NET MVC application. Filter achieve this by injecting code into the request processing. Examples of cross-cutting concerns are logging and authorization." /><meta property="og:description" content="Filters provide a simple and elegant way to implement cross-cutting concerns in your ASP.NET MVC application. Filter achieve this by injecting code into the request processing. Examples of cross-cutting concerns are logging and authorization." /><link rel="canonical" href="/built-filter-asp-net-mvc/" /><meta property="og:url" content="/built-filter-asp-net-mvc/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-20T16:53:11+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Built-in Filter in ASP.NET MVC" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2018-01-20T16:53:11+01:00","datePublished":"2018-01-20T16:53:11+01:00","description":"Filters provide a simple and elegant way to implement cross-cutting concerns in your ASP.NET MVC application. Filter achieve this by injecting code into the request processing. Examples of cross-cutting concerns are logging and authorization.","headline":"Built-in Filter in ASP.NET MVC","mainEntityOfPage":{"@type":"WebPage","@id":"/built-filter-asp-net-mvc/"},"url":"/built-filter-asp-net-mvc/"}</script><title>Built-in Filter in ASP.NET MVC | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/youtube/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>YOUTUBE</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Built-in Filter in ASP.NET MVC</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Built-in Filter in ASP.NET MVC</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1516463591" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 20, 2018 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2220 words"> <em>26 min</em></span> read</div></div><div class="post-content"><p>Filters provide a simple and elegant way to implement cross-cutting concerns in your ASP.NET MVC application. Filter achieve this by injecting code into the request processing. Examples of cross-cutting concerns are logging and authorization.</p><h2 id="five-types-of-filter"><span class="mr-2">Five Types of Filter</span><a href="#five-types-of-filter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ASP.NET MVC has five types of filter built-in which allow you to implement additional logic during the request processing.</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Filter Type<td> Interface<td> Default Implementation<td> Description<tr><td> Action<td> IActionFilter<td> ActionFilterAttribute<td> Runs before and after the action method<tr><td> Authentication<td> IAuthenticationFilter<td> None<td> Runs first, before any other filters or the<br /> action method and can run again after<br /> the authorization filters<tr><td> Authorization<td> IAuthorizationFilter<td> AuthorizeAttribute<td> Runs second, after authentication, but<br /> before any other filters or the action method<tr><td> Exception<td> IExceptionFilter<td> HandleErrorAttribute<td> Runs only if another filter, the action method,<br /> or the action result throws an exception<tr><td> Result<td> IResultFilter<td> ActionFilterAttribute<td> Runs before and after the action method</table></div></div><p>Before the framework invokes an action, it inspects the method definition to see if it has attributes. If the framework finds one, the methods of this attribute are invoked. As you can see, the ActionFilterAttribute is implemented by IActionFilter and IResultFilter. This class is abstract and enforces you to implement it. The AuthorizeAttribute and HandleErrorAttribute classes already contain useful features therefore you don’t have to derive from them.</p><h2 id="applying-a-filter-to-an-action-or-controller"><span class="mr-2">Applying a Filter to an Action or Controller</span><a href="#applying-a-filter-to-an-action-or-controller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It is possible to apply one or more filters to an action or controller. A filter which is often used is the Authorize attribute. If the Authorize attribute is applied to an action, only users which are logged in can invoke this action. If the attribute is applied to the controller, it applies to all actions.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Apply-filter-to-action-and-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Apply-filter-to-action-and-controller.jpg" alt="Apply filter to action and controller" data-proofer-ignore></a><p> Apply filter to action and controller</p></div><p>On the example above, I applied the Authorize attribute to the controller which means that every action of this controller can be invoked only by logged in users. Additionally, I applied the attribute to the DoAdminStuff and set the Roles to Admin which means that only users which have the admin role are allowed to invoke this action. This example also shows that some attributes can have a parameter to specify the action.</p><h2 id="applying-authorization-filters"><span class="mr-2">Applying Authorization Filters</span><a href="#applying-authorization-filters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the last section, I already used one of the two attributes of the Authorize attribute. <span class="fontstyle0">The available properties are: </span></p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> Users<td> Comma-separated usernames which are allowed<tr><td> Roles<td> Comma-separated role names</table></div></div><p>If several roles are declared, then the user must have at least one of these roles.</p><h2 id="applying-authentication-filters"><span class="mr-2">Applying Authentication Filters</span><a href="#applying-authentication-filters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Authentication filters run before any other filter and can also run after an action has been executed but before the ActionResult is processed.</p><h3 id="the-iauthenticationfilter-interface"><span class="mr-2">The IAuthenticationFilter Interface</span><a href="#the-iauthenticationfilter-interface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The Authentication filter implements IAuthenticationFilter which implements two methods:</p><ul><li><span class="fontstyle0">void OnAuthentication(AuthenticationContext context);</span><li><span class="fontstyle0">void OnAuthenticationChallenge(AuthenticationChallengeContext context);</span></ul><p>The <span class="fontstyle0">OnAuthenticationChallenge method is invoked whenever a request fails the authentication or authorization process. The parameter is an AuthenticationChallengeContext object which is derived from ControllerContext. The AuthenticationChallengeContext class has two useful properties:</span></p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> ActionDescriptor<td> Returns an ActionDescriptor that describes the action method to which the filter has been applied<tr><td> Result<td> Sets an ActionResult that expresses the result of the authentication challenge</table></div></div><h2 id="applying-exception-filters"><span class="mr-2">Applying Exception Filters</span><a href="#applying-exception-filters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Exception filters are only executed if an unhandled exception has been thrown when invoking an action. An exception can be thrown by:</p><ul><li>Another filter<li>The action itself<li>During the action result execution</ul><p>Microsoft provides the HandleErrorAttribute for exception handling. This class implements the IExceptionFilter interface. The HandleErrorAttribute class has three properties:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Type<td> Description<tr><td> ExceptionType<td> Type<td> The exception type handled by this filter. It will also handle exception types that inherit from the specified value but will ignore all others. The default value is System.Exception, which means that, by default, it will handle all standard exceptions.<tr><td> View<td> string<td> The name of the view template that this filter renders. If you do not specify a value, it takes  a default value of Error, so by default, it renders /Views/<currentControllerName>/ Error.cshtml or /Views/Shared/Error.cshtml. &lt;/td&gt; &lt;/tr&gt;<tr><td> Master<td> string<td> The name of the layout used when rendering this filter’s view. If you do not specify a value, the view uses its default layout page. &lt;/table&gt; &lt;/div&gt; As summary: When an unhandled exception of the type specified by ExceptionType is encountered, this filter will render the view specified by the View property If an exception occurs in your development environment, you will get the famous yellow screen of death. To prevent this from happening, you have to set the customsError attribute to the web.config file.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/CustommError-in-web.config.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/CustommError-in-web.config.jpg" alt="CustommError in web.config" data-proofer-ignore></a><p> CustommError in web.config</p></div>The customError attribute redirects the request to the location specified at the defaultRedirect attribute. The default value for the mode attribute is RemoteOnly, which means that all local requests see the yellow screen of death. ### Applying the HandleError attribute Applying the HandleError attribute to an action enables you to prevent the application from crashing and also enables you to provide some useful error message and help to the user. You can specify an ExceptionType and then send the request to a specific view and provide some information about what went wrong.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Apply-HandleError-on-an-action.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Apply-HandleError-on-an-action.jpg" alt="Apply HandleError on an action" data-proofer-ignore></a><p> Apply HandleError on an action</p></div>On the screenshot above, you can see two different versions of how to use the HandleError attribute. The first line with the attribute only would redirect to /Error/ErrorMessage because I defined this destination in the defaultRedirect attribute in the web.config. This page can only show a generic error message which might not help the user at all. Therefore you can also specify which exception might happen and then redirect the request to a specific view. In the example above, I redirect all ArgumentOutOfRangeException to the ErrorMessage view. This view can be either in the view folder of the controller or in the shared view folder. ### Displaying information with the HandleErrorInfo view model The HandleError attribute passes the HandleErrorInfo view model to your view. The properties of the HandleErrorInfo view model are:<div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Type<td> Description<tr><td> ActionName<td> string<td> <span class="fontstyle0">Returns the name of the action method that generated the exception</span><tr><td> ControllerName<td> string<td> <span class="fontstyle0">Returns the name of the controller that generated the exception</span><tr><td> Exception<td> Exception<td> <span class="fontstyle0">Returns the exception</span></table></div></div>In the ErrorMessage view, I can use this view model to give the user a proper error description and provide some help to solve the problem.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Hepful-error-message-in-the-view.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Hepful-error-message-in-the-view.jpg" alt="Hepful error message in the view" data-proofer-ignore></a><p> Helpful error message in the view</p></div>I know that my error message is not the best and I bet that you can come up with a better one. I also provided a link, so the user can easily return to the page where he came from. ## Applying Action Filters Action filters can be used for anything. I use them for performance checks to find problems with the execution of actions. ### Using the IActionFilter interface The IActionFilter interface has two methods: * void OnActionExecuting(ActionExecutingContext filterContext) * void OnActionExecuted(ActionExecutedContext filterContext) The OnActionExecuting method is called before an action method is invoked. The parameter, ActionExecutingContext has two properties:<div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Type<td> Description<tr><td> ActionDescriptor<td> ActionDescriptor<td> Provides details of the action method<tr><td> Result<td> ActionResult<td> The result for the action method. A filter can cancel the request by setting this property to a non-null value</table></div></div>The OnActionExecuted method is called after the action is completed and has 5 properties:<div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Type<td> Description<tr><td> ActionDescriptor<td> ActionDescriptor<td> Provides details of the action method<tr><td> Canceled<td> bool<td> Returns true if the action has been canceled by another filter<tr><td> Exception<td> Exception<td> Returns an exception thrown by another filter or by the action method<tr><td> ExceptionHandled<td> bool<td> Returns true if the exception has been handled<tr><td> Result<td> ActionResult<td> The result for the action method; a filter can cancel the request by setting this property to a non-null value</table></div></div>### Implementing an Action Filter I created a new class called MyActionAttribute which derives from FilterAttribute and IActionFilter. In the OnActionExecuting method, I check if the browser is Chrome. If the request comes from Chrome, I return an HttpUnauthorizedResult. Again, this is not the most useful implementation but I think you get what you can do with this method. For now, I don&#8217;t implement anything in the OnActionExecuted method. This is no problem. Just be careful because Visual Studio throws a NotImplementedException if you let Visual Studio create the method.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/The-action-filter-class-implementation.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/The-action-filter-class-implementation.jpg" alt="The action filter class implementation" data-proofer-ignore></a><p> The action filter class implementation</p></div>To use my new filter, I apply it to the CheckFilter action. Note that you don&#8217;t have to write MyActionAttribute when applying it as attribute. MyAction is enough.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Applying-the-action-filter-attribute-to-an-action.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Applying-the-action-filter-attribute-to-an-action.jpg" alt="Applying the action filter attribute to an action" data-proofer-ignore></a><p> Applying the action filter attribute to an action</p></div>When you call this action from Chrome, you can see that the access is denied for the user.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Result-of-the-action-filter.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Result-of-the-action-filter.jpg" alt="Result of the action filter" data-proofer-ignore></a><p> Result of the action filter</p></div>&nbsp;<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Unauthorized-result-in-Chrome.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Unauthorized-result-in-Chrome.jpg" alt="Unauthorized result in Chrome" data-proofer-ignore></a><p> Unauthorized result in Chrome</p></div>### Implementing the OnActionExecutedMethod As I already mentioned, I often use action filter to measure the execution time of an action. To do that, I start a Stopwatch in the OnActionExecuting method and stop it in the OnActionExecuted method. Afterwards, I print the execution time.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Implementation-of-the-PerformanceAction-attribute.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Implementation-of-the-PerformanceAction-attribute.jpg" alt="Implementation of the PerformanceAction attribute" data-proofer-ignore></a><p> Implementation of the PerformanceAction attribute</p></div>To see different results, I added Thread.Sleep with a random number, so that the execution will take somewhere between some milliseconds and two seconds.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Applying-the-PerformanceAction-attribute.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Applying-the-PerformanceAction-attribute.jpg" alt="Applying the PerformanceAction attribute" data-proofer-ignore></a><p> Applying the PerformanceAction attribute</p></div>The print of the execution time is printed before the content of the action because the action filter is executed before the result of the action is processed.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-filter.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-filter.jpg" alt="Result of performance test with the action filter" data-proofer-ignore></a><p> Result of performance test with the action filter</p></div>## Applying Result Filters The IResultFilter which is implemented by result filters has two methods: * void OnResultExecuting(ResultExecutingContext filterContext) * void OnResultExecuted(ResultExecutedContext filterContext) The OnResultExecuting method is called after an action has returned an action result but before this result is executed. The OnResultExecuted method is called after the action result is executed. The ResultExecutingContext and ResultExecutedContext parameter has the same properties as the action filter parameter and also have the same effects. ### Implementing a Result Filter To demonstrate how the result filter works, I repeat the performance test but this time I measure the time between the start and the end of the execution of the ActionResult. To do that, I implement the IResultFilter and work with the OnResultExecuting and OnResultExecuted method.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Implementation-of-the-ResultAction-attribute.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Implementation-of-the-ResultAction-attribute.jpg" alt="Implementation of the ResultAction attribute" data-proofer-ignore></a><p> Implementation of the ResultAction attribute</p></div>The next step is applying the filter to an action and call the action to see the result.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Applying-the-result-filter-attribute-to-an-action.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Applying-the-result-filter-attribute-to-an-action.jpg" alt="Applying the result filter attribute to an action" data-proofer-ignore></a><p> Applying the result filter attribute to an action</p></div>When you look at the output, you see a difference in the result of the action filter output. The print of the measured time is beneath the output of the action. This behavior is caused by the fact that the result filter is processed after the ActionResult. Therefore the result is printed and then afterward the measured time is added.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-filter-1.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-filter-1.jpg" alt="Result of performance test with the action filter" data-proofer-ignore></a><p> Result of performance test with the action filter</p></div>## Filtering without Filter In the previous examples, I showed how to create implementations of filters by implementing the desired interface. The Controller class already implements the IAuthenticationFilter, IAuthorizationFilter, IActionFilter, IResultFilter, and IExceptionFilter interfaces. It also provides empty virtual implementations for each of the methods. Knowing this, you can override the desired methods directly in the controller and achieve the same outcome as the filter classes did.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Applying-filtering-in-a-controller-without-filter-attributes.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Applying-filtering-in-a-controller-without-filter-attributes.jpg" alt="Applying filtering in a controller without filter attributes" data-proofer-ignore></a><p> Applying filtering in a controller without filter attributes</p></div>If you call the Index action of the FilteringWithoutFilter controller, you will see the same result as previously with the attributes. &nbsp;<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-and-result-filter.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Result-of-performance-test-with-the-action-and-result-filter.jpg" alt="Result of performance test with the action and result filter" data-proofer-ignore></a><p> Result of performance test with the action and result filter</p></div>I have to admit that I am not a big fan of this approach. The big advantage of ASP.NET MVC is Separation of Concerns. When using filtering within a controller, you lose this advantage. The only time when it might make sense to use filtering directly in a controller is when this class is a base class for other controllers. I recommend using the attribute approach. ### Simply combining Action and Result Filter If you look closely, you can see that I combine the action filter method OnActionExecuting and the result filter method OnResultExecuted. You can do this yourself by implementing the IActionFilter and IResultFilter interface or by deriving from ActionFilterAttribute which implements both interfaces. The advantage of deriving from ActionFilterAttribute is that you don&#8217;t have empty methods which are not implemented. ## Applying Global Filters If you want to apply filter to all your actions, you can use global filters. If you are using the MVC template, the framework already creates the FilterConfig.cs file under the App_Start folder. Since I didn&#8217;t use the template, I create the file myself. This class has one static method, RegisterGlobalFilters. The FilterConfig.cs is pretty similar to the RouteConfig.cs. To add a new filter, add it to the filters collection with add.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Register-a-filter-globally-in-FilterConfig.cs_.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Register-a-filter-globally-in-FilterConfig.cs_.jpg" alt="Register a filter globally in FilterConfig.cs" data-proofer-ignore></a><p> Register a filter globally in FilterConfig.cs</p></div>Note that the namespace is Filter, not Filter.App_Start. The HandleErrorAttribute will always be defined as global filter in ASP.NET MVC. It is not mandatory to define the HandleErrorAttribute as global filter but it is the default exception handling and will render the /Views/Shared/Error.cshtml view if an exception happens. To register a filter a, you have to pass an instance of the filter class. The name contains the Attribute prefix. If you use the class as attribute, you can omit the Attribute prefix. Additionally, you have to add the RegisterGlobalFilters call in the Global.asx file.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Content-of-the-Global.asx.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Content-of-the-Global.asx.jpg" alt="Content of the Global.asx" data-proofer-ignore></a><p> Content of the Global.asx</p></div>## Conclusion In this post, I showed all five types of built-in filters in the ASP.NET MVC framework and discussed how to use them to address cross-cutting concerns effectively. These filters help you to extend the logic of your controller and actions while a request is processed. For more details about how built-in filters work, I highly recommend the books <a href="http://amzn.to/2mgRbTy" target="_blank" rel="noopener">Pro ASP.NET MVC 5</a> and <a href="http://amzn.to/2mfQ0nA" target="_blank" rel="noopener">Pro ASP.NET MVC 5 Plattform</a>. You can find the source code on <a href="https://github.com/WolfgangOfner/MVC-Filter" target="_blank" rel="noopener">GitHub</a>. </currentControllerName></table></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/asp-net/'>ASP.NET</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/action/" class="post-tag no-text-decoration" >Action</a> <a href="/tags/attribute/" class="post-tag no-text-decoration" >Attribute</a> <a href="/tags/controller/" class="post-tag no-text-decoration" >Controller</a> <a href="/tags/filter/" class="post-tag no-text-decoration" >filter</a> <a href="/tags/mvc/" class="post-tag no-text-decoration" >MVC</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Built-in+Filter+in+ASP.NET+MVC+-+Programming+With+Wolfgang&url=%2Fbuilt-filter-asp-net-mvc%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Built-in+Filter+in+ASP.NET+MVC+-+Programming+With+Wolfgang&u=%2Fbuilt-filter-asp-net-mvc%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Built-in+Filter+in+ASP.NET+MVC+-+Programming+With+Wolfgang&url=%2Fbuilt-filter-asp-net-mvc%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fbuilt-filter-asp-net-mvc%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/video/">Video</a> <a class="post-tag" href="/tags/youtube/">Youtube</a> <a class="post-tag" href="/tags/conference/">Conference</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/controllers-and-actions/"><div class="card-body"> <em class="small" data-ts="1516031548" data-df="ll" > Jan 15, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Controllers and Actions</h3><div class="text-muted small"><p> In this post, I want to talk about how controllers and actions interact with each other and present several built-in functions.  The MVC Framework is endlessly customizable and extensible. As a res...</p></div></div></a></div><div class="card"> <a href="/routing-in-asp-net-mvc/"><div class="card-body"> <em class="small" data-ts="1515854053" data-df="ll" > Jan 13, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Routing in ASP.NET MVC</h3><div class="text-muted small"><p> Routing in ASP.NET MVC can be a really complex topic. In this post, I want to present the most used URL Patterns and explain how they work. Routing with Routes Routes can be created by adding the...</p></div></div></a></div><div class="card"> <a href="/unit-testing-controller-and-actions/"><div class="card-body"> <em class="small" data-ts="1516043413" data-df="ll" > Jan 15, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unit Testing Controllers and Actions</h3><div class="text-muted small"><p> In my last post, I showed how to work with controllers and actions. This included passing data, return types of actions and redirects. In this post, I want to check if my implemented features work ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/unit-testing-controller-and-actions/" class="btn btn-outline-primary" prompt="Older"><p>Unit Testing Controllers and Actions</p></a> <a href="/asp-net-mvc-bundles/" class="btn btn-outline-primary" prompt="Newer"><p>ASP.NET MVC Bundles</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/built-filter-asp-net-mvc/'; this.page.identifier = '/built-filter-asp-net-mvc/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/video/">Video</a> <a class="post-tag" href="/tags/youtube/">Youtube</a> <a class="post-tag" href="/tags/conference/">Conference</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
