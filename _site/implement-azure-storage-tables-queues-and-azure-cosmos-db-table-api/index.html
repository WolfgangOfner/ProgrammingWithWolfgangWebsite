<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="Azure Storage Tables can store tabular data at petabyte scale. Azure Queue storage is used to provide messaging between application components, as they can be de-coupled and scaled individually." /><meta property="og:description" content="Azure Storage Tables can store tabular data at petabyte scale. Azure Queue storage is used to provide messaging between application components, as they can be de-coupled and scaled individually." /><link rel="canonical" href="/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/" /><meta property="og:url" content="/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-04-10T12:40:08+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2018-04-10T12:40:08+02:00","datePublished":"2018-04-10T12:40:08+02:00","description":"Azure Storage Tables can store tabular data at petabyte scale. Azure Queue storage is used to provide messaging between application components, as they can be de-coupled and scaled individually.","headline":"Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API","mainEntityOfPage":{"@type":"WebPage","@id":"/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/"},"url":"/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/"}</script><title>Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/youtube/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>YOUTUBE</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Implement Azure Storage Tables, Queues, and Azure Cosmos DB Table API</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1523356808" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 10, 2018 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1995 words"> <em>23 min</em></span> read</div></div><div class="post-content"><p>Azure Storage Tables can store tabular data at petabyte scale. Azure Queue storage is used to provide messaging between application components, as they can be de-coupled and scaled individually.</p><h2 id="azure-storage-tables"><span class="mr-2">Azure Storage Tables</span><a href="#azure-storage-tables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Azure Tables are a key-value database solution with rows and columns. Tables store data as a collection of entities where each entity has a property. Azure Tables can have up to 255 properties (columns in relational databases). The maximum entity size (row size in a relational database) is 1 MB.</p><p>Azure Tables organize data based on table name. For example, all customers should be stored in the Customers table whereas all products should be stored in the Products table.</p><p>The tables store the entities based on a partition key and a row key. All entities stored with the same partition key property are grouped into the same partition and are served by the same partition server. The developer has to choose a good partition key. Having a few partitions will improve scalability, as it will increase the number of partition servers handling a request.</p><h3 id="azure-storagetables-vs-azure-sql-database"><span class="mr-2">Azure Storage Tables vs. Azure SQL Database</span><a href="#azure-storagetables-vs-azure-sql-database" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Microsoft Azure Tables does not enforce any schema for tables. It is the developer’s responsibility to enforce the schema on the client side. Azure Tables do not have stored procedures, triggers, indexes, constraints, default values and many more SQL Database features. The big advantage of Azure Tables is that you are not charged for compute resources for inserting, updating or retrieving data. You are only charged for the total storage you use. which makes it extremely affordable for large datasets. Azure Tables also scale very well without sacrificing performance</p><h3 id="using-basic-crud-operations"><span class="mr-2">Using basic CRUD operations</span><a href="#using-basic-crud-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This section will explain how to access table storage programmatically using C#. You can find the code for the following demo on <a href="https://github.com/WolfgangOfner/Azure-TableStorage" target="_blank" rel="noopener">GitHub</a>.</p><h4 id="creating-a-table"><span class="mr-2">Creating a table</span><a href="#creating-a-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Create a new C# console application.<li>Add the following code to your app.config file:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Setup-the-connection-string-to-your-storage-account.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Setup-the-connection-string-to-your-storage-account.jpg" alt="Setup the connection string to your storage account" data-proofer-ignore></a><p> Setup the connection string to your storage account</p></div><p>Replace the placeholder with your storage account name and storage account key</p><ol start="3"><li> Install the WindowsAzure.Storage NuGet package.<li> In the Main method, retrieve the connection string:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Retrieve-the-connection-string.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Retrieve-the-connection-string.jpg" alt="Retrieve the connection string" data-proofer-ignore></a><p> Retrieve the connection string</p></div><ol start="5"><li> With the following code can you create a table if it doesn&#8217;t exist:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-the-orders-table-if-it-does-not-exist.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Create-the-orders-table-if-it-does-not-exist.jpg" alt="Create the orders table if it does not exist" data-proofer-ignore></a><p> Create the orders table if it does not exist</p></div><h4 id="inserting-records"><span class="mr-2">Inserting records</span><a href="#inserting-records" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The following useful properties for adding entries to a table are provided by the Storage Client Library:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Property<td> Description<tr><td> Partition Key<td> The partition key is used to partition data across storage infrastructure<tr><td> Row Key:<td> The row key is a unique identifier in a partition<tr><td> Timestamp<td> Contains the time of the last update<tr><td> ETag<td> The ETag is used internally to provide optimistic concurrency</table></div></div><p>The combination of partition key and row key must be unique within the table. This combination is used for load balancing and scaling, as well as for querying and sorting entities.</p><p>To insert data into the previously created table, follow these steps:</p><ol><li>Add the following class:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/The-OrderEntity-class-will-be-used-to-add-orders-into-the-table.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/The-OrderEntity-class-will-be-used-to-add-orders-into-the-table.jpg" alt="The OrderEntity class will be used to add orders into the table" data-proofer-ignore></a><p> The OrderEntity class will be used to add orders into the table</p></div><ol start="2"><li> To add an order to the orders table, use the following code:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Insert-a-single-record-into-the-table.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Insert-a-single-record-into-the-table.jpg" alt="Insert a single record into the table" data-proofer-ignore></a><p> Insert a single record into the table</p></div><h4 id="insert-multiple-records-in-a-transaction"><span class="mr-2">Insert multiple records in a transaction</span><a href="#insert-multiple-records-in-a-transaction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>You can group inserts and other operations into a single batch transaction. You can have up to 100 entities in a batch but the batch size can’t be greater than 4 MB.</p><p>To insert multiple orders in one transaction, add this code to your application:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Insert-multiple-records-into-the-table.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Insert-multiple-records-into-the-table.jpg" alt="Insert multiple records into the table" data-proofer-ignore></a><p> Insert multiple records into the table</p></div><h4 id="getting-records-in-a-partition"><span class="mr-2">Getting records in a partition</span><a href="#getting-records-in-a-partition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>You can select all entities in a partition or a range of entities by partition and row key. Wherever possible, you should try to query with the partition key and row key. Querying entities by other properties does not work well because it launches a scan of the entire table.</p><p>Within a table, entities are ordered within the partition key. Within a partition, entities are ordered by the row key. The RowKey property is a string, therefore sorting is handled as a string sort. If you are using a date value for your row key, as I did in the previous example, use the order year month day, for example, 20181220.</p><p>The following code gets all records within a partition using the PartitionKey property:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Retrieve-all-records-of-the-table-with-the-partition-key-Wolfgang.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Retrieve-all-records-of-the-table-with-the-partition-key-Wolfgang.jpg" alt="Retrieve all records of the table with the partition key Wolfgang" data-proofer-ignore></a><p> Retrieve all records of the table with the partition key Wolfgang</p></div><h4 id="updating-records"><span class="mr-2">Updating records</span><a href="#updating-records" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To update records, you can use the InsertOrReplace() method. It creates a records if it does not exist and updates an existing one, based on the partition key and row key. Use the following code to do that:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Update-a-record-in-the-table.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Update-a-record-in-the-table.jpg" alt="Update a record in the table" data-proofer-ignore></a><p> Update a record in the table</p></div><h4 id="deleting-a-record"><span class="mr-2">Deleting a record</span><a href="#deleting-a-record" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>To delete a record, you have to retrieve it first and then call the Delete() method. Use the following code to do that:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Delete-a-record-from-the-table.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Delete-a-record-from-the-table.jpg" alt="Delete a record from the table" data-proofer-ignore></a><p> Delete a record from the table</p></div><h3 id="designing-managing-and-scaling-table-partitions"><span class="mr-2">Designing, managing, and scaling table partitions</span><a href="#designing-managing-and-scaling-table-partitions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As previously mentioned, tables are partitioned to allow massive scaling. The partition key is the unit of scale for storage tables. The table services will spread your table to multiple servers and key all rows with the same partition key co-located. Therefore, the partition key is an important grouping for querying and availability.</p><p>There are three types of partition keys:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Partition Key<td> Description<tr><td> Single Value<td> There is one partition key for the the entire table. This favors a small number of entities. It also makes batch transactions easier since batch transactions need to share a partition key. It does not scale well for large tables since all rows will be on the same partition server<tr><td> Multiple Values<td> This might place each partition on its own partition server. If the partition size is smaller, it is easier for Azure to load balance partitions. Partitions might get slower as the number of entities increases. This might make further partitioning necessary at some point.<tr><td> Unique values<td> This is for many small partitions. This is highly scalable, but batch transactions are not possible.</table></div></div><p>For query performance, you should use the partition key and row key always together, if possible. This returns an exact row match. The next best thing is to have an exact partition match with a row range. It is best to avoid scanning the entire table.</p><h2 id="azure-storage-queues"><span class="mr-2">Azure Storage Queues</span><a href="#azure-storage-queues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Azure Storage Queue provides a mechanism for reliable inter-application-messaging to support asynchronous distributed application workflows.</p><p>Queues are often used in an ordering or booking application. The customer orders or books something, for example, a plane ticket and gets an email confirmation a couple minutes later. The order gets put into a queue at the end of the ordering process and then gets processed by a separate application. This takes sometimes more, sometimes less time, depending on the workload. After the order is processed, the customer gets an email confirmation.</p><h3 id="adding-messages-to-a-queue"><span class="mr-2">Adding messages to a queue</span><a href="#adding-messages-to-a-queue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can find the following demo on <a href="https://github.com/WolfgangOfner/Azure-StorageQueue" target="_blank" rel="noopener">GitHub</a>.</p><ol><li>Create a new C# console application.<li>Add the following code to your app.config file:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Setup-the-connection-string-to-your-storage-account.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Setup-the-connection-string-to-your-storage-account.jpg" alt="Setup the connection string to your storage account" data-proofer-ignore></a><p> Setup the connection string to your storage account</p></div><p>Replace the placeholder with your storage account name and storage account key.</p><ol><li>Install the WindowsAzure.Storage NuGet package.<li>In the Main method, retrieve the connection string:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Retrieve-the-connection-string.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Retrieve-the-connection-string.jpg" alt="Retrieve the connection string" data-proofer-ignore></a><p> Retrieve the connection string</p></div><ol start="3"><li> You can create a queue with the following code:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Create-the-queue-queue-if-it-does-not-exist.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Create-the-queue-queue-if-it-does-not-exist.jpg" alt="Create the queue queue if it does not exist" data-proofer-ignore></a><p> Create the queue queue if it does not exist</p></div><ol start="4"><li> After the queue is created, add messages to it:</ol><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Add-three-messages-to-the-queue.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Add-three-messages-to-the-queue.jpg" alt="Add three messages to the queue" data-proofer-ignore></a><p> Add three messages to the queue</p></div><ol start="5"><li> In the Azure Portal, open your storage account and select Queues on the Overview blade. There, you can see your newly created queue and the three added messages.</ol><p><a href="/assets/img/posts/2018/04/Displaying-the-previously-added-messages-in-the-Azure-Portal.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 774 423'%3E%3C/svg%3E" loading="lazy" width="774" height="423" class="wp-image-1096" data-src="/assets/img/posts/2018/04/Displaying-the-previously-added-messages-in-the-Azure-Portal.jpg" alt="&quot;Displaying" data-proofer-ignore></a></p><p>On the screenshot above, you can see that every message in the queue got a unique ID assigned. This ID is used by the Storage Client Library to identify a message.</p><p>The maximum size for a message in a queue is 64 KB, but it is best practice to keep the messages as small as possible and to store any required data for processing in a durable store, such as Azure SQL or Azure Storage tables. The Azure Storage Queue can store messages up to seven days.</p><h3 id="processing-messages"><span class="mr-2">Processing messages</span><a href="#processing-messages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Messages are usually published by a different application from the application that listens for new messages to process them. For simplicity, I use the same application for publishing and listening in this demo. To de-queue a message use the following code:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Dequeue-a-single-message-from-the-queue-which-is-not-older-than-five-minutes.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Dequeue-a-single-message-from-the-queue-which-is-not-older-than-five-minutes.jpg" alt="Dequeue a single message from the queue which is not older than five minutes" data-proofer-ignore></a><p> Dequeue a single message from the queue which is not older than five minutes</p></div><p>The code returns the oldest message, which is not older than five minutes.</p><h3 id="retrieving-a-batch-of-messages"><span class="mr-2">Retrieving a batch of messages</span><a href="#retrieving-a-batch-of-messages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A queue listener can be implemented as single-threaded (processing one message at a time) or multi-threaded (processing messages in a batch on separate threads). You can retrieve up to 32 messages from a queue using GetMessages() to process multiple messages in parallel. To get more than one message with GetMessages(), specify the number of items which should be de-queued:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/04/Dequeue-multiple-messages-from-the-queue.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/04/Dequeue-multiple-messages-from-the-queue.jpg" alt="Dequeue multiple messages from the queue" data-proofer-ignore></a><p> Dequeue multiple messages from the queue</p></div><p>Consider the overhead of message processing before deciding the appropriate number of messages to process in parallel. If significant memory, disk space, or other network resources are used during processing, throttling parallel processing to an acceptable number will be necessary to avoid performance degradation on the compute instance.</p><h3 id="scaling-queues"><span class="mr-2">Scaling queues</span><a href="#scaling-queues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Each individual queue has a target of approximately 20,000 messages per second. You can partition your application to use multiple queues to increase this throughput.</p><p>It is more cost-effective and efficient to pull multiple messages from the queue for processing in parallel on a single compute node. However, this depends on the type of processing and resources required. Scaling out compute nodes to increase processing throughput is usually also required.</p><p>You can configure VMs or cloud services to auto-scale by queue. You can specify the average number of messages to be processed per instance, and the auto-scale algorithm will queue to run scale actions to increase or decrease available instances accordingly.</p><h2 id="choose-between-azure-storage-tables-and-azure-cosmos-db-table-api"><span class="mr-2">Choose between Azure Storage Tables and Azure Cosmos DB Table API</span><a href="#choose-between-azure-storage-tables-and-azure-cosmos-db-table-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Azure Cosmos DB is a cloud-hosted, NoSQL database. A NoSQL database can be key/value stores, table stores, and graph stores. Azure Cosmos DB Table API is a key value store that is very similar to Azure Storage Tables.</p><p>The main differences are:</p><ol><li>Azure Table Storage only supports a single region with one optional secondary for high availability. Cosmos DB supports over 30 regions.<li>Azure Table Storage only indexes the partition and the row key. Cosmos DB automatically indexes all properties.<li>Azure Cosmos DB is much faster, with latency lower than 10 ms on reads and 15 ms on writes at any scale.<li>Azure Table Storage only supports strong or eventual consistency. Stronger consistency means less overall throughput and concurrent performance while having more up to date data. Eventual consistency allows for high concurrent throughput but you might see older data. Azure Cosmos DB supports five different consistency models and allows those models to be specified at the session level. This means that on user or feature might have a different consistency level than a different user or feature.<li>Azure Table Storage only charges for the storage you use. This makes it very affordable. Azure Cosmos DB on the other side charges for Request Units (RU) which really is a way for a PaaS product to charge for computer fees. If you need more RUs, you can scale them up. This makes Cosmos DB significantly more expensive than Azure Storage Tables.</ol><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this post, I talked about how to use Azure Storage Tables and Azure Storage Queues. I showed how to programmatically access both and how to add, retrieve, and remove data. Then, I talked about how to scale Azure Storage Tables and Azure Storage Queues. The last section was a comparison between Azure Storage Tables and Azure Cosmos DB.</p><p>You can find the demo code for the Azure Storage Table <a href="https://github.com/WolfgangOfner/Azure-TableStorage" target="_blank" rel="noopener">here</a> and the demo code for the Azure Storage Queues <a href="https://github.com/WolfgangOfner/Azure-StorageQueue" target="_blank" rel="noopener">here</a>.</p><p>For more information about the 70-532 exam get the <a href="http://amzn.to/2EWNWMF" target="_blank" rel="noopener">Exam Ref book from Microsoft</a> and continue reading my blog posts. I am covering all topics needed to pass the exam. You can find an overview of all posts related to the 70-532 exam <a href="/prepared-for-the-70-532-exam/" target="_blank" rel="noopener">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>Cloud</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/70-532/" class="post-tag no-text-decoration" >70-532</a> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/certification/" class="post-tag no-text-decoration" >Certification</a> <a href="/tags/exam/" class="post-tag no-text-decoration" >Exam</a> <a href="/tags/learning/" class="post-tag no-text-decoration" >Learning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implement+Azure+Storage+Tables%2C+Queues%2C+and+Azure+Cosmos+DB+Table+API+-+Programming+With+Wolfgang&url=%2Fimplement-azure-storage-tables-queues-and-azure-cosmos-db-table-api%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implement+Azure+Storage+Tables%2C+Queues%2C+and+Azure+Cosmos+DB+Table+API+-+Programming+With+Wolfgang&u=%2Fimplement-azure-storage-tables-queues-and-azure-cosmos-db-table-api%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Implement+Azure+Storage+Tables%2C+Queues%2C+and+Azure+Cosmos+DB+Table+API+-+Programming+With+Wolfgang&url=%2Fimplement-azure-storage-tables-queues-and-azure-cosmos-db-table-api%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fimplement-azure-storage-tables-queues-and-azure-cosmos-db-table-api%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/youtube/">Youtube</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/prepared-for-the-70-532-exam/"><div class="card-body"> <em class="small" data-ts="1519392828" data-df="ll" > Feb 23, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I prepared for the 70-532 Exam</h3><div class="text-muted small"><p> Recently I started to prepare for the Microsoft certification exam 70-532 “Developing Microsoft Azure Solutions” using the official Exam Ref book. This post contains a comprehensive list of blog po...</p></div></div></a></div><div class="card"> <a href="/deploy-workload-on-azure-arm-virtual-machines/"><div class="card-body"> <em class="small" data-ts="1520255937" data-df="ll" > Mar 5, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploy workload on Azure ARM virtual machines</h3><div class="text-muted small"><p> Azure ARM virtual machines can run a lot of different operating systems. In this posts, I will give an overview of these different types and I will also show how to create them in the Azure Portal....</p></div></div></a></div><div class="card"> <a href="/perform-configuration-management/"><div class="card-body"> <em class="small" data-ts="1520335271" data-df="ll" > Mar 6, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Perform Configuration Management</h3><div class="text-muted small"><p> In this post, I want to show how to use Windows PowerShell Desired State Configuration (DSC) and the VM Agent to perform various configuration management tasks like remote debugging and at the end,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/implement-azure-storage-blobs-and-azure-files/" class="btn btn-outline-primary" prompt="Older"><p>Implement Azure Storage blobs and Azure files</p></a> <a href="/manage-access-and-monitor-storage/" class="btn btn-outline-primary" prompt="Newer"><p>Manage access and monitor storage</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/'; this.page.identifier = '/implement-azure-storage-tables-queues-and-azure-cosmos-db-table-api/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/youtube/">Youtube</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
