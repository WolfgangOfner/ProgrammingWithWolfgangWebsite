<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Implement AAD Authentication to access Azure SQL Databases" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="Using Azure Active Directory authentication to access data from an Azure SQL Server can be implemented easily and helps you to go passwordless." /><meta property="og:description" content="Using Azure Active Directory authentication to access data from an Azure SQL Server can be implemented easily and helps you to go passwordless." /><link rel="canonical" href="/implement-aad-authentication-to-access-azure-sql-databases/" /><meta property="og:url" content="/implement-aad-authentication-to-access-azure-sql-databases/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-01T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Implement AAD Authentication to access Azure SQL Databases" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2021-11-01T00:00:00+01:00","datePublished":"2021-11-01T00:00:00+01:00","description":"Using Azure Active Directory authentication to access data from an Azure SQL Server can be implemented easily and helps you to go passwordless.","headline":"Implement AAD Authentication to access Azure SQL Databases","mainEntityOfPage":{"@type":"WebPage","@id":"/implement-aad-authentication-to-access-azure-sql-databases/"},"url":"/implement-aad-authentication-to-access-azure-sql-databases/"}</script><title>Implement AAD Authentication to access Azure SQL Databases | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/videos/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>VIDEOS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Implement AAD Authentication to access Azure SQL Databases</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Implement AAD Authentication to access Azure SQL Databases</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1635721200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 1, 2021 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1337 words"> <em>15 min</em></span> read</div></div><div class="post-content"><p>Microsoft promotes going passwordless for a while now. Azure offers authentication against the Azure Active Directory where applications can acquire access tokens using their identity. Another use case would be accessing an SQL database running on Azure. Although, in theory, this sounds very easy, my experience showed that it can get tricky.</p><p>Today I want to show you how to configure Azure SQL with Azure Active Directory authentication and how to avoid annoying pitfalls.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p><h2 id="configure-aad-authentication-for-an-azure-sql-server"><span class="mr-2">Configure AAD Authentication for an Azure SQL Server</span><a href="#configure-aad-authentication-for-an-azure-sql-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/tree/master/CustomerApi" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>In one of my previous posts, I created an SQL Server that runs all my databases. If you also have an SQL server, you have to set an Active Directory admin. This admin can be either an AAD user or a group. Without this admin, the SQL server won’t be able to authenticate your users against the AAD.</p><p>You can either use the Azure portal or Azure CLI to set the Active Directory admin. If you use the portal, open your SQL server and select the Active Directory admin pane. There, click on Set admin, search for your user or group and save your selection.</p><p>If you use the Azure CLI, use the following query to get all AAD users:</p><script src="https://gist.github.com/WolfgangOfner/2a369b0bd181aaec0219fc066d7fc215.js"></script><p>The –query parameter filters the response to only display the principal name of the AAD user.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Get-the-principal-name-of-all-AAD-users.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Get-the-principal-name-of-all-AAD-users.jpg" alt="Get the principal name of all AAD users" data-proofer-ignore></a><p> Get the principal name of all AAD users</p></div><p>My AAD currently has only one user and therefore returns only this one principal name. Once you know the principal name of the group or user you want to set as admin, you can filter using the –filter flag so your query only returns this one entity. Save the return value in a variable, so you can reuse it in the next step.</p><script src="https://gist.github.com/WolfgangOfner/fc620c85759c02f6ef8d58f5db8696f9.js"></script><p>With the user set to the variable, use the following command to set the Active Directory admin. Replace the resource group and server name with your corresponding values.</p><script src="https://gist.github.com/WolfgangOfner/40e53882bd0d349e93a7101783148bc7.js"></script><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Set-the-Active-Directory-admin.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Set-the-Active-Directory-admin.jpg" alt="Set the Active Directory admin" data-proofer-ignore></a><p> Set the Active Directory admin</p></div><h2 id="configure-the-test-application-to-use-aad-authentication"><span class="mr-2">Configure the Test Application to use AAD Authentication</span><a href="#configure-the-test-application-to-use-aad-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/tree/master/CustomerApi" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>Open the SQL management tool of your choice, for me, it’s Microsoft SQL Server Management Studio (SSMS), and log in with the user you previously set as the Active Directory admin.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Log-in-using-the-server-admin-user.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Log-in-using-the-server-admin-user.jpg" alt="Log in using the server admin user" data-proofer-ignore></a><p> Log in using the server admin user</p></div><p>You should be able to log in and see all the databases on the server.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/The-login-was-successful.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/The-login-was-successful.jpg" alt="The login was successful" data-proofer-ignore></a><p> The-login-was-successful</p></div><p>Now it is time to test the login with a test application. To use AAD authentication when developing, you have to sign in to Visual Studio. Visual Studio then uses this user to request an access token and authenticate you to the SQL server. Since you should not use the admin account for your application, I log in with a different user.</p><p>Before you can use your test application, you have to make some small changes. First, install the following NuGet packages:</p><script src="https://gist.github.com/WolfgangOfner/ac7e15877b4f3d482ba16bb0c3b214ab.js"></script><p>Next, create a custom SQL authentication provider. This class requests an access token from the AAD.</p><script src="https://gist.github.com/WolfgangOfner/4faaf043f6fed35b567e61b71e2024d7.js"></script><p>With the authentication provider set up, register your DbContext in the Startup.cs class and add the previously created authentication provider.</p><script src="https://gist.github.com/WolfgangOfner/df5aeda2699ce2218a0e771b7864ccc8.js"></script><p>Lastly, set the following connection string in your appsettings.json file.</p><script src="https://gist.github.com/WolfgangOfner/a3b7c8ee3529784c771142559c03002e.js"></script><h2 id="testing-the-aad-authentication"><span class="mr-2">Testing the AAD Authentication</span><a href="#testing-the-aad-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are using my demo application, make sure that you have set the “UseInMemoryDatabase” setting in the appsettings.json and appsettings.Development.json files to false. Otherwise, the application will use an in-memory database.</p><p>When you start the demo application, you will see the Swagger UI. Execute the Get request for Customer and you will see the following error message:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/The-login-to-the-Customer-database-failed.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/The-login-to-the-Customer-database-failed.jpg" alt="The-login-to-the-Customer-database-failed" data-proofer-ignore></a><p> The-login-to-the-Customer-database-failed</p></div><p>The login failed because the user logged in to Visual Studio has no access to the Customer database. You have to add your users to the database before they can access it.</p><h3 id="add-users-to-your-database"><span class="mr-2">Add Users to your Database</span><a href="#add-users-to-your-database" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Log in to the database with the user you previously set as the admin. Add your Visual Studio user with the following code and also give the user the desired roles.</p><script src="https://gist.github.com/WolfgangOfner/9141fb00fad16c11cee75d3e756b931c.js"></script><p>Now you should be able to log in with this user. If you use SSMS, make sure that you select the Customer database as the default database. If you don’t set Customer as your default database, SSMS will use the Master database and since the user does not exist in this database, the login will fail.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/The-user-does-not-exist-in-the-Master-database.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/The-user-does-not-exist-in-the-Master-database.jpg" alt="The user does not exist in the Master database" data-proofer-ignore></a><p> The user does not exist in the Master database</p></div><h2 id="try-the-test-application-again"><span class="mr-2">Try the Test Application again</span><a href="#try-the-test-application-again" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Start the test application and execute the Get request again. This time you should get some customers. You may get the following error though:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Login-to-the-SQL-server-failed.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Login-to-the-SQL-server-failed.jpg" alt="Login to the SQL server failed" data-proofer-ignore></a><p> Login to the SQL server failed</p></div><p>If you google this error message, you won’t find much helpful information. Also, Microsoft’s documentation doesn’t mention anything about this error.</p><p>The problem you encounter here is that your user exists in multiple tenants and the authentication provider does not know which tenant it should use. To fix this problem, you have to add the tenant where the SQL server resides to your authentication provider.</p><script src="https://gist.github.com/WolfgangOfner/ff225ea73729718378fbafe7b4a4e412.js"></script><p>Replace the XXX with your actual tenant Id.</p><p>Run your application again and now you should be able to retrieve the data from the database.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Successfully-retrieved-data-from-the-database.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Successfully-retrieved-data-from-the-database.jpg" alt="Successfully retrieved data from the database" data-proofer-ignore></a><p> Successfully retrieved data from the database</p></div><p>To verify that you loaded the data from the right database, log in to your database using SSMS and query the Customers in your Customer database. The result should be the same as you saw previously in your test application.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/11/Query-customers-from-the-database-using-SSMS.jpg"><img loading="lazy" data-src="/assets/img/posts/2021/11/Query-customers-from-the-database-using-SSMS.jpg" alt="Query customers from the database using SSMS" data-proofer-ignore></a><p> Query customers from the database using SSMS</p></div><h2 id="improving-the-test-application"><span class="mr-2">Improving the Test Application</span><a href="#improving-the-test-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The test application can retrieve data using the AAD authentication but the code is not pretty yet. Especially the part where the tenant Id is hard-coded into the authentication provider. Let’s improve this code a bit.</p><p>First add a new property, TenantId to the appsettings.json file.</p><script src="https://gist.github.com/WolfgangOfner/0097a26acdf4da885007bb9c39134765.js"></script><p>Next, add a constructor to your CustomAzureSqlAuthProvider with a string as the parameter. This string will contain the tenant Id. Assign the parameter to a private variable. Then replace the hard-coded tenant Id with the new private variable.</p><script src="https://gist.github.com/WolfgangOfner/e45dd2710f31631e342d0fcacc2e9e07.js"></script><p>Lastly, read the value of the tenant Id from the appsettings.json file and pass it to the constructor of your authentication provider in the Startup.cs class.</p><script src="https://gist.github.com/WolfgangOfner/2623f3a357887415caa6a529ae240219.js"></script><p>Run your application again to make sure that everything still works.</p><h2 id="pass-the-tenant-id-during-the-deployment"><span class="mr-2">Pass the Tenant Id during the Deployment</span><a href="#pass-the-tenant-id-during-the-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You want to pass the tenant id during the deployment to keep it secret. If you commit it to your version control, everyone would be able to read it. You have to take the following steps to pass the tenant id during the deployment:</p><p>Add a variable for the tenant id to your values.yaml file in your Helm chart. This variable has to start and finish with two underscores (__) so the Tokenizer task in the Azure DevOps pipeline can replace the value. Next, add your tenant id as a secret variable in your pipeline. Don’t forget to update the connection string in your deployment pipeline too.</p><p>The Tokenizer task will replace the tenant id in the Helm chart with your actual tenant id and therefore will override the empty TenantId value in your appsettings.json file. For a detailed explanation of how and why this works, see <a href="/replace-helm-variables-tokenizer">Replace Helm Chart Variables in your CI/CD Pipeline with Tokenizer</a>.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Azure Active Directory authentication to access your databases is a great feature to get rid of passwords. This should also streamline the development process since you don’t have to share passwords with new developers. All you have to do is to add the developer to the desired database so they can log in.</p><p>There may be some roadblocks on the way and Microsoft’s documentation only showcases the happy path of the integration. This post should help you with the most common pitfalls and shows how to avoid them.</p><p><a href="/aad-authentication-for-applications-running-in-aks-to-access-azure-sql-databases">In my next post</a>, I will show you how to use AAD authentication with your application running in AKS.</p><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/tree/master/CustomerApi" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cloud/'>Cloud</a>, <a href='/categories/programming/'>Programming</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/sql/" class="post-tag no-text-decoration" >SQL</a> <a href="/tags/aad/" class="post-tag no-text-decoration" >AAD</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C#</a> <a href="/tags/net/" class="post-tag no-text-decoration" >.NET</a> <a href="/tags/entity-framework-core/" class="post-tag no-text-decoration" >Entity Framework Core</a> <a href="/tags/azure-cli/" class="post-tag no-text-decoration" >Azure CLI</a> <a href="/tags/azure-sql/" class="post-tag no-text-decoration" >Azure SQL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implement+AAD+Authentication+to+access+Azure+SQL+Databases+-+Programming+With+Wolfgang&url=%2Fimplement-aad-authentication-to-access-azure-sql-databases%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implement+AAD+Authentication+to+access+Azure+SQL+Databases+-+Programming+With+Wolfgang&u=%2Fimplement-aad-authentication-to-access-azure-sql-databases%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Implement+AAD+Authentication+to+access+Azure+SQL+Databases+-+Programming+With+Wolfgang&url=%2Fimplement-aad-authentication-to-access-azure-sql-databases%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fimplement-aad-authentication-to-access-azure-sql-databases%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/aad-authentication-for-applications-running-in-aks-to-access-azure-sql-databases/"><div class="card-body"> <em class="small" data-ts="1638745200" data-df="ll" > Dec 6, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Use AAD Authentication for Applications running in AKS to access Azure SQL Databases</h3><div class="text-muted small"><p> Removing passwords and using identities to access resources is the way to go for new applications. In my last posts Use AAD Authentication for Pods running in AKS and Implement AAD Authentication t...</p></div></div></a></div><div class="card"> <a href="/microservice-series-from-zero-to-hero/"><div class="card-body"> <em class="small" data-ts="1610838000" data-df="ll" > Jan 17, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Microservice Series - From Zero to Hero</h3><div class="text-muted small"><p> I am working as a consultant and software architect on different projects that focus on microservices, DevOps, and Kubernetes. Many of my consulting jobs consist of explaining microservices, why th...</p></div></div></a></div><div class="card"> <a href="/article-captain-in-the-service-orchestra/"><div class="card-body"> <em class="small" data-ts="1608246000" data-df="ll" > Dec 18, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Article - Captain in the Service Orchestra</h3><div class="text-muted small"><p> I am thrilled to announce that I am writing my first article for the German magazine, “windows .developer”. The article, titled “Captain in the Service Orchestra”, was published in the December 202...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/use-aad-authentication-for-pods-running-in-aks/" class="btn btn-outline-primary" prompt="Older"><p>Use AAD Authentication for Pods running in AKS</p></a> <a href="/automatically-set-service-bus-queue-connection-string-during-deployment/" class="btn btn-outline-primary" prompt="Newer"><p>Automatically set Azure Service Bus Queue Connection Strings during the Deployment</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/implement-aad-authentication-to-access-azure-sql-databases/'; this.page.identifier = '/implement-aad-authentication-to-access-azure-sql-databases/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
