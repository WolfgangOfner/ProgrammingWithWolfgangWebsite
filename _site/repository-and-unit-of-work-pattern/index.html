<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Repository and Unit of Work Pattern" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="The Repository pattern and Unit of Work pattern are used together most of the time. Therefore, I will combine them in this post and show how to implement them both." /><meta property="og:description" content="The Repository pattern and Unit of Work pattern are used together most of the time. Therefore, I will combine them in this post and show how to implement them both." /><link rel="canonical" href="/repository-and-unit-of-work-pattern/" /><meta property="og:url" content="/repository-and-unit-of-work-pattern/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-09T19:32:51+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Repository and Unit of Work Pattern" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2018-01-09T19:32:51+01:00","datePublished":"2018-01-09T19:32:51+01:00","description":"The Repository pattern and Unit of Work pattern are used together most of the time. Therefore, I will combine them in this post and show how to implement them both.","headline":"Repository and Unit of Work Pattern","mainEntityOfPage":{"@type":"WebPage","@id":"/repository-and-unit-of-work-pattern/"},"url":"/repository-and-unit-of-work-pattern/"}</script><title>Repository and Unit of Work Pattern | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/videos/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>VIDEOS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Repository and Unit of Work Pattern</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Repository and Unit of Work Pattern</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1515522771" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 9, 2018 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1357 words"> <em>15 min</em></span> read</div></div><div class="post-content"><p>The Repository pattern and Unit of Work pattern are used together most of the time. Therefore I will combine them in this post and show how to implement them both.</p><h2 id="definition-repository"><span class="mr-2">Definition Repository</span><a href="#definition-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Repository mediates between the domain and data mapping layers, acting like an in-memory collection of domain objects. (<a href="http://amzn.to/2CGvtzn" target="_blank" rel="noopener">“Patterns of Enterprise Application Architecture”</a> by Martin Fowler)</p><h2 id="repository-pattern-goals"><span class="mr-2">Repository Pattern Goals</span><a href="#repository-pattern-goals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Decouple Business code from data Access. As a result, the persistence Framework can be changed without a great effort<li>Separation of Concerns<li>Minimize duplicate query logic<li>Testability</ul><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Repository pattern is often used when an application performs data access operations. These operations can be on a database, Web Service or file storage. The repository encapsulates These operations so that it doesn’t matter to the business logic where the operations are performed. For example, the business logic performs the method GetAllCustomers() and expects to get all available customers. The application doesn’t care whether they are loaded from a database or web service.</p><p>The repository should look like an in-memory collection and should have generic methods like Add, Remove or FindById. With such generic methods, the repository can be easily reused in different applications.</p><p>Additionally to the generic repository, one or more specific repositories, which inherit from the generic repository, are implemented. These specialized repositories have methods which are needed by the application. For example, if the application is working with customers the CustomerRepository might have a method GetCustomersWithHighestRevenue.</p><p>With the data access set up, I need a way to keep track of the changes. Therefore I use the Unit of Work pattern.</p><h2 id="definition-unit-of-work"><span class="mr-2">Definition Unit of Work</span><a href="#definition-unit-of-work" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Maintains a list of objects affected by a business transaction and coordinates the writing out of changes.  (<a href="http://amzn.to/2CGvtzn" target="_blank" rel="noopener">“Patterns of Enterprise Application Architecture”</a> by Martin Fowler)</p><h2 id="consequences-of-the-unit-of-work-pattern"><span class="mr-2">Consequences of the Unit of Work Pattern</span><a href="#consequences-of-the-unit-of-work-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Increases the level of abstraction and keep business logic free of data access code<li>Increased maintainability, flexibility and testability<li>More classes and interfaces but less duplicated code<li>The business logic is further away from the data because the repository abstracts the infrastructure. This has the effect that it might be harder to optimize certain operations which are performed against the data source.</ul><h2 id="does-entity-framework-implement-the-repository-and-unit-of-work-pattern"><span class="mr-2">Does Entity Framework implement the Repository and Unit of Work Pattern?</span><a href="#does-entity-framework-implement-the-repository-and-unit-of-work-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Entity Framework has a DbSet class which has Add and Remove method and therefore looks like a repository.  the DbContext class has the method SaveChanges and so looks like the unit of work. Therefore I thought that it is possible to use entity framework and have all the Advantages of the Repository and Unit of Work pattern out of the box. After taking a deeper look, I realized that that’s not the case.</p><p>The problem with DbSet is that its Linq statements are often big queries which are repeated all over the code. This makes to code harder to read and harder to change. Therefore it does not replace a repository.</p><p>The problem when using DbContext is that the code is tightly coupled to entity framework and therefore is really hard, if not impossible to replace it if needed.</p><h2 id="repositorypattern-and-unit-of-work-pattern-uml-diagram"><span class="mr-2">Repository Pattern and Unit of Work Pattern UML Diagram</span><a href="#repositorypattern-and-unit-of-work-pattern-uml-diagram" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2018/01/Repository-pattern-UML-diagram.jpg"><img loading="lazy" data-src="/assets/img/posts/2018/01/Repository-pattern-UML-diagram.jpg" alt="Repository pattern UML diagram" data-proofer-ignore></a><p> Repository pattern UML diagram</p></div><p>The Repository pattern consists of one IRepository which contains all generic operations like Add or Remove. It is implemented by the Repository and by all IConcreteRepository interfaces. Every IConcreteRepository interface is implemented by one ConcreteRepository class which also derives from the Repository class. With this implementation, the ConcreteRepositoy has all generic methods and also the methods for the specific class. As an example: the CustomerRepository could implement a method which is called GetAllSeniorCustomers or GetBestCustomersByRevenue.</p><p><a href="/assets/img/posts/2018/01/Unit-of-Work-pattern-UML-diagram.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 292 400'%3E%3C/svg%3E" loading="lazy" class="aligncenter wp-image-530" data-src="/assets/img/posts/2018/01/Unit-of-Work-pattern-UML-diagram.jpg" alt="Unit of Work pattern UML diagram" width="292" height="400" data-proofer-ignore></a></p><p>The unit of work provides the ability to save the changes to the storage (whatever this storage is). The IUnitOfWork interface has a method for saving which is often called Complete and every concrete repository as property. For example, if I have the repository ICustomerRepository then the IUnitOfWork has an ICustomerRepositry property with a getter only. Additionally, IUnitOfWork inherits from IDisposable.</p><p>The UnitOfWork class implements the Complete method, in which the data get saved to the data storage. The advantage of this implementation is that wherever you want to save something you only have to call the Complete method from UnitOfWork and don’t care about where it gets saved.</p><h2 id="implementation-of-the-repository-and-unit-of-work-pattern"><span class="mr-2">Implementation of the Repository and Unit of Work Pattern</span><a href="#implementation-of-the-repository-and-unit-of-work-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For this example, I created a console project (RepositoryAndUnitOfWork) and a class library (RepositoryAndUnitOfWork.DataAccess). In the class library, I generate a database with a customer table.</p><h2><a href="/assets/img/posts/2018/01/Customer-Table.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 393 228'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-528" data-src="/assets/img/posts/2018/01/Customer-Table.jpg" alt="" width="393" height="228" data-proofer-ignore></a></h2><p>Next, I let Entity Framework generate the data model from the database. If you don’t know how to do that, check the <a href="https://msdn.microsoft.com/en-us/library/jj206878(v=vs.113).aspx" target="_blank" rel="noopener">documentation</a> for a step by step walkthrough.</p><h3 id="implementing-repositories"><span class="mr-2">Implementing Repositories</span><a href="#implementing-repositories" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After setting up the database, it’s time to implement the repository. To do that, I create a new folder, Repositories, in the class library project and add a new interface IRepositry. In this Interface, I add all generic methods I want to use later in my applications. These methods are, GetById, Add, AddRange, Remove or Find. To make the Interface usable for all classes I use the generic type parameter T, where T is a class.</p><p><a href="/assets/img/posts/2018/01/IRepository.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 453 355'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-516" data-src="/assets/img/posts/2018/01/IRepository.jpg" alt="IRepository" width="453" height="355" data-proofer-ignore></a></p><p>After the generic repository, I also implement a specific repository for the customer. The ICustomerRepository inherits from IRepository and only implements one method.</p><p><a href="/assets/img/posts/2018/01/ICustomerRepository.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 471 87'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-517" data-src="/assets/img/posts/2018/01/ICustomerRepository.jpg" alt="ICustomerRepository" width="471" height="87" data-proofer-ignore></a></p><p>After implementing all interfaces it’s time to implement concrete repository classes. First, I create a class Repository which inherits from IRepository. In this class, I implement all methods from the interface. Additionally to the methods, I have a constructor which takes a DbContext as Parameter. This DbContext instantiates a DbSet which will be used to get or add data.</p><p><a href="/assets/img/posts/2018/01/Repository.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 151'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-518" data-src="/assets/img/posts/2018/01/Repository.jpg" alt="Repository" width="448" height="151" data-proofer-ignore></a></p><p>The implementations of the methods are pretty straight Forward. The only interesting one might be the Find method which takes an expression as parameter. In the implementation, I use Where to find all entries which fit the Expression of the parameter.</p><p><a href="/assets/img/posts/2018/01/Find-method.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 454 284'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-519" data-src="/assets/img/posts/2018/01/Find-method.jpg" alt="Find method" width="454" height="284" data-proofer-ignore></a></p><p>The final step for the Repository pattern is to implement the CustomerReposiotry. This class derives from Repository and ICustomerRepository and implements the method from the interface. The constructor takes a CustomerDbEntities object as Parameter which is derived from DbContext and generated by Entity Framework.</p><p><a href="/assets/img/posts/2018/01/CustomerRepository.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 797 252'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-521" data-src="/assets/img/posts/2018/01/CustomerRepository.jpg" alt="CustomerRepository" width="797" height="252" data-proofer-ignore></a></p><h3 id="implementing-unit-of-work"><span class="mr-2">Implementing Unit of Work</span><a href="#implementing-unit-of-work" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All repositories are created now, but I need a class which writes my data to the database, the unit of work. To implement this class, I first implement the IUnitOfWork interface in the repositories folder in the library project. This interface derives from IDisposable and has an ICustomerRepository property and the method Complete. This method is responsible for saving changes. The Name of the method could be Save, Finish or whatever you like best.</p><p><a href="/assets/img/posts/2018/01/IUnitOfWork.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 312 144'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-523" data-src="/assets/img/posts/2018/01/IUnitOfWork.jpg" alt="IUnitOfWork" width="312" height="144" data-proofer-ignore></a></p><p>Like before, I add the concrete implementation of IUnitOfWork to the repositories folder in the console application project. The constructor takes a CustomerDbEnties object as parameter and also initializes the ICustomerRepository. The Complete Method saves the context with SaveChanges and the Dispose method disposes changes.</p><p><a href="/assets/img/posts/2018/01/UnitOfWork.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 391 408'%3E%3C/svg%3E" loading="lazy" class="aligncenter size-full wp-image-524" data-src="/assets/img/posts/2018/01/UnitOfWork.jpg" alt="UnitOfWork" width="391" height="408" data-proofer-ignore></a></p><h3 id="using-the-repository-and-unit-of-work"><span class="mr-2">Using the Repository and Unit of Work</span><a href="#using-the-repository-and-unit-of-work" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The usage of the unit of work differs between a web application and a console application. In an MVC application, the unit of work gets injected into the constructor. In the console application, I have to use a using statement. I can use with unitOfWork.Customer.Method(), for example unitOfWork.GetBestCustomers(3). To save the changes use unitOfWork.Complete().</p><p><a href="/assets/img/posts/2018/01/Using-the-unit-of-work.jpg"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 204'%3E%3C/svg%3E" loading="lazy" class="aligncenter wp-image-527" data-src="/assets/img/posts/2018/01/Using-the-unit-of-work.jpg" alt="Using the unit of work" width="800" height="204" data-proofer-ignore></a></p><p>You can find the source code on <a href="https://github.com/WolfgangOfner/RepositoryAndUnitOfWorkPattern" target="_blank" rel="noopener">GitHub</a>. If you want to try out the example, you have to change to connection string in the App.config to the location of the database on your computer</p><p>Note: In this example, I always talked about writing and reading data from the database. The storage location could also be a web service or file drive. If you want to try my example, you have to change the connection string for the database in the App.config file to the Location of the database on your computer.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this post, I showed how to implement the Repository and Unit of Work pattern. Implementing both patterns results in more classes but the advantages of abstraction increased testability and increased maintainability outweigh the disadvantages. I also talked about entity framework and that although it looks like an out of the box Repository and Unit of Work pattern, it comes at the cost of tight coupling to the framework and should not be used to replace the patterns.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/design-pattern/'>Design Pattern</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C#</a> <a href="/tags/entity-framework/" class="post-tag no-text-decoration" >Entity Framework</a> <a href="/tags/software-architecture/" class="post-tag no-text-decoration" >Software Architecture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Repository+and+Unit+of+Work+Pattern+-+Programming+With+Wolfgang&url=%2Frepository-and-unit-of-work-pattern%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Repository+and+Unit+of+Work+Pattern+-+Programming+With+Wolfgang&u=%2Frepository-and-unit-of-work-pattern%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Repository+and+Unit+of+Work+Pattern+-+Programming+With+Wolfgang&url=%2Frepository-and-unit-of-work-pattern%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Frepository-and-unit-of-work-pattern%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/learning/">Learning</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/analyze-software-architecture-ndepend/"><div class="card-body"> <em class="small" data-ts="1612134000" data-df="ll" > Feb 1, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Analyze Software Architecture with NDepend</h3><div class="text-muted small"><p> A part of my job as a software consultant is to analyze existing software to find room for improvement to make the software better or to avoid these mistakes if the software is rewritten soon. The ...</p></div></div></a></div><div class="card"> <a href="/visitor-pattern/"><div class="card-body"> <em class="small" data-ts="1513533346" data-df="ll" > Dec 17, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Visitor Pattern</h3><div class="text-muted small"><p> Today I want to talk about the visitor pattern. It is a powerful pattern and I think it is used too little. Maybe because it looks complex but once you got how it works, it is pretty easy and power...</p></div></div></a></div><div class="card"> <a href="/adapter-pattern/"><div class="card-body"> <em class="small" data-ts="1514215894" data-df="ll" > Dec 25, 2017 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adapter Pattern</h3><div class="text-muted small"><p> The adapter pattern is one of the most useful patterns in my eyes. Therefore I want to explain what the adapter is and present a simple real life example on how it can be used. The Adapter Pattern...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/template-method-pattern/" class="btn btn-outline-primary" prompt="Older"><p>Template Method Pattern</p></a> <a href="/routing-in-asp-net-mvc/" class="btn btn-outline-primary" prompt="Newer"><p>Routing in ASP.NET MVC</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/repository-and-unit-of-work-pattern/'; this.page.identifier = '/repository-and-unit-of-work-pattern/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/azure-arc/">Azure Arc</a> <a class="post-tag" href="/tags/learning/">Learning</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
