<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Deploy Azure Functions with Azure DevOps YAML Pipelines" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en_US" /><meta name="description" content="Deploy an Azure Function using Azure DevOps YAML pipelines and automatically update its settings safely inside the pipeline." /><meta property="og:description" content="Deploy an Azure Function using Azure DevOps YAML pipelines and automatically update its settings safely inside the pipeline." /><link rel="canonical" href="https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" /><meta property="og:url" content="https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-26T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deploy Azure Functions with Azure DevOps YAML Pipelines" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/"},"author":{"@type":"Person","name":"Wolfgang Ofner"},"url":"https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/","description":"Deploy an Azure Function using Azure DevOps YAML pipelines and automatically update its settings safely inside the pipeline.","@type":"BlogPosting","headline":"Deploy Azure Functions with Azure DevOps YAML Pipelines","dateModified":"2021-04-26T00:00:00+02:00","datePublished":"2021-04-26T00:00:00+02:00","@context":"https://schema.org"}</script><title>Deploy Azure Functions with Azure DevOps YAML Pipelines | Programming With Wolfgang</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="author wolfgang ofner" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/wolfgangofner" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wolfgang','programmingwithwolfgang.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Deploy Azure Functions with Azure DevOps YAML Pipelines</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Deploy Azure Functions with Azure DevOps YAML Pipelines</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Deploy Azure Functions with Azure DevOps YAML Pipelines</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 26, 2021, 12:00 AM +0200" > Apr 26 <i class="unloaded">2021-04-26T00:00:00+02:00</i> </span> by <span class="author"> Wolfgang Ofner </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="875 words">10 min</span></div></div><div class="post-content"><p><a href="/azure-functions-process-queue-messages">In my last post</a>, I created an Azure Function that reads messages from an Azure Service Bus Queue and then updates a database. The deployment of the Azure Function was manual using Visual Studio.</p><p>Since I am a big fan of DevOps, I will create an Azure DevOps pipeline today to automate the deployment,</p><h2 id="create-a-basic-yaml-pipeline-in-azure-devops">Create a basic YAML pipeline in Azure DevOps</h2><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>Create a basic YAML pipeline in Azure DevOps where you restore the NuGet packages, build the solution and publish it. For more information about Azure DevOps YAML pipelines, see my post <a href="/build-net-core-in-ci-pipeline-in-azure-devops">Build .NET Core in a CI Pipeline in Azure DevOps</a>.</p><p>Your basic pipeline should look something like this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="na">name </span><span class="pi">:</span> <span class="s">NetCore-CI-azure-pipeline.yml</span>
<span class="na">trigger</span><span class="pi">:</span>
  <span class="na">branches</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">master</span>
  <span class="na">paths</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">AzureFunctions/OrderApi.Messaging.Receive/*</span>

<span class="na">pool</span><span class="pi">:</span>
  <span class="na">vmImage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ubuntu-latest'</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">buildConfiguration</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release'</span>
  <span class="na">SolutionPath</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AzureFunctions/OrderApi.Messaging.Receive/*.sln'</span>
  
<span class="na">stages</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">stage</span><span class="pi">:</span> <span class="s">Build</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Build solution</span>
  <span class="na">jobs</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">Build</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s">Build and publish solution</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">UseDotNet@2</span>      
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">packageType</span><span class="pi">:</span> <span class="s1">'</span><span class="s">sdk'</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.x'</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Use</span><span class="nv"> </span><span class="s">.NET</span><span class="nv"> </span><span class="s">Core</span><span class="nv"> </span><span class="s">SDK</span><span class="nv"> </span><span class="s">3.x'</span>

    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">restore'</span>
        <span class="na">projects</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(SolutionPath)'</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Restore</span><span class="nv"> </span><span class="s">NuGet</span><span class="nv"> </span><span class="s">packages'</span>
 
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">build'</span>
        <span class="na">projects</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(SolutionPath)'</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Build</span><span class="nv"> </span><span class="s">solution'</span>
        
    <span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
      <span class="na">inputs</span><span class="pi">:</span>
        <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">publish'</span>
        <span class="na">publishWebProjects</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">projects</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(SolutionPath)'</span>
        <span class="na">arguments</span><span class="pi">:</span> <span class="s1">'</span><span class="s">--configuration</span><span class="nv"> </span><span class="s">$(buildConfiguration)</span><span class="nv"> </span><span class="s">--output</span><span class="nv"> </span><span class="s">$(Build.ArtifactStagingDirectory)/$(buildConfiguration)'</span>
      <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Publish</span><span class="nv"> </span><span class="s">solution'</span>
</pre></table></code></div></div><p>The pipeline above runs automatically when changes are detected on the master branch inside the AzureFunctions/OrderApi.Messaging.Receive/ folder and uses the newest Ubuntu VM to run the build. Next, I configure a couple of variables and then run the restore, build and publish of the solution.</p><h2 id="deploy-the-azure-function">Deploy the Azure Function</h2><p>Before you can deploy to Azure, you need a service connection. If you don’t have one yet, see <a href="/deploy-kubernetes-azure-devops/#create-a-service-connection-in-azure-devops">Deploy to Azure Kubernetes Service using Azure DevOps YAML Pipelines</a> to set up one.</p><p>With the service connection in place, add the following task to the pipeline:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">AzureFunctionApp@1</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="na">azureSubscription</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AzureServiceConnection'</span>
    <span class="na">appType</span><span class="pi">:</span> <span class="s1">'</span><span class="s">functionAppLinux'</span>
    <span class="na">appName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">microservicedemoOrderApiMessagingReceive'</span> <span class="c1"># replace with the name of your Azure Function</span>
    <span class="na">package</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Build.ArtifactStagingDirectory)/**/*.zip'</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Deploy Azure Function</span>
  <span class="na">condition</span><span class="pi">:</span> <span class="s">and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))</span>
</pre></table></code></div></div><p>This task takes the previously created .zip file (during the publish) and deploys it to an existing Azure Function. All you have to do is replace the appName with your Azure Function name. Note that the Azure Function has to exist, otherwise the task will fail. If you Azure Function runs on Windows, use functionApp as appType.</p><h2 id="update-the-azure-function-settings">Update the Azure Function Settings</h2><p>The Azure Function can be deployed but it won’t work because it has no access to the Azure Service Bus Queue or database. To provide access, you have to update the service settings. First add secrets to your Azure Pipeline by using the Variables button on the right side.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/04/Add-secret-variables-to-the-pipeline.jpg"><img loading="lazy" src="/assets/img/posts/2021/04/Add-secret-variables-to-the-pipeline.jpg" alt="Add secret variables to the pipeline" /></a><p> Add secret variables to the pipeline</p></div><p>Next, add the following variables to your pipeline:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">variables</span><span class="pi">:</span>
  <span class="na">buildConfiguration</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Release'</span>
  <span class="na">ConnectionString</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Server=tcp:$(SQLServerName),1433;Initial</span><span class="nv"> </span><span class="s">Catalog=$(DatabaseName);Persist</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Info=False;User</span><span class="nv"> </span><span class="s">ID=$(DbUser);Password=$(DbPassword);MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection</span><span class="nv"> </span><span class="s">Timeout=30;"</span>
  <span class="na">DatabaseName</span><span class="pi">:</span> <span class="s">Order</span>
  <span class="na">SolutionPath</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AzureFunctions/OrderApi.Messaging.Receive/*.sln'</span>
  <span class="na">SQLServerName</span><span class="pi">:</span> <span class="s">wolfgangmicroservicedemosql.database.windows.net</span> <span class="c1"># replace with your server url</span>
</pre></table></code></div></div><p>Lastly, add the Azure App Service Settings task to update the service settings:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">AzureAppServiceSettings@1</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="na">azureSubscription</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AzureServiceConnection'</span>
    <span class="na">appName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">microservicedemoOrderApiMessagingReceive'</span>
    <span class="na">resourceGroupName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MicroserviceDemo'</span>
    <span class="na">appSettings</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">[</span>
        <span class="s">{</span>
          <span class="s">"name": "QueueConnectionString",</span>
          <span class="s">"value": "$(QueueConnectionString)",</span>
          <span class="s">"slotSetting": false</span>
        <span class="s">},</span>
        <span class="s">{</span>
          <span class="s">"name": "DatabaseConnectionString",</span>
          <span class="s">"value": "$(ConnectionString)", </span>
          <span class="s">"slotSetting": false</span>
        <span class="s">}</span>
      <span class="s">]</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Update App Settings</span>
  <span class="na">condition</span><span class="pi">:</span> <span class="s">and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))</span>
</pre></table></code></div></div><p>For more information about the Azure Service Bus Queue, see my post <a href="/replace-rabbitmq-azure-service-bus-queue">Replace RabbitMQ with Azure Service Bus Queues</a>. The pipeline is finsihed. Deploy the Azure Function and test it.</p><h2 id="testing-the-deployed-azure-function">Testing the deployed Azure Function</h2><p>If you followed this series (<a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>), you know that I am using a Customer microservice which writes updates into a queue and the Azure Function takes these messages to update the database of the Order microservice.</p><p>To test that the Azure Function works, first check the orders, especially the names in the Order database.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/04/The-orders-before-the-update.jpg"><img loading="lazy" src="/assets/img/posts/2021/04/The-orders-before-the-update.jpg" alt="The orders before the update" /></a><p> The orders before the update</p></div><p>Next, update a customer name, for example, from Wolfgang Ofner to Name Changed. The Customer microservice write this update in the queue (or you add the message manually into the queue). The Azure Function sees the new messages, reads it and then updates the orders in the database. After the Azure Function ran, check the orders in the database and you will see the changed name.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/04/The-name-was-updated.jpg"><img loading="lazy" src="/assets/img/posts/2021/04/The-name-was-updated.jpg" alt="The name was updated" /></a><p> The name was updated</p></div><h2 id="conclusion">Conclusion</h2><p>Deploying Azure Functions with Azure DevOps only takes a couple of lines of code and should never be done manually. Additionally, it is very easy to update the existing settings wihtout exposing any sensitve data. In my next post, <a href="/deploy-docker-container-azure-functions">Deploy a Docker Container to Azure Functions using an Azure DevOps YAML Pipeline</a>, I will show you how to deploy an Azure Function inside a Docker container.</p><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>DevOps</a>, <a href='/categories/cloud/'>Cloud</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/devops/" class="post-tag no-text-decoration" >DevOps</a> <a href="/tags/azure-devops/" class="post-tag no-text-decoration" >Azure DevOps</a> <a href="/tags/azure/" class="post-tag no-text-decoration" >Azure</a> <a href="/tags/azure-service-bus/" class="post-tag no-text-decoration" >Azure Service Bus</a> <a href="/tags/azure-functions/" class="post-tag no-text-decoration" >Azure Functions</a> <a href="/tags/yaml/" class="post-tag no-text-decoration" >YAML</a> <a href="/tags/ci-cd/" class="post-tag no-text-decoration" >CI-CD</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deploy Azure Functions with Azure DevOps YAML Pipelines - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deploy Azure Functions with Azure DevOps YAML Pipelines - Programming With Wolfgang&u=https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Deploy Azure Functions with Azure DevOps YAML Pipelines - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/azure-functions-process-queue-messages/">Use Azure Functions to Process Queue Messages</a><li><a href="/microservice-series-from-zero-to-hero/">Microservice Series - From Zero to Hero</a><li><a href="/automatically-version-docker-container/">Automatically Version Docker Containers in Azure DevOps CI</a><li><a href="/deploy-microservices-to-multiple-environments-azure-devops/">Deploy Microservices to multiple Environments using Azure DevOps</a><li><a href="/implement-third-party-paas/">Design and implement third-party PaaS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/70-532/">70-532</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/deploy-docker-container-azure-functions/"><div class="card-body"> <span class="timeago small" > May 3 <i class="unloaded">2021-05-03T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploy a Docker Container to Azure Functions using an Azure DevOps YAML Pipeline</h3><div class="text-muted small"><p> In my last post, I created a YAML pipeline to build and deploy an Azure Function to Azure. Today, I will build the same Azure Function inside a Docker container and deploy the container to Azure. ...</p></div></div></a></div><div class="card"> <a href="/replace-rabbitmq-azure-service-bus-queue/"><div class="card-body"> <span class="timeago small" > Apr 12 <i class="unloaded">2021-04-12T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Replace RabbitMQ with Azure Service Bus Queues</h3><div class="text-muted small"><p> RabbitMQ is a great tool to connect microservices asynchronously but it also comes with a couple of downsides. The biggest downside is that you have to take care of running, monitoring, and updatin...</p></div></div></a></div><div class="card"> <a href="/setup-nginx-ingress-controller-kubernetes/"><div class="card-body"> <span class="timeago small" > May 10 <i class="unloaded">2021-05-10T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Set up Nginx as Ingress Controller in Kubernetes</h3><div class="text-muted small"><p> So far I have used a Service with the type LoadBalancer for my microservices. The service can be set up quickly and also gets a public IP address assign to access the microservice. Besides the load...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/azure-functions-process-queue-messages/" class="btn btn-outline-primary"><p>Use Azure Functions to Process Queue Messages</p></a> <a href="/deploy-docker-container-azure-functions/" class="btn btn-outline-primary"><p>Deploy a Docker Container to Azure Functions using an Azure DevOps YAML Pipeline</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//programmingwithwolfgang.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://www.programmingwithwolfgang.com/deploy-azure-functions-azure-devops-pipelines/'; this.page.identifier = '/deploy-azure-functions-azure-devops-pipelines/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/wolfgang_ofner">Wolfgang Ofner</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/70-532/">70 532</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.programmingwithwolfgang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
