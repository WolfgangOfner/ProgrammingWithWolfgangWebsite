<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="View Components in ASP.NET Core MVC" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="View components are a new feature in ASP.NET Core MVC which replaces the child action feature from the previous version. View components extend views." /><meta property="og:description" content="View components are a new feature in ASP.NET Core MVC which replaces the child action feature from the previous version. View components extend views." /><link rel="canonical" href="/view-components-in-asp-net-core-mvc/" /><meta property="og:url" content="/view-components-in-asp-net-core-mvc/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-05-09T11:41:52+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="View Components in ASP.NET Core MVC" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2019-05-09T11:41:52+02:00","datePublished":"2019-05-09T11:41:52+02:00","description":"View components are a new feature in ASP.NET Core MVC which replaces the child action feature from the previous version. View components extend views.","headline":"View Components in ASP.NET Core MVC","mainEntityOfPage":{"@type":"WebPage","@id":"/view-components-in-asp-net-core-mvc/"},"url":"/view-components-in-asp-net-core-mvc/"}</script><title>View Components in ASP.NET Core MVC | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/videos/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>VIDEOS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>View Components in ASP.NET Core MVC</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>View Components in ASP.NET Core MVC</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1557394912" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 9, 2019 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2283 words"> <em>26 min</em></span> read</div></div><div class="post-content"><p>View components are a new feature in ASP.NET Core MVC which replaces the child action feature from the previous version. View components are classes which provide action-style logic to support partial views. This means that complex content can be embedded in views with C# code which can be easily maintained and unit tested.  You can find the source code for the following demo on <a href="https://github.com/WolfgangOfner/MVC-View-Components" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><h2 id="understanding-view-components"><span class="mr-2">Understanding View Components</span><a href="#understanding-view-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Applications commonly need to embed content in views that aren’t related to the main purpose of the application. Common examples include site navigation tools and authentication panels that let the user login without visiting a separate page. The common thread that all these examples have is that the data required to display the embedded content isn’t part of the model data passed from the action to the view.</p><p>Partial views are used to create reusable markup that is required in views, avoiding the need to duplicate the same content in multiple places in the application. Partial views are a useful feature, but they just contain fragments of HTML and Razor, and the data they operate on is received from the parent view. If you need to display different data, then you run into a problem. You could access the data you need directly from the partial view, but this breaks the separation of concerns that underpins the MVC pattern and results in data retrieval and processing logic being placed in a view file.</p><p>Alternatively, you could extend the view models used by the application so that it includes the data you require, but this means you have to change every action method and it is hard to isolate the functionality of action methods for effective testing.</p><p>This is where view components come in. A view component is a C# class that provides a partial view with the data that it needs, independently from the parent view and the action that renders it. In this regard, a view component can be thought of as a specialized action, but one that is used only to provide a partial view with data. It can’t receive HTTP requests, and the content that it provides will always be included in the parent view.</p><h2 id="creating-a-view-component"><span class="mr-2">Creating a View Component</span><a href="#creating-a-view-component" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>View components can be created in three different ways which are:</p><ul><li>defining a Poco view component<li>deriving from the ViewComponent base class<li>using the ViewComponent attribute</ul><h3 id="creating-poco-view-components"><span class="mr-2">Creating Poco View Components</span><a href="#creating-poco-view-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A Poco view component is a class that provides view component functionality without relying on any of the MVC APIs. As with Poco controllers, the kind of view component is awkward to work with but can be helpful in understanding how they work. A Poco view component is any class whose name ends with ViewComponent and that defines an Invoke method. VIew component classes can be defined anywhere in an application, but the convention is to group them together in a folder called Components at the root level of the project.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-Poco-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-Poco-view-component.jpg" alt="The Poco view component" data-proofer-ignore></a><p> The Poco view component</p></div><p>You can add your view component to a view by calling the invoke method and passing the view component name:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Calling-the-VIewComponent-from-the-view.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Calling-the-VIewComponent-from-the-view.jpg" alt="Calling the VIewComponent from the view" data-proofer-ignore></a><p> Calling the VIewComponent from the view</p></div><p>This code adds the number of countries and its total population on top of the customer table.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Testing-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Testing-the-view-component.jpg" alt="Testing the view component" data-proofer-ignore></a><p> Testing the view component</p></div><p>I know that this is a very simple example but I think it demonstrates how view components work very well.</p><p>First, the PocoViewComponent class was able to get access to the data it required without depending on the action handling the HTTP request or its parent view. Second, defining the logic required to obtain and process the country summary in a C# class which is easily readable and can also be unit tested. Third, the application hasn’t been twisted out of shape by trying to include country objects in view models that are focused on Customer objects. In short, a view component is a self-contained chunk of reusable functionality that can be applied throughout the application and can be developed and tested in isolation.</p><p>Note that you have to include the await keyword. Otherwise, you won’t see an error but only a string representation of a Task will be displayed.</p><h3 id="deriving-from-the-viewcomponent-base-class"><span class="mr-2">Deriving from the ViewComponent Base Class</span><a href="#deriving-from-the-viewcomponent-base-class" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Poco view components are limited in functionality unless they take advantage of the MVC API, which is possible but requires a lot more effort than the more common approach, deriving from the ViewComponent class. Deriving from the base class gives you access to context data and makes it easier to generate results. When you create a derived view component, you don’t have to put ViewComponent in the name.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Calling-the-derived-view-component-from-the-view.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Calling-the-derived-view-component-from-the-view.jpg" alt="Calling the derived view component from the view" data-proofer-ignore></a><p> Calling the derived view component from the view</p></div><h4 id="understanding-view-component-results"><span class="mr-2">Understanding View Component Results</span><a href="#understanding-view-component-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The ability to insert simple values into a parent view isn’t especially useful, but fortunately, view components are capable of much more. More complex effects can be achieved by having the Invoke method return an object that implements the IViewComponentResult interface. There are three built-in classes that implement the IViewComponentResult interface:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> ViewViewComponentResult<td> This class is used to specify a Razor view, with optional view model data. Instances of this class are created using the View method.<tr><td> ContentViewComponentResult<td> This class is used to specify a text result that will be safely encoded for inclusion in an HTML document. Instances of this class are<br /> created using the Content method.<tr><td> HtmlContentViewComponentResult<td> This class is used to specify a fragment of HTML that will be included in the HTML document without further encoding. There<br /> is no ViewComponent method to create this type of result</table></div></div><p>There is special handling for two result types. If a view component returns a string, then it is used to create a ContentViewComponentResult object. If a view component returns an IHtmlContent object, then it is used to create an HtmlContentViewComponentResult object.</p><h4 id="return-a-partial-view"><span class="mr-2">Return a Partial View</span><a href="#return-a-partial-view" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The most useful response is the awkwardly named ViewViewComponentResult object, which tells Razor to render a partial view and includes the result in the parent view. The ViewComponent base class provides the View method for creating ViewViewComponentResult objects, and there are the following four versions of the method available:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> View()<td> Using this method selects the default view for the view component and does not provide a view model<tr><td> View(model)<td> Using the method selects the default view and uses the specified object as the view model.<tr><td> View(viewName)<td> Using this method selects the specified view and does not provide a view model.<tr><td> View(viewName, model)<td> Using this method selects the specified view and uses the specified object as the view model.</table></div></div><p>These methods correspond to those provided by the Controller base class and are used in much the same way.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-derived-view-component-returning-an-IViewComponentResult-object.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-derived-view-component-returning-an-IViewComponentResult-object.jpg" alt="The derived view component returning an IViewComponentResult object" data-proofer-ignore></a><p> The derived view component returning an IViewComponentResult object</p></div><p>Selecting a partial view in a view component is similar to selecting a view in a controller but without two important differences: Razor looks for views in different locations and uses a different default view name if none is specified. Razor is looking for the partial view in the following locations:</p><ul><li>/Views/Home/Components/Derived/Default.cshtml<li>/Views/Shared/Components/Derived/Default.cshtml<li>/Pages/Shared/Components/Derived/Default.cshtml</ul><p>If no name is specified, then Razor looks for a file called Default.cshtml. Razor looks in two locations for the partial view. The first location takes into account the name of the controller handling the HTTP request, which allows each controller to have its own custom view. The second location is shared between all controllers.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/View-for-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/View-for-the-view-component.jpg" alt="View for the view component" data-proofer-ignore></a><p> View for the view component</p></div><p>Start the application and you will see the table, produced by the view component in green on top of the customer table.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-rendered-view-from-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-rendered-view-from-the-view-component.jpg" alt="The rendered view from the view component" data-proofer-ignore></a><p> The rendered view from the view component</p></div><h4 id="returning-html-fragments"><span class="mr-2">Returning HTML Fragments</span><a href="#returning-html-fragments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The ContentViewComponentResult class is used to include fragments of HTML in the parent view without using a view. Instances of the ContentViewComponentResult class are created using the Content method inherited from the ViewComponent base class, which accepts a string value. In addition to the Content method, the Invoke method can return a string, and MVC will automatically convert to a ContentViewComponent.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/View-component-which-returns-HTML.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/View-component-which-returns-HTML.jpg" alt="View component which returns HTML" data-proofer-ignore></a><p> View component which returns HTML</p></div><h4 id="getting-context-data"><span class="mr-2">Getting Context Data</span><a href="#getting-context-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Details about the current request and the parent view are provided to a view component through properties of the ViewComponentContext class. The following table shows the available properties:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> Arguments<td> This property returns a dictionary of the arguments provided by the view, which can also be received via the Invoke method.<tr><td> HtmlEncoder<td> This property returns an HtmlEncoder object that can be used to safely encode HTML fragments.<tr><td> ViewComponentDescriptor<td> This property returns a ViewComponentDescriptor, which provides a description of the view component.<tr><td> ViewContext<td> This property returns the ViewContext object from the parent view.<tr><td> ViewData<td> This property returns a ViewDataDictionary, which provides access to the view data provided for the view component.</table></div></div><h4 id="viewcomponent-base-class-properties"><span class="mr-2">ViewComponent base class Properties</span><a href="#viewcomponent-base-class-properties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The ViewComponent base class provides a set of convenience properties that make it easier to access specific context information:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> ViewComponentContext<td> This property returns the ViewComponentContext object.<tr><td> HttpContext<td> This property returns an HttpContext object that describes the current request and the response that is being prepared.<tr><td> Request<td> This property returns an HttpRequest object that describes the current HTTP request.<tr><td> User<td> This property returns an IPrincipal object that describes the current user.<tr><td> RouteData<td> This property returns a RouteData object that describes the routing data for the current request.<tr><td> ViewBag<td> This property returns the dynamic view bag object, which can be used to pass data between the view component and the view.<tr><td> ModelState<td> This property returns a ModelStateDictionary, which provides details of the model binding process.<tr><td> ViewContext<td> This property returns the ViewContext object that was provided to the parent view.<tr><td> ViewData<td> This property returns a ViewDataDictionary, which provides access to the view data provided for the view component.<tr><td> Url<td> This property returns an IUrlHelper object that can be used to generate URLs.</table></div></div><p>The context data can be used in whatever way it helps the view component to its work, including varying the way that data is selected or rendering different content or views. To demonstrate this feature, I changed my view component to read the route data and if there is a value for id, I return a message.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Reading-RouteData-in-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Reading-RouteData-in-the-view-component.jpg" alt="Reading RouteData in the view component" data-proofer-ignore></a><p> Reading RouteData in the view component</p></div><p>If I call my action with a value for the id parameter, the string is returned instead of the countries and population.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Changing-the-output-of-the-view-component-depending-on-the-route-data.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Changing-the-output-of-the-view-component-depending-on-the-route-data.jpg" alt="Changing the output of the view component, depending on the route data" data-proofer-ignore></a><p> Changing the output of the view component, depending on the route data</p></div><h4 id="providing-context-from-the-parent-view-using-arguments"><span class="mr-2">Providing Context from the Parent View using Arguments</span><a href="#providing-context-from-the-parent-view-using-arguments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Parent views can provide additional context data as arguments in the Component.Invoke expression. This feature can be used to provide data from the parent view model or to give guidance about the type of content that the view component should produce. I extended my view component to take a bool parameter. If this parameter is true, I return a message, indicating that the parameter was received and processed.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Working-with-the-parameter-in-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Working-with-the-parameter-in-the-view-component.jpg" alt="Working with the parameter in the view component" data-proofer-ignore></a><p> Working with the parameter in the view component</p></div><p>Next, I change the main view to provide a parameter for my view component.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Providing-an-argument-to-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Providing-an-argument-to-the-view-component.jpg" alt="Providing an argument to the view component" data-proofer-ignore></a><p> Providing an argument to the view component</p></div><p>Start the application and you will see that the previously defined string will be returned to the view.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Changing-the-output-of-the-view-component-depending-on-the-provided-parameter.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Changing-the-output-of-the-view-component-depending-on-the-provided-parameter.jpg" alt="Changing the output of the view component, depending on the provided parameter" data-proofer-ignore></a><p> Changing the output of the view component, depending on the provided parameter</p></div><p> </p><h2 id="unit-testing-view-components"><span class="mr-2">Unit Testing View Components</span><a href="#unit-testing-view-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>View components can be unit tested like every other C# class. I created a new test project and implemented a simple test to demonstrate how to test the Invoke method.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Unit-testing-the-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Unit-testing-the-view-component.jpg" alt="Unit testing the view component" data-proofer-ignore></a><p> Unit testing the view component</p></div><h2 id="creating-asynchronous-view-components"><span class="mr-2">Creating Asynchronous View Components</span><a href="#creating-asynchronous-view-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>All view components so far were executed synchronously. You can create an asynchronous view component by defining an InvokeAsync method that returns a Task. When Razor receives the Task from the InvokeAsync method, it will wait for it to complete and then insert the result into the main view.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Creating-an-async-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Creating-an-async-view-component.jpg" alt="Creating an async view component" data-proofer-ignore></a><p> Creating an async view component</p></div><h2 id="hybrid-controller--view-component-classes"><span class="mr-2">Hybrid Controller / View Component Classes</span><a href="#hybrid-controller--view-component-classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>View components often provide basic functionality to enhance the current view with additional data. If you have to do more complex operations, you can create a class that is a controller and a view component. This allows for related functionality to be grouped together and reduces code duplication.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-hybrid-controller-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-hybrid-controller-view-component.jpg" alt="The hybrid controller - view component" data-proofer-ignore></a><p> The hybrid controller &#8211; view component</p></div><p>The ViewComponent attribute is applied to classes that don’t inherit from the ViewCompnent base class and whose name doesn’t end with ViewComponent, meaning that the normal discovery process wouldn’t normally categorize the class as view component. The Name property sets the name by which the class can be referred to when applying the class using the @Component.Invoke expression in the parent view.</p><p>Since hybrid classes don’t inherit from the ViewComponent base class, they don’t have access to the convenience methods for creating IViewComponentResult object, which means that I have to create the ViewViewComponentResult object directly.</p><h3 id="creating-hybrid-view"><span class="mr-2">Creating Hybrid View</span><a href="#creating-hybrid-view" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A hybrid class requires two sets of views: those that are rendered when the class is used as a controller and those that are rendered when the class is used as a view component. First, I add the view for the controller under Views/Country/Create.cshtml</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-view-for-the-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-view-for-the-controller.jpg" alt="The view for the controller" data-proofer-ignore></a><p> The view for the controller</p></div><p>Next, I add a the partial view under Views/Shared/Components/HybridComponent/Default.cshml.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Partial-view-for-the-hybrid-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Partial-view-for-the-hybrid-controller.jpg" alt="Partial view for the hybrid controller" data-proofer-ignore></a><p> Partial view for the hybrid controller</p></div><p>Lastly, I invoke my hybrid controller from the view with the previously applied name.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Invoking-the-hybrid-controller-view-component.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Invoking-the-hybrid-controller-view-component.jpg" alt="Invoking the hybrid controller - view component" data-proofer-ignore></a><p> Invoking the hybrid controller &#8211; view component</p></div><p>This renders the (super ugly) form.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/The-rendered-view-of-the-hybrid-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/The-rendered-view-of-the-hybrid-controller.jpg" alt="The rendered view of the hybrid controller" data-proofer-ignore></a><p> The rendered view of the hybrid controller</p></div><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Today, I talked about view components and how they can help you extending your views and introducing more functionality and more information for the users. You can call them synchronously or asynchronously and also easily unit test them. Lastly, I showed how hybrid controller / view components can be used to group more complex code together.</p><p>For more details about the configuring ASP.NET Core, I highly recommend the book “<a href="https://www.amazon.com/Pro-ASP-NET-Core-MVC-2/dp/148423149X" target="_blank" rel="noopener noreferrer">Pro ASP.NET Core MVC 2</a>“. You can find the source code for this demo on <a href="https://github.com/WolfgangOfner/MVC-View-Components" target="_blank" rel="noopener noreferrer">GitHub</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/asp-net/'>ASP.NET</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/net-core/" class="post-tag no-text-decoration" >.NET Core</a> <a href="/tags/asp-net-core-mvc/" class="post-tag no-text-decoration" >ASP.NET Core MVC</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C#</a> <a href="/tags/view-component/" class="post-tag no-text-decoration" >View Component</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=View+Components+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&url=%2Fview-components-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=View+Components+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&u=%2Fview-components-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=View+Components+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&url=%2Fview-components-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fview-components-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/getting-to-know-the-startup-class-of-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556529353" data-df="ll" > Apr 29, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting to know the Startup Class of ASP.NET Core MVC</h3><div class="text-muted small"><p> Every .NET Core web application has a Program class with a static Main method. The Startup class of .NET core is the new version of the Global.asax file. This class is responsible for starting the...</p></div></div></a></div><div class="card"> <a href="/middleware-in-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556702231" data-df="ll" > May 1, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Middleware in ASP.NET Core MVC</h3><div class="text-muted small"><p> Middleware is the term used for the components that are combined to form the request pipeline. This pipeline is arranged like a chain. The request is either returned by the middleware or passed to ...</p></div></div></a></div><div class="card"> <a href="/configure-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556875060" data-df="ll" > May 3, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configure ASP.NET Core MVC</h3><div class="text-muted small"><p> Some configurations like the connection string usually change on every environment your application is running on. Instead of hard-coding this information into your application, ASP.NET Core enable...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/dependency-injection-in-asp-net-core-mvc/" class="btn btn-outline-primary" prompt="Older"><p>Dependency Injection in ASP.NET Core MVC</p></a> <a href="/understanding-tag-helpers-in-asp-net-core-mvc/" class="btn btn-outline-primary" prompt="Newer"><p>Understanding Tag Helpers in ASP.NET Core MVC</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/view-components-in-asp-net-core-mvc/'; this.page.identifier = '/view-components-in-asp-net-core-mvc/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/helm/">Helm</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/yaml/">YAML</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
