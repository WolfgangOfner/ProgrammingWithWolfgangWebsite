<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Dependency Injection in ASP.NET Core MVC" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en" /><meta name="description" content="Dependency Injection is a technique that helps to create flexible applications and simplifies unit testing. It also comes out of the box with .NET Core." /><meta property="og:description" content="Dependency Injection is a technique that helps to create flexible applications and simplifies unit testing. It also comes out of the box with .NET Core." /><link rel="canonical" href="/dependency-injection-in-asp-net-core-mvc/" /><meta property="og:url" content="/dependency-injection-in-asp-net-core-mvc/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-05-07T11:32:49+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dependency Injection in ASP.NET Core MVC" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wolfgang Ofner"},"dateModified":"2019-05-07T11:32:49+02:00","datePublished":"2019-05-07T11:32:49+02:00","description":"Dependency Injection is a technique that helps to create flexible applications and simplifies unit testing. It also comes out of the box with .NET Core.","headline":"Dependency Injection in ASP.NET Core MVC","mainEntityOfPage":{"@type":"WebPage","@id":"/dependency-injection-in-asp-net-core-mvc/"},"url":"/dependency-injection-in-asp-net-core-mvc/"}</script><title>Dependency Injection in ASP.NET Core MVC | Programming With Wolfgang</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programming With Wolfgang"><meta name="application-name" content="Programming With Wolfgang"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> (function (c, l, a, r, i, t, y) { c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) }; t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i; y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y); })(window, document, "clarity", "script", "hc0wl2v6mn"); </script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/author/author-wolfgang-ofner.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/youtube/" class="nav-link"> <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i> <span>YOUTUBE</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="w-100" style="margin-top: 1em; text-align: center;"> <img src="/assets/img/author/azure-solutions-architect-expert.png" alt="Azure Solutions Architect Expert" width="200px" height="200px"></div><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <a href="https://github.com/wolfgangofner" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.youtube.com/channel/UCmiFK5vpvsi6j6gD7W_rsVQ" aria-label="Youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Dependency Injection in ASP.NET Core MVC</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Dependency Injection in ASP.NET Core MVC</h1><div class="post-meta text-muted d-flex flex-column"><div> <span> Posted <em class="" data-ts="1557221569" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 7, 2019 </em> </span> by <span class="author"> By <em> Wolfgang Ofner </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2013 words"> <em>23 min</em></span> read</div></div><div class="post-content"><p>Dependency Injection is a technique that helps to create flexible applications and simplifies unit testing. .NET Core brings dependency injection out of the box, therefore you don’t have to use any third party tools like Autofac or Ninject anymore.</p><h2 id="setting-up-the-demo-application"><span class="mr-2">Setting up the Demo Application</span><a href="#setting-up-the-demo-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can find the source code of the following demo on <a href="https://github.com/WolfgangOfner/MVC-Core-DependencyInjection/tree/master/Set%20up" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p>I created a repository which will provide basic operations for my Customer class like Add and Delete.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Setting-up-a-repository-class-for-basic-operations.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Setting-up-a-repository-class-for-basic-operations.jpg" alt="Setting up a repository class for basic operations" data-proofer-ignore></a><p> Setting up a repository class for basic operations</p></div><p>Next, I created a view which will display the customer’s name and age in a table.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/The-view-to-display-the-customer-data.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/The-view-to-display-the-customer-data.jpg" alt="The view to display the customer data" data-proofer-ignore></a><p> The view to display the customer data</p></div><p>Lastly, I call this view from the controller with the CustomerRepository creating some data.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Hardcoding-the-usage-of-the-CustomerRepository-in-the-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Hardcoding-the-usage-of-the-CustomerRepository-in-the-controller.jpg" alt="Hardcoding the usage of the CustomerRepository in the controller" data-proofer-ignore></a><p> Hard-coding the usage of the CustomerRepository in the controller</p></div><p>The CustomerRepository is hard-coded into the controller. This means that if you want to call the view with a different repository, you have to change the code and recompile it. Also, unit testing is really hard if you don’t have any interfaces to fake. This is where dependency injection comes in handy.</p><h2 id="preparing-for-dependency-injection"><span class="mr-2">Preparing for Dependency Injection</span><a href="#preparing-for-dependency-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The term dependency injection (DI) describes an approach to creating loosely coupled components, which are used automatically by MVC. This means that controllers and other components don’t need to have any knowledge of how the types they require are created. Dependency injection might seem abstract in the beginning but let’s take a look at the modified HomeController:</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Preparing-the-Home-Controller-for-dependency-injection.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Preparing-the-Home-Controller-for-dependency-injection.jpg" alt="Preparing the Home Controller for dependency injection" data-proofer-ignore></a><p> Preparing the Home Controller for dependency injection</p></div><p>I am passing an IRepository object to the constructor of the class. From now on the class doesn’t have to care to get the right object. The right object will be passed. This behavior is also known as the Hollywood Principle. The only problem with this code is, that nobody tells MVC which object to pass as the IRepository and therefore it passes null which will lead to an exception.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Exception-when-starting-the-application.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Exception-when-starting-the-application.jpg" alt="Exception when starting the application" data-proofer-ignore></a><p> Exception when starting the application</p></div><p>In the next section, I will configure MVC, so it knows which object it should inject as IRepository.</p><h3 id="hollywood-principle"><span class="mr-2">Hollywood Principle</span><a href="#hollywood-principle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The Hollywood Principle says: “Don’t call us, We will call you”. This means don’t do anything until further notice. In a more technical term: don’t instantiate an object yourself and do work with it, wait until someone calls you with an object on which you can do your operation.</p><p>For example, I have a calculator class which logs all the steps of the calculation. Instead of instantiating the logger itself, the calculator class expects an ILogger interface which it will use to log. If I want to use this calculator class now, I provide it with my logger. This can be a file logger, a console logger or a database logger. The class doesn’t care about. All it does is ILogger.Log(“My log message”). This behavior makes the classes loosely coupled which means they can be extended and tested (most of the time) easily.</p><h3 id="configuring-the-service-provider"><span class="mr-2">Configuring the Service Provider</span><a href="#configuring-the-service-provider" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the previous section, I added the IRepository interface to the Home controller but it ended in an exception. To fix this problem, all you have to do is the following line to the ConfigureServices method of the Startup class:</p><p>services.AddTransient&lt;IRepository, ProductRepository&gt;();</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Register-the-IRepository-interface-as-ProductRepository.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Register-the-IRepository-interface-as-ProductRepository.jpg" alt="Register the IRepository interface as ProductRepository" data-proofer-ignore></a><p> Register the IRepository interface as ProductRepository</p></div><p>There are three different Methods to register a service, depending on its scope:</p><ul><li>Transient<li>Scoped<li>Singleton</ul><p>I will explain the differences in the section “Understanding Service Life Cycles”. For now, add the line and that’s all you have to do to fix the previous exception.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/The-application-works-again.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/The-application-works-again.jpg" alt="The application works again" data-proofer-ignore></a><p> The application works again</p></div><h2 id="using-dependency-injection-for-concrete-types"><span class="mr-2">Using Dependency Injection for Concrete Types</span><a href="#using-dependency-injection-for-concrete-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Dependency injection can also be used for concrete types, which are not accessed through interfaces. While this doesn’t provide the loose-coupling advantages of using an interface, it is a useful technique because it allows objects to be accessed anywhere in an application and puts concrete types under lifecycle management.</p><p>In the following example, I created a new WeatherService class and added it to the Home controller. There, I created a new action which returns only the string provided by the service. It is not the most useful implementation but it shows how it works.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Adding-the-weather-service-to-the-Home-controller.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Adding-the-weather-service-to-the-Home-controller.jpg" alt="Adding the weather service to the Home controller" data-proofer-ignore></a><p> Adding the weather service to the Home controller</p></div><p>Next, I register the WeatherService in the Startup class. Since there is no mapping between a service type and an implementation type in this solution, you have to use an override of the AddTransient method which accepts a single type parameter that tells the service provider that it should instantiate the WeatherService class to resolve a dependency on this type.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Register-the-WeatherService-in-the-Startup-class.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Register-the-WeatherService-in-the-Startup-class.jpg" alt="Register the WeatherService in the Startup class" data-proofer-ignore></a><p> Register the WeatherService in the Startup class</p></div><p>The advantages of this approach are that the service provider will resolve any dependencies declared by the concrete class and that you can change the configuration so that more specialized sub-classes are used to resolve dependencies for a concrete class. Concrete classes are managed by the service provider and are also subject to lifecycle features, which I will talk about in the next section.</p><p>If you call the new action, you will see the weather information provided by the WeatherService.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Getting-data-from-the-weather-service.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Getting-data-from-the-weather-service.jpg" alt="Getting data from the weather service" data-proofer-ignore></a><p> Getting data from the weather service</p></div><h2 id="understanding-dependency-injection-service-life-cycle"><span class="mr-2">Understanding Dependency Injection Service Life Cycle</span><a href="#understanding-dependency-injection-service-life-cycle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the last example, I added a dependency using the AddTransient method. This is one of four different ways that type mappings can be defined. The following table shows the extension methods for the service provider dependency injection:</p><div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> AddTransient&lt;service, implType&gt;()<td> This method tells the service provider to create a new instance of the implementation type for every dependency on the service type.<tr><td> AddTransient<service>() &lt;/td&gt;<td> This method is used to register a single type, which will be instantiated for every dependency. &lt;/tr&gt;<tr><td> AddTransient<service>(factoryFunc) &lt;/td&gt;<td> This method is used to register a factory function that will be invoked to create an implementation object for every dependency on the service type. &lt;/tr&gt;<tr><td> AddTransient<service>(factoryFunc) or AddScoped<service>() or AddScoped<service>(factoryFunc) &lt;/td&gt;<td> These methods tell the service provider to reuse instances of the implementation type so that all service requests made by components associated with a<br /> common scope, which is usually a single HTTP request, share the same object. These methods follow the same pattern as the corresponding AddTransient methods. &lt;/tr&gt;<tr><td> AddSingleton&lt;service, implType&gt;() or AddSingleton<service>() or AddSingleton<service>(factoryFunc) &lt;/td&gt;<td> These methods tell the service provider to create a new instance of the implementation type for the first service request and then reuse it for every subsequent service<br /> request. &lt;/tr&gt;<tr><td> AddSingleton<service>(instance) &lt;/td&gt;<td> This method provides the service provider with an object that should be used to service all service requests. &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; ###  Using the Transient Life Cycle The simplest way to start using dependency injection is to use the AddTransient method, which tells the service provider to create a new instance of the implementation type whenever it needs to resolve a dependency. The transient life cycle incurs the cost of creating a new instance of the implementation class every time a dependency is resolved, but the advantage is that you don&#8217;t have to worry about managing concurrent access or ensure that objects can be safely reused for multiple requests. In my experience, the transient life cycle is used for most of the applications. #### Using a Factory Function One version of the AddTransient method accepts a factory function that is invoked every time there is a dependency on the service type. This allows the object that is created to be varied so that different dependencies receive instances of different types or instances that are configured differently. To demonstrate this behavior, I extended the ConfigureServices method of the Startup class. First, I inject an IHostingEnvironment object which indicates on which environment the application is running. Afterward, I check this variable and if it is development, I instantiate a ProductRepository as IRepository. Otherwise, I instantiate a CustomerRepository.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Instantiate-the-IRepository-interface-depending-on-the-hosting-environment.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Instantiate-the-IRepository-interface-depending-on-the-hosting-environment.jpg" alt="Instantiate the IRepository interface depending on the hosting environment" data-proofer-ignore></a><p> Instantiate the IRepository interface depending on the hosting environment</p></div>### Using the Scoped Life Cycle This life cycle creates a single object from the implementation class that is used to resolve all the dependencies associated with a single scope, which generally means a single HTTP request. Since the default scope is the HTTP request, this life cycle allows for a single object to be shared by all the components that process a request and is most often used for sharing common context data when writing custom classes, such as routes. Note that there are also versions of the AddScoped method that accept a factory function and that can be used to register a concrete type. These methods work in the same way as the AddTransient method.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Adding-a-scoped-dependency.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Adding-a-scoped-dependency.jpg" alt="Adding a scoped for your dependency injection" data-proofer-ignore></a><p> Adding a scoped dependency</p></div>### Using the Singleton Life Cycle The singleton life cycle ensures that a single object is used to resolve all the dependencies for a given service type. When using this life cycle, you must ensure that the implementation classes used to resolve dependencies are safe for concurrent access.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/04/Adding-a-singleton-dependency.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/04/Adding-a-singleton-dependency.jpg" alt="Adding a singleton for your dependency injection" data-proofer-ignore></a><p> Adding a singleton dependency</p></div>## Dependency Injection in Actions The standard way to declare a dependency is through the constructor. Additionally to the standard way, MVC provides the functionality to inject an action, called action injection. Action injection allows dependencies to be declared through parameters to action methods. To be more precise, action injection is provided by the model binding system. All you have to do is using the FromService attribute before your parameter. Also, don&#8217;t forget to register your service in the Startup class.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Using-action-injection.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Using-action-injection.jpg" alt="Using action injection" data-proofer-ignore></a><p> Using action injection</p></div>MVC uses the services provider to get in instance of the CustomerService class which is used to load all the customers. Using action injection is less common than the constructor injection, but it can be useful when you have a dependency on an object that is expensive to create and that is only required in only one of the actions of a controller. Using constructor injection resolves the dependencies for all action methods, even if the one used to handle the request doesn&#8217;t use the implementation object. ## Dependency Injection in Properties The third way to use dependency injection provided by MVC is property injection. Here, a set of specialized attributes is used to receive specific types via property injection in the controllers and view components. You won&#8217;t need to use these attributes if you derive your controllers from the Controller base class because the context information is exposed through convenience properties. The following table shows the specialized property injection attributes:<div class="table-responsive"><div class="table-wrapper"><table class="table table-striped table-bordered table-hover"><tr><td> Name<td> Description<tr><td> ControllerContext<td> This attribute sets a ControllerContext property, which provides a superset of the functionality of the ActionContext class.<tr><td> ActionContext<td> This attribute sets an ActionContext property to provide context information to action methods. The Controller classes expose the context information through an ActionContext property.<tr><td> ViewContext<td> This attribute sets a ViewContext property to provide context data for view operations.<tr><td> ViewComponentContext<td> This attribute sets a ViewComponentContext property for view components.<tr><td> ViewDataDictionary<td> This attribute sets a ViewDataDictionary property to provide access to the model binding data.</table></div></div>I have never used property binding and don&#8217;t see a use case where to use it. Therefore, I am not going into more detail here. ## Manually Requesting an Implementation Object MVC provides the dependency feature for you. There can be occasions when it can be useful to create an implementation for an interface without relying on dependency injection. In these situations, you can work directly with the service provider.<div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2019/05/Resolve-an-object-manually.jpg"><img loading="lazy" data-src="/assets/img/posts/2019/05/Resolve-an-object-manually.jpg" alt="Resolve an object manually wihtout dependency injection" data-proofer-ignore></a><p> Resolve an object manually</p></div>The HttpContext object returned by the property of the same name defines a RequestServices method that returns an IServiceProvider object. This is known as the service locator pattern, which some developers believe should be avoided. I also think that it should be avoided but there might be some cases where it is reasonable to use it. For example, if the normal way of receiving dependencies through the constructor can&#8217;t be used for some reasons. ## Conclusion Today, I talked about the different types of dependency injection and how to use them with your ASP.NET Core MVC application. If you start with dependency injection, I would only use constructor injection since it is the most common form of it. For more details about complex configurations, I highly recommend the book &#8220;<a href="https://www.amazon.com/Pro-ASP-NET-Core-MVC-2/dp/148423149X" target="_blank" rel="noopener noreferrer">Pro ASP.NET Core MVC 2</a>&#8220;. You can find the source code of this demo on <a href="https://github.com/WolfgangOfner/MVC-Core-DependencyInjection" target="_blank" rel="noopener noreferrer">GitHub</a>. </service></service></service></service></service></service></service></service></table></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/asp-net/'>ASP.NET</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/net-core/" class="post-tag no-text-decoration" >.NET Core</a> <a href="/tags/asp-net-core-mvc/" class="post-tag no-text-decoration" >ASP.NET Core MVC</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C#</a> <a href="/tags/dependency-injection/" class="post-tag no-text-decoration" >Dependency Injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dependency+Injection+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&url=%2Fdependency-injection-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dependency+Injection+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&u=%2Fdependency-injection-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Dependency+Injection+in+ASP.NET+Core+MVC+-+Programming+With+Wolfgang&url=%2Fdependency-injection-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fdependency-injection-in-asp-net-core-mvc%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/video/">Video</a> <a class="post-tag" href="/tags/youtube/">Youtube</a> <a class="post-tag" href="/tags/conference/">Conference</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/getting-to-know-the-startup-class-of-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556529353" data-df="ll" > Apr 29, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting to know the Startup Class of ASP.NET Core MVC</h3><div class="text-muted small"><p> Every .NET Core web application has a Program class with a static Main method. The Startup class of .NET core is the new version of the Global.asax file. This class is responsible for starting the...</p></div></div></a></div><div class="card"> <a href="/middleware-in-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556702231" data-df="ll" > May 1, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Middleware in ASP.NET Core MVC</h3><div class="text-muted small"><p> Middleware is the term used for the components that are combined to form the request pipeline. This pipeline is arranged like a chain. The request is either returned by the middleware or passed to ...</p></div></div></a></div><div class="card"> <a href="/configure-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1556875060" data-df="ll" > May 3, 2019 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configure ASP.NET Core MVC</h3><div class="text-muted small"><p> Some configurations like the connection string usually change on every environment your application is running on. Instead of hard-coding this information into your application, ASP.NET Core enable...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/dealing-with-complex-configurations-in-asp-net-mvc-core/" class="btn btn-outline-primary" prompt="Older"><p>Dealing with Complex Configurations in ASP.NET Core MVC</p></a> <a href="/view-components-in-asp-net-core-mvc/" class="btn btn-outline-primary" prompt="Newer"><p>View Components in ASP.NET Core MVC</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = '/dependency-injection-in-asp-net-core-mvc/'; this.page.identifier = '/dependency-injection-in-asp-net-core-mvc/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://programmingwithwolfgang.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/aks/">AKS</a> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/video/">Video</a> <a class="post-tag" href="/tags/youtube/">Youtube</a> <a class="post-tag" href="/tags/conference/">Conference</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script>
