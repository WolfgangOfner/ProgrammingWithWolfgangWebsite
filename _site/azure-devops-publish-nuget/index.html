<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines" /><meta name="author" content="Wolfgang Ofner" /><meta property="og:locale" content="en_US" /><meta name="description" content="In my last posts, I published my NuGet package to a private NuGet feed. This is a good solution if you want to use your NuGet packages only internally. If you want to share them, you need a public NuGet feed. The by far biggest one (also the default feed) is nuget.org. In this post, I will extend my previously created Azure DevOps pipeline and deploy the NuGet package to nuget.org so everyone can download and use it. Create a Nuget.org API Key To be able to push NuGet packages to nuget.org, you have to obtain an API key first. Go to nuget.org and signup or login and then click on your profile and select API Keys. Create a NuGet API key This opens the API keys page of your account. There click on + Create and enter a name and expiry date. Additionally, select which packages you want to associate with your key. I uploaded the NuGet package by hand before, therefore I can see it in the list. Click Create and the API key gets generated. Generate a NuGet API key Make sure that you click Copy after the API key is generated. This is the only time you can access the key. If you don’t copy it, you have to refresh it to get a new one. Copy the API key Create a NuGet Connection in Azure DevOps The next step is to use the previously created API key to connect Azure DevOps with nuget.org. In your Azure DevOps project, click on Project settings and then Service connections. There click on New service connection and select NuGet. Select ApiKey as the authentication method, enter https://api.nuget.org/v3/index.json as the feed URL, and paste the previously create NuGet API key in the ApiKey textbox. Provide a name and then click Save. Create a NuGet service connection Publish to Nuget.org using an Azure DevOps Pipeline You can find the code of the demo on Github. The last step is to use the previously created service connection to extend the Azure DevOps pipeline and push the NuGet package to nuget.org. Publishing to nuget.org is almost the same as publishing to a private NuGet feed. First, I create a name stage in which I download the previously created NuGet package. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 - stage: publishpublic dependsOn: publishinternal condition: and(succeeded(), ne(variables[&#39;Build.Reason&#39;], &#39;PullRequest&#39;)) displayName: &#39;Nuget - Publish Public Packages&#39; jobs: - deployment: publishpublic displayName: &#39;Nuget - Publish packages to public feed&#39; environment: nuget-publish-public strategy: runOnce: deploy: steps: - download: current artifact: &#39;$(ArtifactNugetName)&#39; displayName: &#39;Download nuget packages&#39; Next, I push the NuGet package to nuget.org using the dotnet core nuget push command. The only difference to push to the internal feed is that I use as feed type external and as publishFeedCredentials the previously created service connection. 1 2 3 4 5 6 7 - task: DotNetCoreCLI@2 displayName: &quot;Publish nuget packages to public feed&quot; inputs: command: &#39;push&#39; packagesToPush: &#39;$(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg&#39; nuGetFeedType: &#39;external&#39; publishFeedCredentials: &#39;PrimeNumber&#39; For more details about the steps see my post Publish to an Internal NuGet Feed in Azure DevOps. That’s all you have to do. Save the pipeline and run it. You can find the finished pipeline on Github. DotNetCore currently does not support using an encrypted Api Key When you run the pipeline, you will get an error while publishing the NuGet package to nuget.org. Publishing to nuget.org failed Everything is set up correctly but there is a bug (or missing feature) in Dotnet Core and therefore you can’t use an API key to push packages. There is an open Github issue which was created in 2018 but Microsoft has ignored the problem so far. Bug Workaround Luckily there is a workaround until (if ever) Microsoft fixes the problem. You can use a dotnetcore custom command and provide the appropriate arguments to push to nuget.org. 1 2 3 4 5 6 7 8 9 - task: DotNetCoreCLI@2 displayName: Push Nuget Package inputs: command: custom custom: nuget arguments: &gt; push $(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg -s https://api.nuget.org/v3/index.json -k $(NuGetApiKey) You tell the command which packages it should push, -s declares the destination, and -k provides the nuget.org API key. The best practice for secret variables is to create a new variable inside the pipeline by clicking on Variables on the top right corner and then click + on the pop-out. Provide a name and previously copied API key. Additionally, check “Keep this value secret” so no user can read the value. Click on OK and run the pipeline again. Publishing the NuGet package worked This time the publish worked. Conclusion Publishing a NuGet package to nuget.org works almost as the publish to a private Azure DevOps feed. Unfortunately, Microsoft has a bug in their dotnetcore task and therefore it is not working as expected. This post showed how you still can use an Azure DevOps pipeline to push a NuGet package to nuget.org using a small workaround. You can find the code of the demo on Github. This post is part of “Microservice Series - From Zero to Hero”." /><meta property="og:description" content="In my last posts, I published my NuGet package to a private NuGet feed. This is a good solution if you want to use your NuGet packages only internally. If you want to share them, you need a public NuGet feed. The by far biggest one (also the default feed) is nuget.org. In this post, I will extend my previously created Azure DevOps pipeline and deploy the NuGet package to nuget.org so everyone can download and use it. Create a Nuget.org API Key To be able to push NuGet packages to nuget.org, you have to obtain an API key first. Go to nuget.org and signup or login and then click on your profile and select API Keys. Create a NuGet API key This opens the API keys page of your account. There click on + Create and enter a name and expiry date. Additionally, select which packages you want to associate with your key. I uploaded the NuGet package by hand before, therefore I can see it in the list. Click Create and the API key gets generated. Generate a NuGet API key Make sure that you click Copy after the API key is generated. This is the only time you can access the key. If you don’t copy it, you have to refresh it to get a new one. Copy the API key Create a NuGet Connection in Azure DevOps The next step is to use the previously created API key to connect Azure DevOps with nuget.org. In your Azure DevOps project, click on Project settings and then Service connections. There click on New service connection and select NuGet. Select ApiKey as the authentication method, enter https://api.nuget.org/v3/index.json as the feed URL, and paste the previously create NuGet API key in the ApiKey textbox. Provide a name and then click Save. Create a NuGet service connection Publish to Nuget.org using an Azure DevOps Pipeline You can find the code of the demo on Github. The last step is to use the previously created service connection to extend the Azure DevOps pipeline and push the NuGet package to nuget.org. Publishing to nuget.org is almost the same as publishing to a private NuGet feed. First, I create a name stage in which I download the previously created NuGet package. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 - stage: publishpublic dependsOn: publishinternal condition: and(succeeded(), ne(variables[&#39;Build.Reason&#39;], &#39;PullRequest&#39;)) displayName: &#39;Nuget - Publish Public Packages&#39; jobs: - deployment: publishpublic displayName: &#39;Nuget - Publish packages to public feed&#39; environment: nuget-publish-public strategy: runOnce: deploy: steps: - download: current artifact: &#39;$(ArtifactNugetName)&#39; displayName: &#39;Download nuget packages&#39; Next, I push the NuGet package to nuget.org using the dotnet core nuget push command. The only difference to push to the internal feed is that I use as feed type external and as publishFeedCredentials the previously created service connection. 1 2 3 4 5 6 7 - task: DotNetCoreCLI@2 displayName: &quot;Publish nuget packages to public feed&quot; inputs: command: &#39;push&#39; packagesToPush: &#39;$(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg&#39; nuGetFeedType: &#39;external&#39; publishFeedCredentials: &#39;PrimeNumber&#39; For more details about the steps see my post Publish to an Internal NuGet Feed in Azure DevOps. That’s all you have to do. Save the pipeline and run it. You can find the finished pipeline on Github. DotNetCore currently does not support using an encrypted Api Key When you run the pipeline, you will get an error while publishing the NuGet package to nuget.org. Publishing to nuget.org failed Everything is set up correctly but there is a bug (or missing feature) in Dotnet Core and therefore you can’t use an API key to push packages. There is an open Github issue which was created in 2018 but Microsoft has ignored the problem so far. Bug Workaround Luckily there is a workaround until (if ever) Microsoft fixes the problem. You can use a dotnetcore custom command and provide the appropriate arguments to push to nuget.org. 1 2 3 4 5 6 7 8 9 - task: DotNetCoreCLI@2 displayName: Push Nuget Package inputs: command: custom custom: nuget arguments: &gt; push $(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg -s https://api.nuget.org/v3/index.json -k $(NuGetApiKey) You tell the command which packages it should push, -s declares the destination, and -k provides the nuget.org API key. The best practice for secret variables is to create a new variable inside the pipeline by clicking on Variables on the top right corner and then click + on the pop-out. Provide a name and previously copied API key. Additionally, check “Keep this value secret” so no user can read the value. Click on OK and run the pipeline again. Publishing the NuGet package worked This time the publish worked. Conclusion Publishing a NuGet package to nuget.org works almost as the publish to a private Azure DevOps feed. Unfortunately, Microsoft has a bug in their dotnetcore task and therefore it is not working as expected. This post showed how you still can use an Azure DevOps pipeline to push a NuGet package to nuget.org using a small workaround. You can find the code of the demo on Github. This post is part of “Microservice Series - From Zero to Hero”." /><link rel="canonical" href="https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" /><meta property="og:url" content="https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" /><meta property="og:site_name" content="Programming With Wolfgang" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-18T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines" /><meta name="twitter:site" content="@wolfgang_ofner" /><meta name="twitter:creator" content="@Wolfgang Ofner" /><meta name="google-site-verification" content="xxsPm-h6A0B6a0QMgqXO80PU4DbMt4Dq06p-SGzB3TU" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/"},"author":{"@type":"Person","name":"Wolfgang Ofner"},"url":"https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/","description":"In my last posts, I published my NuGet package to a private NuGet feed. This is a good solution if you want to use your NuGet packages only internally. If you want to share them, you need a public NuGet feed. The by far biggest one (also the default feed) is nuget.org. In this post, I will extend my previously created Azure DevOps pipeline and deploy the NuGet package to nuget.org so everyone can download and use it. Create a Nuget.org API Key To be able to push NuGet packages to nuget.org, you have to obtain an API key first. Go to nuget.org and signup or login and then click on your profile and select API Keys. Create a NuGet API key This opens the API keys page of your account. There click on + Create and enter a name and expiry date. Additionally, select which packages you want to associate with your key. I uploaded the NuGet package by hand before, therefore I can see it in the list. Click Create and the API key gets generated. Generate a NuGet API key Make sure that you click Copy after the API key is generated. This is the only time you can access the key. If you don’t copy it, you have to refresh it to get a new one. Copy the API key Create a NuGet Connection in Azure DevOps The next step is to use the previously created API key to connect Azure DevOps with nuget.org. In your Azure DevOps project, click on Project settings and then Service connections. There click on New service connection and select NuGet. Select ApiKey as the authentication method, enter https://api.nuget.org/v3/index.json as the feed URL, and paste the previously create NuGet API key in the ApiKey textbox. Provide a name and then click Save. Create a NuGet service connection Publish to Nuget.org using an Azure DevOps Pipeline You can find the code of the demo on Github. The last step is to use the previously created service connection to extend the Azure DevOps pipeline and push the NuGet package to nuget.org. Publishing to nuget.org is almost the same as publishing to a private NuGet feed. First, I create a name stage in which I download the previously created NuGet package. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 - stage: publishpublic dependsOn: publishinternal condition: and(succeeded(), ne(variables[&#39;Build.Reason&#39;], &#39;PullRequest&#39;)) displayName: &#39;Nuget - Publish Public Packages&#39; jobs: - deployment: publishpublic displayName: &#39;Nuget - Publish packages to public feed&#39; environment: nuget-publish-public strategy: runOnce: deploy: steps: - download: current artifact: &#39;$(ArtifactNugetName)&#39; displayName: &#39;Download nuget packages&#39; Next, I push the NuGet package to nuget.org using the dotnet core nuget push command. The only difference to push to the internal feed is that I use as feed type external and as publishFeedCredentials the previously created service connection. 1 2 3 4 5 6 7 - task: DotNetCoreCLI@2 displayName: &quot;Publish nuget packages to public feed&quot; inputs: command: &#39;push&#39; packagesToPush: &#39;$(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg&#39; nuGetFeedType: &#39;external&#39; publishFeedCredentials: &#39;PrimeNumber&#39; For more details about the steps see my post Publish to an Internal NuGet Feed in Azure DevOps. That’s all you have to do. Save the pipeline and run it. You can find the finished pipeline on Github. DotNetCore currently does not support using an encrypted Api Key When you run the pipeline, you will get an error while publishing the NuGet package to nuget.org. Publishing to nuget.org failed Everything is set up correctly but there is a bug (or missing feature) in Dotnet Core and therefore you can’t use an API key to push packages. There is an open Github issue which was created in 2018 but Microsoft has ignored the problem so far. Bug Workaround Luckily there is a workaround until (if ever) Microsoft fixes the problem. You can use a dotnetcore custom command and provide the appropriate arguments to push to nuget.org. 1 2 3 4 5 6 7 8 9 - task: DotNetCoreCLI@2 displayName: Push Nuget Package inputs: command: custom custom: nuget arguments: &gt; push $(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg -s https://api.nuget.org/v3/index.json -k $(NuGetApiKey) You tell the command which packages it should push, -s declares the destination, and -k provides the nuget.org API key. The best practice for secret variables is to create a new variable inside the pipeline by clicking on Variables on the top right corner and then click + on the pop-out. Provide a name and previously copied API key. Additionally, check “Keep this value secret” so no user can read the value. Click on OK and run the pipeline again. Publishing the NuGet package worked This time the publish worked. Conclusion Publishing a NuGet package to nuget.org works almost as the publish to a private Azure DevOps feed. Unfortunately, Microsoft has a bug in their dotnetcore task and therefore it is not working as expected. This post showed how you still can use an Azure DevOps pipeline to push a NuGet package to nuget.org using a small workaround. You can find the code of the demo on Github. This post is part of “Microservice Series - From Zero to Hero”.","@type":"BlogPosting","headline":"Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines","dateModified":"2021-01-18T00:00:00+01:00","datePublished":"2021-01-18T00:00:00+01:00","@context":"https://schema.org"}</script><title>Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines | Programming With Wolfgang</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-112077092-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-112077092-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/author/wolfgang-small.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Programming With Wolfgang</a></div><div class="site-subtitle font-italic">Let's talk programming</div></div><div class="w-100 d-flex justify-content-center"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span></div><ul class="w-100" style="margin-top: 1em;"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/wolfgangofner" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wolfgang_ofner" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/wolfgangofner" aria-label="linkedin" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wolfgang','programmingwithwolfgang.com'].join('@')" aria-label="email" class="order-6" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-7" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="d-sm-none row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines</div><div style="visibility:hidden;"> <i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 18, 2021, 12:00 AM +0100" > Jan 18 <i class="unloaded">2021-01-18T00:00:00+01:00</i> </span> by <span class="author"> Wolfgang Ofner </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="844 words">9 min</span></div></div><div class="post-content"><p><a href="/publish-internal-nuget-feed">In my last posts</a>, I published my NuGet package to a private NuGet feed. This is a good solution if you want to use your NuGet packages only internally. If you want to share them, you need a public NuGet feed. The by far biggest one (also the default feed) is nuget.org.</p><p>In this post, I will extend my previously created Azure DevOps pipeline and deploy the NuGet package to nuget.org so everyone can download and use it.</p><h2 id="create-a-nugetorg-api-key">Create a Nuget.org API Key</h2><p>To be able to push NuGet packages to nuget.org, you have to obtain an API key first. Go to nuget.org and signup or login and then click on your profile and select API Keys.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Create-a-nuget-api-key.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Create-a-nuget-api-key.jpg" alt="Create a NuGet api key" /></a><p> Create a NuGet API key</p></div><p>This opens the API keys page of your account. There click on + Create and enter a name and expiry date. Additionally, select which packages you want to associate with your key. I uploaded the NuGet package by hand before, therefore I can see it in the list. Click Create and the API key gets generated.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Generate-a-nuget-API-key.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Generate-a-nuget-API-key.jpg" alt="Generate a NuGet API key" /></a><p> Generate a NuGet API key</p></div><p>Make sure that you click Copy after the API key is generated. This is the only time you can access the key. If you don’t copy it, you have to refresh it to get a new one.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Copy-the-API-key.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Copy-the-API-key.jpg" alt="Copy the API key" /></a><p> Copy the API key</p></div><h2 id="create-a-nuget-connection-in-azure-devops">Create a NuGet Connection in Azure DevOps</h2><p>The next step is to use the previously created API key to connect Azure DevOps with nuget.org. In your Azure DevOps project, click on Project settings and then Service connections. There click on New service connection and select NuGet. Select ApiKey as the authentication method, enter https://api.nuget.org/v3/index.json as the feed URL, and paste the previously create NuGet API key in the ApiKey textbox. Provide a name and then click Save.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Create-a-nuget-service-connection.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Create-a-nuget-service-connection.jpg" alt="Create a NuGet service connection" /></a><p> Create a NuGet service connection</p></div><h2 id="publish-to-nugetorg-using-an-azure-devops-pipeline">Publish to Nuget.org using an Azure DevOps Pipeline</h2><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>The last step is to use the previously created service connection to extend the Azure DevOps pipeline and push the NuGet package to nuget.org. Publishing to nuget.org is almost the same as publishing to a private NuGet feed.</p><p>First, I create a name stage in which I download the previously created NuGet package.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">stage</span><span class="pi">:</span> <span class="s">publishpublic</span>
  <span class="na">dependsOn</span><span class="pi">:</span> <span class="s">publishinternal</span>
  <span class="na">condition</span><span class="pi">:</span> <span class="s">and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Nuget</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">Publish</span><span class="nv"> </span><span class="s">Public</span><span class="nv"> </span><span class="s">Packages'</span>
  <span class="na">jobs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">deployment</span><span class="pi">:</span> <span class="s">publishpublic</span>
    <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Nuget</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">Publish</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">public</span><span class="nv"> </span><span class="s">feed'</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">nuget-publish-public</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">runOnce</span><span class="pi">:</span>
        <span class="na">deploy</span><span class="pi">:</span>
          <span class="na">steps</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">download</span><span class="pi">:</span> <span class="s">current</span>
            <span class="na">artifact</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(ArtifactNugetName)'</span>
            <span class="na">displayName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Download</span><span class="nv"> </span><span class="s">nuget</span><span class="nv"> </span><span class="s">packages'</span>
</pre></table></code></div></div><p>Next, I push the NuGet package to nuget.org using the dotnet core nuget push command. The only difference to push to the internal feed is that I use as feed type external and as publishFeedCredentials the previously created service connection.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Publish</span><span class="nv"> </span><span class="s">nuget</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">public</span><span class="nv"> </span><span class="s">feed"</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s1">'</span><span class="s">push'</span>
    <span class="na">packagesToPush</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg'</span>
    <span class="na">nuGetFeedType</span><span class="pi">:</span> <span class="s1">'</span><span class="s">external'</span>
    <span class="na">publishFeedCredentials</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrimeNumber'</span>
</pre></table></code></div></div><p>For more details about the steps see my post <a href="/publish-internal-nuget-feed">Publish to an Internal NuGet Feed in Azure DevOps</a>.</p><p>That’s all you have to do. Save the pipeline and run it. You can find the finished pipeline on <a href="https://github.com/WolfgangOfner/MicroserviceDemo/blob/master/Nuget/pipelines/Nuget-CI-CD.yml" target="_blank" rel="noopener noreferrer">Github</a>.</p><h2 id="dotnetcore-currently-does-not-support-using-an-encrypted-api-key">DotNetCore currently does not support using an encrypted Api Key</h2><p>When you run the pipeline, you will get an error while publishing the NuGet package to nuget.org.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Publishing-to-nuget-failed.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Publishing-to-nuget-failed.jpg" alt="Publishing to nuget.org failed" /></a><p> Publishing to nuget.org failed</p></div><p>Everything is set up correctly but there is a bug (or missing feature) in Dotnet Core and therefore you can’t use an API key to push packages. There is an open <a href="https://github.com/microsoft/azure-pipelines-tasks/issues/7160" target="_blank" rel="noopener noreferrer">Github</a> issue which was created in 2018 but Microsoft has ignored the problem so far.</p><h3 id="bug-workaround">Bug Workaround</h3><p>Luckily there is a workaround until (if ever) Microsoft fixes the problem. You can use a dotnetcore custom command and provide the appropriate arguments to push to nuget.org.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">task</span><span class="pi">:</span> <span class="s">DotNetCoreCLI@2</span>
  <span class="na">displayName</span><span class="pi">:</span> <span class="s">Push Nuget Package</span>
  <span class="na">inputs</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">custom</span>
    <span class="na">custom</span><span class="pi">:</span> <span class="s">nuget</span>
    <span class="na">arguments</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">push $(Agent.BuildDirectory)/$(ArtifactNugetName)/*.nupkg</span>
      <span class="s">-s https://api.nuget.org/v3/index.json</span>
      <span class="s">-k $(NuGetApiKey) </span>
</pre></table></code></div></div><p>You tell the command which packages it should push, -s declares the destination, and -k provides the nuget.org API key. The best practice for secret variables is to create a new variable inside the pipeline by clicking on Variables on the top right corner and then click + on the pop-out. Provide a name and previously copied API key. Additionally, check “Keep this value secret” so no user can read the value. Click on OK and run the pipeline again.</p><div class="col-12 col-sm-10 aligncenter"> <a href="/assets/img/posts/2021/01/Publishing-the-nuget-package-worked.jpg"><img loading="lazy" src="/assets/img/posts/2021/01/Publishing-the-nuget-package-worked.jpg" alt="Publishing the NuGet package worked" /></a><p> Publishing the NuGet package worked</p></div><p>This time the publish worked.</p><h2 id="conclusion">Conclusion</h2><p>Publishing a NuGet package to nuget.org works almost as the publish to a private Azure DevOps feed. Unfortunately, Microsoft has a bug in their dotnetcore task and therefore it is not working as expected. This post showed how you still can use an Azure DevOps pipeline to push a NuGet package to nuget.org using a small workaround.</p><p>You can find the code of the demo on <a href="https://github.com/WolfgangOfner/MicroserviceDemo" target="_blank" rel="noopener noreferrer">Github</a>.</p><p>This post is part of <a href="/microservice-series-from-zero-to-hero">“Microservice Series - From Zero to Hero”</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>DevOps</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure-devops/" class="post-tag no-text-decoration" >Azure DevOps</a> <a href="/tags/nuget/" class="post-tag no-text-decoration" >NuGet</a> <a href="/tags/ci/" class="post-tag no-text-decoration" >CI</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines - Programming With Wolfgang&u=https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Publish NuGet Packages to Nuget.org using Azure DevOps Pipelines - Programming With Wolfgang&url=https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/deploy-dacpac-linux-azure-devops/">Automatically Deploy your Database with Dacpac Packages using Linux and Azure DevOps</a><li><a href="/microservice-series-from-zero-to-hero/">Microservice Series - From Zero to Hero</a><li><a href="/azure-kubernetes-service-getting-started/">Azure Kubernetes Service - Getting Started</a><li><a href="/analyze-software-architecture-ndepend/">Analyze Software Architecture with NDepend</a><li><a href="/automatically-deploy-database-changes/">Automatically deploy Database Changes with SSDT</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/70-532/">70-532</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/net-core/">NET Core</a> <a class="post-tag" href="/tags/ci/">CI</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/create-nuget-azure-devops/"><div class="card-body"> <span class="timeago small" > Dec 28, 2020 <i class="unloaded">2020-12-28T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create NuGet Packages in Azure DevOps Pipelines</h3><div class="text-muted small"><p> I think the most important rule of a microservice is that it has to be deployed independently. When your project or company grows, it is very likely that you want to share code between projects or ...</p></div></div></a></div><div class="card"> <a href="/publish-internal-nuget-feed/"><div class="card-body"> <span class="timeago small" > Jan 4 <i class="unloaded">2021-01-04T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Publish to an Internal NuGet Feed in Azure DevOps</h3><div class="text-muted small"><p> In my last posts, I showed how to create NuGet packages in Azure DevOps pipelines. To easily distribute them, you have to publish these NuGet packages to a NuGet feed. This can be done by using nug...</p></div></div></a></div><div class="card"> <a href="/restore-nuget-inside-docker/"><div class="card-body"> <span class="timeago small" > Jan 11 <i class="unloaded">2021-01-11T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Restore NuGet Packages from a Private Feed when building Docker Containers</h3><div class="text-muted small"><p> In my last posts, I created a private NuGet feed and automatically uploaded a NuGet package with my Azure DevOps pipeline. Using Visual Studio to restore the NuGet package from the private feed wor...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/restore-nuget-inside-docker/" class="btn btn-outline-primary"><p>Restore NuGet Packages from a Private Feed when building Docker Containers</p></a> <a href="/deployment-approvals-yaml-pipeline/" class="btn btn-outline-primary"><p>Approvals for YAML Pipelines in Azure DevOps</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//programmingwithwolfgang.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://www.programmingwithwolfgang.com/azure-devops-publish-nuget/'; this.page.identifier = '/azure-devops-publish-nuget/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/wolfgang_ofner">Wolfgang Ofner</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/azure/">Azure</a> <a class="post-tag" href="/tags/learning/">Learning</a> <a class="post-tag" href="/tags/azure-devops/">Azure DevOps</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/70-532/">70 532</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/exam/">Exam</a> <a class="post-tag" href="/tags/net-core/">NET Core</a> <a class="post-tag" href="/tags/ci/">CI</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.programmingwithwolfgang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
